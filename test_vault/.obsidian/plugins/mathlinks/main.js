/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin:
https://github.com/zhaoshenzhai/obsidian-mathlinks
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getOwnPropSymbols = Object.getOwnPropertySymbols;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __propIsEnum = Object.prototype.propertyIsEnumerable;
var __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;
var __spreadValues = (a, b) => {
  for (var prop in b || (b = {}))
    if (__hasOwnProp.call(b, prop))
      __defNormalProp(a, prop, b[prop]);
  if (__getOwnPropSymbols)
    for (var prop of __getOwnPropSymbols(b)) {
      if (__propIsEnum.call(b, prop))
        __defNormalProp(a, prop, b[prop]);
    }
  return a;
};
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);
var __async = (__this, __arguments, generator) => {
  return new Promise((resolve, reject) => {
    var fulfilled = (value) => {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    };
    var rejected = (value) => {
      try {
        step(generator.throw(value));
      } catch (e) {
        reject(e);
      }
    };
    var step = (x) => x.done ? resolve(x.value) : Promise.resolve(x.value).then(fulfilled, rejected);
    step((generator = generator.apply(__this, __arguments)).next());
  });
};

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => MathLinks
});
module.exports = __toCommonJS(main_exports);

// src/links/preview.ts
var import_obsidian4 = require("obsidian");
var import_state = require("@codemirror/state");
var import_view = require("@codemirror/view");
var import_language = require("@codemirror/language");

// src/api/provider.ts
var import_obsidian2 = require("obsidian");

// src/utils.ts
var import_obsidian = require("obsidian");
function isExcluded(plugin, file) {
  for (let i = 0; i < plugin.settings.excludedPaths.length; i++) {
    let excluded = plugin.app.vault.getAbstractFileByPath(plugin.settings.excludedPaths[i]);
    if (excluded && isEqualToOrChildOf(file, excluded))
      return false;
  }
  return true;
}
function translateLink(targetLink) {
  var _a;
  function translateLinkImpl(targetLink2, pattern) {
    let result = pattern.exec(targetLink2);
    if (result)
      return (result[1] ? `${result[1]} > ` : "") + `${result[2]}`;
  }
  let headingPattern = /(^.*)#([^\^].*)/;
  let blockPattern = /(^.*)#(\^[a-zA-Z0-9\-]+)/;
  let translatedAsHeading = translateLinkImpl(targetLink, headingPattern);
  let translatedAsBlock = translateLinkImpl(targetLink, blockPattern);
  return (_a = translatedAsHeading != null ? translatedAsHeading : translatedAsBlock) != null ? _a : "";
}
function isEqualToOrChildOf(file1, file2) {
  if (file1 == file2)
    return true;
  if (file2 instanceof import_obsidian.TFolder && file2.isRoot())
    return true;
  let ancestor = file1.parent;
  while (true) {
    if (ancestor == file2)
      return true;
    if (ancestor) {
      if (ancestor.isRoot())
        return false;
      ancestor = ancestor.parent;
    }
  }
}
function informChange(app, eventName, ...callbackArgs) {
  app.metadataCache.trigger(eventName, ...callbackArgs);
  app.workspace.iterateRootLeaves((leaf) => {
    var _a;
    if (leaf.view instanceof import_obsidian.MarkdownView && leaf.view.getMode() == "source") {
      (_a = leaf.view.editor.cm) == null ? void 0 : _a.dispatch({
        effects: forceUpdateEffect.of(null)
      });
    }
  });
}

// src/api/index.ts
function update(app, file) {
  if (file) {
    informChange(app, "mathlinks:update", file);
  } else {
    informChange(app, "mathlinks:update-all");
  }
}

// src/api/provider.ts
var Provider = class extends import_obsidian2.Component {
  constructor(mathLinks) {
    super();
    this.mathLinks = mathLinks;
    this._enableInSourceMode = false;
  }
  get enableInSourceMode() {
    return this._enableInSourceMode;
  }
  set enableInSourceMode(enable) {
    this._enableInSourceMode = enable;
    update(this.mathLinks.app);
  }
  onunload() {
    const providers = this.mathLinks.providers;
    let index = providers.findIndex(({ provider }) => provider === this);
    providers.splice(index, 1);
    update(this.mathLinks.app);
  }
};
var NativeProvider = class extends Provider {
  get enableInSourceMode() {
    return this.mathLinks.settings.enableInSourceMode;
  }
  set enableInSourceMode(enable) {
    this.mathLinks.settings.enableInSourceMode = enable;
    update(this.mathLinks.app);
    this.mathLinks.saveSettings();
  }
  provide(parsedLinktext, targetFile, targetSubpathResult) {
    var _a;
    const { mathLinks } = this;
    const { app } = mathLinks;
    if (!targetFile)
      return null;
    let cache = app.metadataCache.getFileCache(targetFile);
    if (!cache)
      return null;
    let mathLink = null;
    if (targetSubpathResult) {
      mathLink = getMathLinkFromSubpath(parsedLinktext.path, targetSubpathResult, cache.frontmatter, mathLinks.settings.blockPrefix, mathLinks.settings.enableFileNameBlockLinks ? null : "");
    } else if (parsedLinktext.path) {
      mathLink = (_a = cache.frontmatter) == null ? void 0 : _a.mathLink;
      if (mathLink == "auto") {
        mathLink = getMathLinkFromTemplates(mathLinks, targetFile);
      }
    }
    return mathLink;
  }
};
var DeprecatedAPIProvider = class extends Provider {
  constructor(account) {
    super(account.plugin);
    this.account = account;
  }
  provide(parsedLinktext, targetFile, targetSubpathResult, sourceFile) {
    var _a;
    if (targetFile === null || sourceFile === null) {
      return null;
    }
    let mathLink = null;
    const metadata = this.account.metadataSet.get(targetFile);
    if (metadata) {
      if (targetSubpathResult) {
        mathLink = getMathLinkFromSubpath(parsedLinktext.path, targetSubpathResult, metadata, this.account.blockPrefix, this.account.prefixer(sourceFile, targetFile, targetSubpathResult));
      } else {
        mathLink = (_a = metadata["mathLink"]) != null ? _a : null;
      }
    }
    return mathLink;
  }
};

// src/links/helper.ts
var import_obsidian3 = require("obsidian");
function setMathLink(source, mathLinkEl) {
  mathLinkEl.replaceChildren();
  const mathPattern = /\$(.*?[^\s])\$/g;
  let textFrom = 0, textTo = 0;
  let result;
  while ((result = mathPattern.exec(source)) !== null) {
    const mathString = result[1];
    textTo = result.index;
    if (textTo > textFrom)
      mathLinkEl.createSpan().replaceWith(source.slice(textFrom, textTo));
    const mathEl = (0, import_obsidian3.renderMath)(mathString, false);
    mathLinkEl.createSpan({ cls: ["math", "math-inline", "is-loaded"] }).replaceWith(mathEl);
    (0, import_obsidian3.finishRenderMath)();
    textFrom = mathPattern.lastIndex;
  }
  if (textFrom < source.length)
    mathLinkEl.createSpan().replaceWith(source.slice(textFrom));
}
function getMathLink(plugin, targetLink, sourcePath, isSourceMode) {
  let { path, subpath } = (0, import_obsidian3.parseLinktext)(targetLink);
  let file = plugin.app.metadataCache.getFirstLinkpathDest(path, sourcePath);
  if (!file)
    return "";
  let cache = plugin.app.metadataCache.getFileCache(file);
  if (!cache)
    return "";
  let subpathResult = (0, import_obsidian3.resolveSubpath)(cache, subpath);
  const sourceFile = plugin.app.vault.getAbstractFileByPath(sourcePath);
  if (!(sourceFile instanceof import_obsidian3.TFile)) {
    return "";
  }
  let mathLink = "";
  plugin.iterateProviders((provider) => {
    if (isSourceMode && !provider.enableInSourceMode)
      return;
    const provided = provider.provide({ path, subpath }, file, subpathResult, sourceFile);
    if (provided) {
      if (provider instanceof NativeProvider && (subpathResult == null ? void 0 : subpathResult.type) == "heading") {
        if (mathLink && provided == (path ? path + " > " : "") + subpathResult.current.heading) {
          return;
        }
      }
      mathLink = provided;
    }
  });
  return mathLink;
}
function getMathLinkFromSubpath(linkpath, subpathResult, metadata, blockPrefix, prefix) {
  var _a, _b;
  let subMathLink = "";
  if (subpathResult.type == "heading") {
    subMathLink = subpathResult.current.heading;
  } else if (subpathResult.type == "block" && ((_a = metadata == null ? void 0 : metadata["mathLink-blocks"]) == null ? void 0 : _a[subpathResult.block.id])) {
    subMathLink = blockPrefix + metadata["mathLink-blocks"][subpathResult.block.id];
  }
  if (subMathLink) {
    if (prefix === null) {
      if (linkpath) {
        return ((_b = metadata == null ? void 0 : metadata["mathLink"]) != null ? _b : linkpath) + " > " + subMathLink;
      } else {
        return subMathLink;
      }
    } else {
      return prefix + subMathLink;
    }
  } else {
    return "";
  }
}
function getMathLinkFromTemplates(plugin, file) {
  let templates = plugin.settings.templates;
  let mathLink = file.name.replace(/\.md$/, "");
  for (let i = 0; i < templates.length; i++) {
    let replaced = new RegExp(templates[i].replaced);
    let replacement = templates[i].replacement;
    let flags = "";
    if (templates[i].globalMatch)
      flags += "g";
    if (!templates[i].sensitive)
      flags += "i";
    if (templates[i].word)
      replaced = RegExp(replaced.source.replace(/^/, "\\b").replace(/$/, "\\b"), flags);
    else
      replaced = RegExp(replaced.source, flags);
    mathLink = mathLink.replace(replaced, replacement);
  }
  return mathLink;
}

// src/links/supercharged.ts
function addSuperCharged(plugin, span, outLinkFile) {
  if (outLinkFile && plugin.app.plugins.enabledPlugins.has("supercharged-links-obsidian")) {
    let superCharged = getSuperCharged(plugin, outLinkFile);
    span.classList.add("data-link-icon");
    span.classList.add("data-link-icon-after");
    span.classList.add("data-link-text");
    span.setAttribute("data-link-path", outLinkFile.path);
    span.setAttribute("data-link-tags", superCharged[0]);
    for (let i = 0; i < superCharged[1].length; i++)
      span.setAttribute("data-link-" + superCharged[1][i][0], superCharged[1][i][1]);
  }
}
function getSuperCharged(plugin, file) {
  var _a, _b, _c;
  const data = (_a = plugin.app.plugins.plugins["supercharged-links-obsidian"]) == null ? void 0 : _a.settings;
  let tagArr = (_b = plugin.app.metadataCache.getFileCache(file)) == null ? void 0 : _b.tags;
  let tags = "";
  if (tagArr) {
    for (let i = 0; i < tagArr.length; i++)
      tags += tagArr[i].tag.replace(/#/, "") + " ";
    tags = tags.trimEnd();
  }
  let attributes = [];
  let frontmatter = (_c = plugin.app.metadataCache.getFileCache(file)) == null ? void 0 : _c.frontmatter;
  if (data) {
    for (let attr in frontmatter) {
      if (attr != "mathLink" && attr != "position") {
        let selectors = data.selectors;
        for (let i = 0; i < selectors.length; i++) {
          if (selectors[i].name == attr && selectors[i].value == frontmatter[attr]) {
            attributes.push([attr, frontmatter[attr]]);
          } else if (selectors[i].type == "tag" && selectors[i].value == frontmatter[attr] && data.targetTags) {
            attributes.push([attr, frontmatter[attr]]);
          }
        }
      }
    }
  }
  return [tags, attributes];
}

// src/links/preview.ts
function selectionAndRangeOverlap(selection, rangeFrom, rangeTo) {
  for (const range of selection.ranges) {
    if (range.from <= rangeTo && range.to >= rangeFrom) {
      return true;
    }
  }
  return false;
}
function hasEffect(tr, effectType) {
  return tr.effects.some((effect) => effect.is(effectType));
}
var forceUpdateEffect = import_state.StateEffect.define();
var MathLinkInfo = class extends import_state.RangeValue {
  constructor(linkText, mathLink) {
    super();
    this.linkText = linkText;
    this.mathLink = mathLink;
  }
  eq(other) {
    return this.linkText == other.linkText && this.mathLink == other.mathLink;
  }
};
var createEditorExtensions = (plugin) => {
  const buildField = (state) => {
    let builder = new import_state.RangeSetBuilder();
    const isSourceMode = !state.field(import_obsidian4.editorLivePreviewField);
    const file = state.field(import_obsidian4.editorInfoField).file;
    let start = -1, end = -1, outLinkText = "", outLinkMathLink = "";
    (0, import_language.syntaxTree)(state).iterate({
      enter(node) {
        let name = node.type.name;
        if (name.contains("formatting-link_formatting-link-start")) {
          if (isSourceMode) {
            if (state.sliceDoc(node.from, node.to) == "[[" && node.node.nextSibling) {
              start = node.node.nextSibling.from;
            } else {
              return;
            }
          } else {
            start = node.from;
          }
        } else if (name.contains("formatting_formatting-link_link")) {
          if (start == -1) {
            start = node.from;
          }
        } else if (name.contains("has-alias")) {
          outLinkText += state.doc.sliceString(node.from, node.to);
          if (file && outLinkMathLink == outLinkText.replace(/\.md/, "")) {
            outLinkMathLink = getMathLink(plugin, outLinkText, file.path, isSourceMode);
          }
        } else if (/string_url$/.test(name) && !name.contains("format")) {
          outLinkText += decodeURI(state.doc.sliceString(node.from, node.to));
          if (file && outLinkMathLink == outLinkText.replace(/\.md/, "")) {
            outLinkMathLink = getMathLink(plugin, outLinkText, file.path, isSourceMode);
          }
        } else if (file && name.contains("hmd-internal-link") && !name.contains("alias")) {
          outLinkText += state.doc.sliceString(node.from, node.to);
          outLinkMathLink = getMathLink(plugin, outLinkText, file.path, isSourceMode);
        } else if (name.contains("formatting-link-end") || name.contains("formatting-link-string")) {
          if (!name.contains("end") && end == -1) {
            end = -2;
          } else {
            if (isSourceMode) {
              if (node.node.prevSibling && state.sliceDoc(node.from, node.to) == "]]") {
                end = node.node.prevSibling.to;
              } else {
                return;
              }
            } else {
              end = node.to;
            }
            let cursorRange = state.selection.main;
            if (start > cursorRange.to || end < cursorRange.from) {
              if (outLinkText && outLinkMathLink) {
                builder.add(start, end, new MathLinkInfo(outLinkText, outLinkMathLink.replace(/\\\$/, "$")));
              }
            }
            start = -1;
            end = -1;
            outLinkText = "";
            outLinkMathLink = "";
          }
        } else if (!name.contains("pipe") && (name.contains("hmd-internal-link") && name.contains("alias") || name.contains("hmd-escape") && name.contains("link") || /^link/.test(name))) {
          outLinkMathLink += state.doc.sliceString(node.from, node.to);
          if (file && outLinkMathLink == outLinkText.replace(/\.md/, "")) {
            outLinkMathLink = getMathLink(plugin, outLinkText, file.path, isSourceMode);
          }
        }
      }
    });
    return builder.finish();
  };
  const mathLinkInfoField = import_state.StateField.define({
    create: buildField,
    update(oldFields, tr) {
      return tr.docChanged || hasEffect(tr, forceUpdateEffect) ? buildField(tr.state) : oldFields;
    }
  });
  class MathWidget extends import_view.WidgetType {
    constructor(outLinkText, outLinkMathLink, isSourceMode, sourcePath) {
      super();
      this.outLinkText = outLinkText;
      this.outLinkMathLink = outLinkMathLink;
      this.isSourceMode = isSourceMode;
      this.sourcePath = sourcePath;
    }
    eq(other) {
      return this.outLinkText == other.outLinkText && this.outLinkMathLink == other.outLinkMathLink && this.isSourceMode == other.isSourceMode && this.sourcePath == other.sourcePath;
    }
    toDOM() {
      let mathLink = createSpan();
      setMathLink(this.outLinkMathLink, mathLink);
      if (!this.isSourceMode)
        mathLink.addClass("cm-underline");
      mathLink.setAttribute("draggable", "true");
      const linkpath = (0, import_obsidian4.getLinkpath)(this.outLinkText);
      const targetFile = plugin.app.metadataCache.getFirstLinkpathDest(linkpath, this.sourcePath);
      if (targetFile)
        addSuperCharged(plugin, mathLink, targetFile);
      let mathLinkWrapper = createSpan();
      mathLinkWrapper.addClass("cm-hmd-internal-link");
      mathLinkWrapper.appendChild(mathLink);
      mathLinkWrapper.onclick = (evt) => {
        evt.preventDefault();
        if (targetFile) {
          plugin.app.workspace.openLinkText(this.outLinkText, this.sourcePath, import_obsidian4.Keymap.isModEvent(evt));
        } else {
          self.open(this.outLinkText, "_blank", "noreferrer");
        }
      };
      mathLinkWrapper.onmousedown = (evt) => {
        if (evt.button == 1) {
          evt.preventDefault();
        }
      };
      mathLinkWrapper.onauxclick = (evt) => {
        if (evt.button == 1) {
          if (targetFile) {
            plugin.app.workspace.openLinkText(this.outLinkText, this.sourcePath, true);
          } else {
            self.open(this.outLinkText, "_blank", "noreferrer");
          }
        }
      };
      return mathLinkWrapper;
    }
  }
  const mathLinksViewPlugin = import_view.ViewPlugin.fromClass(class {
    constructor(view) {
      this.decorations = this.buildDecorations(view);
    }
    buildDecorations(view) {
      var _a, _b;
      if (!view.state.field(import_obsidian4.editorLivePreviewField) && !plugin.enableInSourceMode()) {
        return import_view.Decoration.none;
      }
      const sourcePath = (_b = (_a = view.state.field(import_obsidian4.editorInfoField).file) == null ? void 0 : _a.path) != null ? _b : "";
      const isSourceMode = !view.state.field(import_obsidian4.editorLivePreviewField);
      const info = view.state.field(mathLinkInfoField);
      const builder = new import_state.RangeSetBuilder();
      const selection = view.state.selection;
      for (const { from, to } of view.visibleRanges) {
        info.between(from, to, (start, end, { linkText, mathLink }) => {
          if (!selectionAndRangeOverlap(selection, start, end)) {
            builder.add(start, end, import_view.Decoration.widget({
              widget: new MathWidget(linkText, mathLink, isSourceMode, sourcePath)
            }));
          }
        });
      }
      return builder.finish();
    }
    update(update2) {
      if (!update2.state.field(import_obsidian4.editorLivePreviewField) && !plugin.enableInSourceMode()) {
        this.decorations = import_view.Decoration.none;
      }
      if (update2.transactions.some((tr) => hasEffect(tr, forceUpdateEffect))) {
        this.decorations = this.buildDecorations(update2.view);
      } else if (update2.docChanged) {
        this.decorations = this.decorations.map(update2.changes);
        this.updateDecorations(update2.view);
      } else if (update2.selectionSet) {
        this.updateDecorations(update2.view);
      } else if (update2.viewportChanged) {
        this.decorations = this.buildDecorations(update2.view);
      }
    }
    updateDecorations(view) {
      var _a;
      const file = view.state.field(import_obsidian4.editorInfoField).file;
      const sourcePath = (_a = file == null ? void 0 : file.path) != null ? _a : "";
      const isSourceMode = !view.state.field(import_obsidian4.editorLivePreviewField);
      const info = view.state.field(mathLinkInfoField);
      const selection = view.state.selection;
      for (const { from, to } of view.visibleRanges) {
        info.between(from, to, (start, end, value) => {
          const overlap = selectionAndRangeOverlap(selection, start, end);
          if (overlap) {
            this.removeDeco(start, end);
            return;
          } else {
            this.addDeco(start, end, value, isSourceMode, sourcePath);
          }
        });
      }
    }
    removeDeco(start, end) {
      this.decorations.between(start, end, (from, to) => {
        this.decorations = this.decorations.update({
          filterFrom: from,
          filterTo: to,
          filter: () => false
        });
      });
    }
    addDeco(start, end, value, isSourceMode, sourcePath) {
      let exists = false;
      this.decorations.between(start, end, () => {
        exists = true;
      });
      if (!exists) {
        this.decorations = this.decorations.update({
          add: [
            {
              from: start,
              to: end,
              value: import_view.Decoration.widget({
                widget: new MathWidget(value.linkText, value.mathLink, isSourceMode, sourcePath)
              })
            }
          ]
        });
      }
    }
  }, {
    decorations: (instance) => instance.decorations
  });
  return [mathLinkInfoField, mathLinksViewPlugin];
};

// src/main.ts
var import_obsidian8 = require("obsidian");

// src/settings/settings.ts
var DEFAULT_SETTINGS = {
  templates: [],
  excludedPaths: [],
  blockPrefix: "^",
  enableFileNameBlockLinks: true,
  enableInSourceMode: false
};

// src/settings/tab.ts
var import_obsidian6 = require("obsidian");

// src/settings/modals.ts
var import_obsidian5 = require("obsidian");
var TemplatesModal = class extends import_obsidian5.Modal {
  constructor(app, plugin) {
    super(app);
    this.plugin = plugin;
  }
  onOpen() {
    this.display();
  }
  display() {
    return __async(this, null, function* () {
      const { contentEl } = this;
      contentEl.empty();
      contentEl.createEl("h4", { text: "Add/Edit Templates" });
      new import_obsidian5.Setting(contentEl).setName(createFragment((e) => {
        e.createSpan({ text: "The templates in the list below are sorted by precedence, with the top being replaced first. Note that " });
        e.createEl("code", { text: "a" });
        e.createSpan({ text: " > " });
        e.createEl("code", { text: "b" });
        e.createSpan({ text: " followed by " });
        e.createEl("code", { text: "b" });
        e.createSpan({ text: " > " });
        e.createEl("code", { text: "c" });
        e.createSpan({ text: " together is equivalent to " });
        e.createEl("code", { text: "a" });
        e.createSpan({ text: " > " });
        e.createEl("code", { text: "c" });
        e.createSpan({ text: ", but not the other way around." });
      })).addButton((btn) => {
        btn.setTooltip("Add").setIcon("plus").onClick((event) => {
          let newTemplate = { replaced: "", replacement: "", globalMatch: true, sensitive: true, word: true };
          new TemplateSettingsModal(this.app, this.plugin, this, newTemplate, true).open();
        });
      });
      if (this.plugin.settings.templates.length) {
        let list = contentEl.createEl("ul");
        for (let i = 0; i < this.plugin.settings.templates.length; i++) {
          let template = this.plugin.settings.templates[i];
          let item = list.createEl("li").createDiv();
          new import_obsidian5.Setting(item).setName(createFragment((e) => {
            e.createEl("code", { text: template.replaced });
            e.createSpan({ text: " > " });
            e.createEl("code", { text: template.replacement });
          })).addExtraButton((button) => {
            return button.setTooltip("Move up").setIcon("up-arrow-with-tail").onClick(() => __async(this, null, function* () {
              if (i != 0) {
                let down = __spreadValues({}, template);
                let up = this.plugin.settings.templates[i - 1];
                this.plugin.settings.templates[i] = up;
                this.plugin.settings.templates[i - 1] = down;
                yield this.plugin.saveSettings().then(() => {
                  this.display();
                });
              }
            }));
          }).addExtraButton((button) => {
            return button.setTooltip("Move down").setIcon("down-arrow-with-tail").onClick(() => __async(this, null, function* () {
              if (i != this.plugin.settings.templates.length - 1) {
                let up = __spreadValues({}, template);
                let down = this.plugin.settings.templates[i + 1];
                this.plugin.settings.templates[i] = down;
                this.plugin.settings.templates[i + 1] = up;
                yield this.plugin.saveSettings().then(() => {
                  this.display();
                });
              }
            }));
          }).addExtraButton((button) => {
            return button.setTooltip("Edit").setIcon("edit").onClick(() => __async(this, null, function* () {
              let modal = new TemplateSettingsModal(this.app, this.plugin, this, template, false);
              modal.open();
              modal.onClose = () => __async(this, null, function* () {
                yield this.plugin.saveSettings().then(() => {
                  this.display();
                });
              });
            }));
          }).addExtraButton((button) => {
            return button.setTooltip("Remove").setIcon("x").onClick(() => __async(this, null, function* () {
              this.plugin.settings.templates.remove(template);
              yield this.plugin.saveSettings().then(() => {
                this.display();
              });
            }));
          });
        }
      }
    });
  }
};
var TemplateSettingsModal = class extends import_obsidian5.Modal {
  constructor(app, plugin, modal, template, create) {
    super(app);
    this.plugin = plugin;
    this.modal = modal;
    this.template = template;
    this.create = create;
  }
  onOpen() {
    this.display();
  }
  display() {
    return __async(this, null, function* () {
      const { contentEl } = this;
      contentEl.empty();
      let replacedText;
      new import_obsidian5.Setting(contentEl).setName("Match for...").setDesc("String to be matched and replaced. Do not include regex.").addText((text) => {
        replacedText = text;
        replacedText.setValue(this.template.replaced).onChange((current) => {
          this.template.replaced = current;
        });
      });
      let replacementText;
      new import_obsidian5.Setting(contentEl).setName("Replace with...").setDesc("String to replace matches. Do not escape backslashes.").addText((text) => {
        replacementText = text;
        replacementText.setValue(this.template.replacement).onChange((current) => {
          this.template.replacement = current;
        });
      });
      new import_obsidian5.Setting(contentEl).setName("Global match").setDesc("Match all instances (instead of just the first).").addToggle((toggle) => {
        toggle.setValue(this.template.globalMatch).onChange((current) => this.template.globalMatch = current);
      });
      new import_obsidian5.Setting(contentEl).setName("Case sensitive").setDesc("Matches will be case sensitive.").addToggle((toggle) => {
        toggle.setValue(this.template.sensitive).onChange((current) => this.template.sensitive = current);
      });
      new import_obsidian5.Setting(contentEl).setName("Match whole words").setDesc("Only match whole words.").addToggle((toggle) => {
        toggle.setValue(this.template.word).onChange((current) => this.template.word = current);
      });
      new import_obsidian5.Setting(contentEl).addButton((b) => {
        b.setTooltip(this.create ? "Add" : "Save").setIcon("checkmark").onClick(() => __async(this, null, function* () {
          if (this.template.replaced == "") {
            new import_obsidian5.Notice("MathLinks: Please enter a non-empty string to be replaced");
          } else {
            if (this.create)
              this.plugin.settings.templates.push(this.template);
            yield this.plugin.saveSettings().then(() => {
              this.close();
              this.modal.display();
            });
          }
        }));
      }).addExtraButton((b) => {
        b.setTooltip("Cancel").setIcon("cross").onClick(() => __async(this, null, function* () {
          this.close();
        }));
      });
    });
  }
};
var ExcludeModal = class extends import_obsidian5.Modal {
  constructor(app, plugin) {
    super(app);
    this.plugin = plugin;
  }
  onOpen() {
    this.display();
  }
  display() {
    return __async(this, null, function* () {
      const { contentEl } = this;
      contentEl.empty();
      contentEl.createEl("h4", { text: "Excluded files" });
      new import_obsidian5.Setting(contentEl).setName("The files/folders in this list will be ignored by MathLinks.").addButton((btn) => {
        btn.setTooltip("Add").setIcon("plus").onClick((event) => {
          new FileExcludeSuggestModal(this.app, this.plugin, this).open();
        });
      });
      if (this.plugin.settings.excludedPaths.length) {
        let list = contentEl.createEl("ul");
        for (let path of this.plugin.settings.excludedPaths) {
          let item = list.createEl("li").createDiv();
          new import_obsidian5.Setting(item).setName(path).addExtraButton((button) => {
            return button.setTooltip("Remove").setIcon("x").onClick(() => __async(this, null, function* () {
              this.plugin.settings.excludedPaths.remove(path);
              yield this.plugin.saveSettings().then(() => {
                this.display();
              });
            }));
          });
        }
      }
    });
  }
};
var FileSuggestModal = class extends import_obsidian5.FuzzySuggestModal {
  constructor(app, plugin) {
    super(app);
    this.plugin = plugin;
  }
  getItems() {
    return this.app.vault.getAllLoadedFiles().filter(this.filterCallback.bind(this));
  }
  getItemText(file) {
    return file.path;
  }
  filterCallback(abstractFile) {
    if (abstractFile instanceof import_obsidian5.TFile && abstractFile.extension != "md")
      return false;
    if (abstractFile instanceof import_obsidian5.TFolder && abstractFile.isRoot())
      return false;
    for (const path of this.plugin.settings.excludedPaths) {
      const file = this.app.vault.getAbstractFileByPath(path);
      if (file && isEqualToOrChildOf(abstractFile, file)) {
        return false;
      }
    }
    return true;
  }
};
var FileExcludeSuggestModal = class extends FileSuggestModal {
  constructor(app, plugin, modal) {
    super(app, plugin);
    this.modal = modal;
  }
  onChooseItem(file, evt) {
    return __async(this, null, function* () {
      this.plugin.settings.excludedPaths.push(file.path);
      yield this.plugin.saveSettings().then(() => {
        this.modal.display();
      });
    });
  }
};

// src/settings/tab.ts
var MathLinksSettingTab = class extends import_obsidian6.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    return __async(this, null, function* () {
      const { containerEl } = this;
      containerEl.empty();
      containerEl.createEl("h2", { text: "MathLinks Settings" });
      new import_obsidian6.Setting(containerEl).setName("Templates").setDesc(createFragment((e) => {
        e.createSpan({ text: "Generate mathLinks with a template. Use " });
        e.createEl("code", { text: "mathLink: auto" });
        e.createSpan({ text: " to use templates in a file." });
      })).addButton((button) => {
        return button.setButtonText("Manage").onClick(() => __async(this, null, function* () {
          let modal = new TemplatesModal(this.app, this.plugin);
          modal.open();
          modal.onClose = () => __async(this, null, function* () {
            yield this.plugin.saveSettings().then(() => {
              this.display();
            });
          });
        }));
      });
      new import_obsidian6.Setting(containerEl).setName("Excluded files").setDesc("Manage files/paths that MathLinks will ignore.").addButton((button) => {
        return button.setButtonText("Manage").onClick(() => __async(this, null, function* () {
          let modal = new ExcludeModal(this.app, this.plugin);
          modal.open();
          modal.onClose = () => __async(this, null, function* () {
            yield this.plugin.saveSettings().then(() => {
              this.display();
            });
          });
        }));
      });
      let prefix;
      new import_obsidian6.Setting(containerEl).setName("Edit prefix for block links").setDesc(createFragment((e) => {
        e.createSpan({ text: "Links like " });
        e.createEl("code", { text: "note#^block-id" });
        e.createSpan({ text: " will be rendered as" });
        if (this.plugin.settings.enableFileNameBlockLinks) {
          e.createEl("code", { text: "note > " + this.plugin.settings.blockPrefix + "block-id" });
        } else {
          e.createEl("code", { text: this.plugin.settings.blockPrefix + "block-id" });
        }
        e.createSpan({ text: "." });
      })).addText((text) => {
        prefix = text;
        prefix.setValue(this.plugin.settings.blockPrefix).onChange((current) => __async(this, null, function* () {
          this.plugin.settings.blockPrefix = current;
          yield this.plugin.saveSettings();
        }));
        prefix.setPlaceholder("No prefix (default: ^)");
      }).addToggle((toggle) => {
        toggle.setValue(this.plugin.settings.enableFileNameBlockLinks).onChange((value) => __async(this, null, function* () {
          this.plugin.settings.enableFileNameBlockLinks = value;
          yield this.plugin.saveSettings().then(() => {
            this.display();
          });
        }));
        toggle.setTooltip("Disable to ignore note name.");
      });
      new import_obsidian6.Setting(containerEl).setName("Enable in Source mode").setDesc("Currently, only wikilinks are supported in Source mode.").addToggle((toggle) => {
        toggle.setValue(this.plugin.nativeProvider.enableInSourceMode).onChange((value) => {
          this.plugin.nativeProvider.enableInSourceMode = value;
        });
      });
    });
  }
};

// src/api/deprecated.ts
var MathLinksAPIAccount = class {
  constructor(plugin, manifest, blockPrefix, prefixer) {
    this.plugin = plugin;
    this.manifest = manifest;
    this.blockPrefix = blockPrefix;
    this.prefixer = prefixer;
    this.metadataSet = /* @__PURE__ */ new Map();
  }
  get(file, blockID) {
    let metadata = this.metadataSet.get(file);
    if (metadata) {
      if (blockID === void 0) {
        return metadata["mathLink"];
      }
      let blocks = metadata["mathLink-blocks"];
      if (blocks) {
        return blocks[blockID];
      }
    }
  }
  update(file, newMetadata) {
    if (file.extension == "md") {
      this.metadataSet.set(file, Object.assign({}, this.metadataSet.get(file), newMetadata));
      informChange(this.plugin.app, "mathlinks:update", file);
    } else {
      throw Error(`MathLinks API: ${this.manifest.name} passed a non-markdown file ${file.path} to update().`);
    }
  }
  delete(file, which) {
    let metadata = this.metadataSet.get(file);
    if (metadata) {
      if (which === void 0) {
        this.metadataSet.delete(file);
      } else if (which == "mathLink" || which == "mathLink-blocks") {
        if (metadata[which] !== void 0) {
          delete metadata[which];
        } else {
          throw Error(`MathLinks API: ${this.manifest.name} attempted to delete ${which} of ${file.path}, but it does not exist.`);
        }
      } else {
        let blocks = metadata["mathLink-blocks"];
        if (blocks && blocks[which] !== void 0) {
          delete blocks[which];
        } else {
          throw Error(`MathLinks API: ${this.manifest.name} attempted to delete mathLink-blocks for ${file.path}#^${which}", but it does not exist`);
        }
      }
    } else {
      throw Error(`MathLinks API: ${this.manifest.name} attempted to delete the MathLinks metadata of ${file.path}, but it does not exist.`);
    }
    informChange(this.plugin.app, "mathlinks:update", file);
  }
};

// src/links/reading.ts
var import_obsidian7 = require("obsidian");
var MathLinksRenderChild = class extends import_obsidian7.MarkdownRenderChild {
  constructor(containerEl, plugin, sourcePath, targetLink, displayText) {
    var _a;
    super(containerEl);
    this.plugin = plugin;
    this.sourcePath = sourcePath;
    this.targetLink = targetLink;
    this.displayText = displayText;
    this.targetFile = this.plugin.app.metadataCache.getFirstLinkpathDest((0, import_obsidian7.getLinkpath)(this.targetLink), this.sourcePath);
    this.mathLinkEl = this.containerEl.cloneNode(true);
    this.mathLinkEl.textContent = "";
    (_a = this.containerEl.parentNode) == null ? void 0 : _a.insertBefore(this.mathLinkEl, this.containerEl.nextSibling);
    this.mathLinkEl.classList.add("mathLink-internal-link");
    this.containerEl.classList.add("original-internal-link");
    this.containerEl.classList.remove("internal-link");
    this.containerEl.style.display = "none";
    this.getMathLink = this.setMathLinkGetter();
  }
  onload() {
    this.update();
    this.registerEvent(this.plugin.app.metadataCache.on("mathlinks:update", (changedFile) => {
      if (!this.targetFile || this.targetFile == changedFile) {
        this.update();
      }
    }));
    this.registerEvent(this.plugin.app.metadataCache.on("mathlinks:update-all", () => {
      this.update();
    }));
  }
  setMathLinkGetter() {
    var _a, _b;
    let getter = () => "";
    if (this.displayText != this.targetLink && this.displayText != translateLink(this.targetLink)) {
      getter = () => this.displayText;
    } else {
      if (this.displayText == ((_a = this.targetFile) == null ? void 0 : _a.name) || this.displayText == ((_b = this.targetFile) == null ? void 0 : _b.basename) || this.displayText == translateLink(this.targetLink)) {
        getter = () => getMathLink(this.plugin, this.targetLink, this.sourcePath);
      }
    }
    return getter;
  }
  update() {
    const mathLink = this.getMathLink();
    if (mathLink) {
      setMathLink(mathLink, this.mathLinkEl);
    } else {
      setMathLink(this.displayText, this.mathLinkEl);
    }
  }
};
function generateMathLinks(plugin, element, context) {
  var _a, _b;
  for (let targetEl of element.querySelectorAll(".internal-link")) {
    if (targetEl.classList.contains("mathLink-internal-link")) {
      targetEl.remove();
      let queryResult = element.querySelector(".original-internal-link");
      if (queryResult) {
        targetEl = queryResult;
        targetEl.classList.remove("original-internal-link");
        targetEl.style.display = "";
      }
    }
    const targetDisplay = (_a = targetEl.textContent) == null ? void 0 : _a.trim().replace(/\.md/, "");
    if (targetDisplay != "" && !/math-inline is-loaded/.test(targetEl.innerHTML)) {
      const targetLink = (_b = targetEl.getAttribute("data-href")) == null ? void 0 : _b.replace(/\.md/, "");
      if (targetLink) {
        const targetFile = plugin.app.metadataCache.getFirstLinkpathDest((0, import_obsidian7.getLinkpath)(targetLink), context.sourcePath);
        if (targetDisplay && targetFile) {
          const child = new MathLinksRenderChild(targetEl, plugin, context.sourcePath, targetLink, targetDisplay);
          context.addChild(child);
        }
      }
    }
  }
}

// node_modules/monkey-around/mjs/index.js
function around(obj, factories) {
  const removers = Object.keys(factories).map((key) => around1(obj, key, factories[key]));
  return removers.length === 1 ? removers[0] : function() {
    removers.forEach((r) => r());
  };
}
function around1(obj, method, createWrapper) {
  const original = obj[method], hadOwn = obj.hasOwnProperty(method);
  let current = createWrapper(original);
  if (original)
    Object.setPrototypeOf(current, original);
  Object.setPrototypeOf(wrapper, current);
  obj[method] = wrapper;
  return remove;
  function wrapper(...args) {
    if (current === original && obj[method] === wrapper)
      remove();
    return current.apply(this, args);
  }
  function remove() {
    if (obj[method] === wrapper) {
      if (hadOwn)
        obj[method] = original;
      else
        delete obj[method];
    }
    if (current === original)
      return;
    current = original;
    Object.setPrototypeOf(wrapper, original || Function);
  }
}

// src/outline.ts
var patchOutline = (plugin) => {
  var _a;
  const outlineView = (_a = plugin.app.workspace.getLeavesOfType("outline")[0]) == null ? void 0 : _a.view;
  if (!outlineView)
    return false;
  plugin.register(around(outlineView.constructor.prototype, {
    getItemDom(old) {
      return function(arg) {
        const ret = old.call(this, arg);
        setTimeout(() => setMathLink(ret.heading.heading, ret.innerEl), 10);
        return ret;
      };
    }
  }));
  return true;
};

// src/main.ts
var MathLinks = class extends import_obsidian8.Plugin {
  constructor() {
    super(...arguments);
    this.providers = [];
  }
  onload() {
    return __async(this, null, function* () {
      yield this.loadSettings();
      yield (0, import_obsidian8.loadMathJax)();
      this.nativeProvider = new NativeProvider(this);
      this.addChild(this.nativeProvider);
      this.registerProvider(this.nativeProvider, Infinity);
      this.registerMarkdownPostProcessor((element, context) => {
        let file = this.app.vault.getAbstractFileByPath(context.sourcePath);
        if (file && isExcluded(this, file)) {
          generateMathLinks(this, element, context);
        }
      });
      this.registerEditorExtension(createEditorExtensions(this));
      this.registerEvent(this.app.metadataCache.on("changed", (file) => update(this.app, file)));
      this.registerEvent(this.app.workspace.on("layout-change", () => update(this.app)));
      this.apiAccounts = [];
      this.app.workspace.onLayoutReady(() => {
        const success = patchOutline(this);
        if (!success) {
          const eventRef = this.app.workspace.on("layout-change", () => {
            const success2 = patchOutline(this);
            if (success2)
              this.app.workspace.offref(eventRef);
          });
          this.registerEvent(eventRef);
        }
      });
    });
  }
  getAPIAccount(userPlugin) {
    let account = this.apiAccounts.find((account2) => account2.manifest.id == userPlugin.manifest.id);
    if (account)
      return account;
    account = new MathLinksAPIAccount(this, userPlugin.manifest, DEFAULT_SETTINGS.blockPrefix, () => null);
    this.apiAccounts.push(account);
    const provider = new DeprecatedAPIProvider(account);
    userPlugin.addChild(provider);
    this.registerProvider(provider);
    return account;
  }
  loadSettings() {
    return __async(this, null, function* () {
      this.settings = Object.assign({}, DEFAULT_SETTINGS, yield this.loadData());
      this.addSettingTab(new MathLinksSettingTab(this.app, this));
    });
  }
  saveSettings() {
    return __async(this, null, function* () {
      yield this.saveData(this.settings);
    });
  }
  registerProvider(provider, sortOrder) {
    var _a;
    (_a = this.providers.find((another) => another.provider === provider)) != null ? _a : this.providers.push({ provider, sortOrder: sortOrder != null ? sortOrder : 0 });
  }
  iterateProviders(callback) {
    this.providers.sort((p1, p2) => p1.sortOrder - p2.sortOrder).forEach(({ provider }) => callback(provider));
  }
  enableInSourceMode() {
    return this.providers.some(({ provider }) => provider.enableInSourceMode);
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL21haW4udHMiLCAic3JjL2xpbmtzL3ByZXZpZXcudHMiLCAic3JjL2FwaS9wcm92aWRlci50cyIsICJzcmMvdXRpbHMudHMiLCAic3JjL2FwaS9pbmRleC50cyIsICJzcmMvbGlua3MvaGVscGVyLnRzIiwgInNyYy9saW5rcy9zdXBlcmNoYXJnZWQudHMiLCAic3JjL3NldHRpbmdzL3NldHRpbmdzLnRzIiwgInNyYy9zZXR0aW5ncy90YWIudHMiLCAic3JjL3NldHRpbmdzL21vZGFscy50cyIsICJzcmMvYXBpL2RlcHJlY2F0ZWQudHMiLCAic3JjL2xpbmtzL3JlYWRpbmcudHMiLCAibm9kZV9tb2R1bGVzL21vbmtleS1hcm91bmQvbWpzL2luZGV4LmpzIiwgInNyYy9vdXRsaW5lLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQgeyBjcmVhdGVFZGl0b3JFeHRlbnNpb25zIH0gZnJvbSAnLi9saW5rcy9wcmV2aWV3JztcbmltcG9ydCB7IFBsdWdpbiwgbG9hZE1hdGhKYXggfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IE1hdGhMaW5rc1NldHRpbmdzLCBERUZBVUxUX1NFVFRJTkdTIH0gZnJvbSBcIi4vc2V0dGluZ3Mvc2V0dGluZ3NcIjtcbmltcG9ydCB7IE1hdGhMaW5rc1NldHRpbmdUYWIgfSBmcm9tIFwiLi9zZXR0aW5ncy90YWJcIlxuaW1wb3J0IHsgTWF0aExpbmtzQVBJQWNjb3VudCB9IGZyb20gXCIuL2FwaS9kZXByZWNhdGVkXCI7XG5pbXBvcnQgeyBEZXByZWNhdGVkQVBJUHJvdmlkZXIsIE5hdGl2ZVByb3ZpZGVyLCBQcm92aWRlciB9IGZyb20gXCIuL2FwaS9wcm92aWRlclwiO1xuaW1wb3J0IHsgZ2VuZXJhdGVNYXRoTGlua3MgfSBmcm9tIFwiLi9saW5rcy9yZWFkaW5nXCI7XG5pbXBvcnQgeyBpc0V4Y2x1ZGVkIH0gZnJvbSBcIi4vdXRpbHNcIjtcbmltcG9ydCB7IHVwZGF0ZSB9IGZyb20gJy4vYXBpJztcbmltcG9ydCB7IHBhdGNoT3V0bGluZSB9IGZyb20gJy4vb3V0bGluZSc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1hdGhMaW5rcyBleHRlbmRzIFBsdWdpbiB7XG4gICAgc2V0dGluZ3M6IE1hdGhMaW5rc1NldHRpbmdzO1xuICAgIGFwaUFjY291bnRzOiBNYXRoTGlua3NBUElBY2NvdW50W107XG4gICAgcHJvdmlkZXJzOiB7IHByb3ZpZGVyOiBQcm92aWRlciwgc29ydE9yZGVyOiBudW1iZXIgfVtdID0gW107XG4gICAgbmF0aXZlUHJvdmlkZXI6IE5hdGl2ZVByb3ZpZGVyO1xuXG4gICAgYXN5bmMgb25sb2FkKCkge1xuICAgICAgICBhd2FpdCB0aGlzLmxvYWRTZXR0aW5ncygpO1xuICAgICAgICBhd2FpdCBsb2FkTWF0aEpheCgpO1xuXG4gICAgICAgIHRoaXMubmF0aXZlUHJvdmlkZXIgPSBuZXcgTmF0aXZlUHJvdmlkZXIodGhpcyk7XG4gICAgICAgIHRoaXMuYWRkQ2hpbGQodGhpcy5uYXRpdmVQcm92aWRlcik7XG4gICAgICAgIHRoaXMucmVnaXN0ZXJQcm92aWRlcih0aGlzLm5hdGl2ZVByb3ZpZGVyLCBJbmZpbml0eSk7XG5cbiAgICAgICAgLy8gTWFya2Rvd24gUG9zdCBQcm9jZXNzb3IgZm9yIHJlYWRpbmcgdmlld1xuICAgICAgICB0aGlzLnJlZ2lzdGVyTWFya2Rvd25Qb3N0UHJvY2Vzc29yKChlbGVtZW50LCBjb250ZXh0KSA9PiB7XG4gICAgICAgICAgICBsZXQgZmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChjb250ZXh0LnNvdXJjZVBhdGgpO1xuICAgICAgICAgICAgaWYgKGZpbGUgJiYgaXNFeGNsdWRlZCh0aGlzLCBmaWxlKSkge1xuICAgICAgICAgICAgICAgIGdlbmVyYXRlTWF0aExpbmtzKHRoaXMsIGVsZW1lbnQsIGNvbnRleHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnJlZ2lzdGVyRWRpdG9yRXh0ZW5zaW9uKGNyZWF0ZUVkaXRvckV4dGVuc2lvbnModGhpcykpO1xuXG4gICAgICAgIHRoaXMucmVnaXN0ZXJFdmVudCh0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLm9uKCdjaGFuZ2VkJywgZmlsZSA9PiB1cGRhdGUodGhpcy5hcHAsIGZpbGUpKSk7XG4gICAgICAgIC8vIEZvcmNlLXVwZGF0ZSB3aGVuIHN3aXRjaGluZyBiZXR3ZWVuIFJlYWRpbmcgJiBFZGl0aW5nIHZpZXdzXG4gICAgICAgIHRoaXMucmVnaXN0ZXJFdmVudCh0aGlzLmFwcC53b3Jrc3BhY2Uub24oJ2xheW91dC1jaGFuZ2UnLCAoKSA9PiB1cGRhdGUodGhpcy5hcHApKSk7XG5cbiAgICAgICAgdGhpcy5hcGlBY2NvdW50cyA9IFtdO1xuXG4gICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS96aGFvc2hlbnpoYWkvb2JzaWRpYW4tbWF0aGxpbmtzL2lzc3Vlcy81NVxuICAgICAgICAvLyBQYXRjaCB0aGUgY29yZSBPdXRsaW5lIHZpZXcgdG8gcmVuZGVyIE1hdGhKYXggaW4gaXRcbiAgICAgICAgdGhpcy5hcHAud29ya3NwYWNlLm9uTGF5b3V0UmVhZHkoKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgc3VjY2VzcyA9IHBhdGNoT3V0bGluZSh0aGlzKTtcbiAgICAgICAgICAgIGlmICghc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50UmVmID0gdGhpcy5hcHAud29ya3NwYWNlLm9uKCdsYXlvdXQtY2hhbmdlJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzdWNjZXNzID0gcGF0Y2hPdXRsaW5lKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc3VjY2VzcykgdGhpcy5hcHAud29ya3NwYWNlLm9mZnJlZihldmVudFJlZik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5yZWdpc3RlckV2ZW50KGV2ZW50UmVmKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZ2V0QVBJQWNjb3VudCh1c2VyUGx1Z2luOiBSZWFkb25seTxQbHVnaW4+KTogTWF0aExpbmtzQVBJQWNjb3VudCB7XG4gICAgICAgIGxldCBhY2NvdW50ID0gdGhpcy5hcGlBY2NvdW50cy5maW5kKChhY2NvdW50KSA9PiBhY2NvdW50Lm1hbmlmZXN0LmlkID09IHVzZXJQbHVnaW4ubWFuaWZlc3QuaWQpO1xuICAgICAgICBpZiAoYWNjb3VudCkgcmV0dXJuIGFjY291bnQ7XG5cbiAgICAgICAgYWNjb3VudCA9IG5ldyBNYXRoTGlua3NBUElBY2NvdW50KHRoaXMsIHVzZXJQbHVnaW4ubWFuaWZlc3QsIERFRkFVTFRfU0VUVElOR1MuYmxvY2tQcmVmaXgsICgpID0+IG51bGwpO1xuICAgICAgICB0aGlzLmFwaUFjY291bnRzLnB1c2goYWNjb3VudCk7XG5cbiAgICAgICAgY29uc3QgcHJvdmlkZXIgPSBuZXcgRGVwcmVjYXRlZEFQSVByb3ZpZGVyKGFjY291bnQpO1xuICAgICAgICB1c2VyUGx1Z2luLmFkZENoaWxkKHByb3ZpZGVyKTtcbiAgICAgICAgdGhpcy5yZWdpc3RlclByb3ZpZGVyKHByb3ZpZGVyKTtcblxuICAgICAgICByZXR1cm4gYWNjb3VudDtcbiAgICB9XG5cbiAgICBhc3luYyBsb2FkU2V0dGluZ3MoKSB7XG4gICAgICAgIHRoaXMuc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1NFVFRJTkdTLCBhd2FpdCB0aGlzLmxvYWREYXRhKCkpO1xuICAgICAgICB0aGlzLmFkZFNldHRpbmdUYWIobmV3IE1hdGhMaW5rc1NldHRpbmdUYWIodGhpcy5hcHAsIHRoaXMpKTtcbiAgICB9XG5cbiAgICBhc3luYyBzYXZlU2V0dGluZ3MoKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuc2F2ZURhdGEodGhpcy5zZXR0aW5ncyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHByb3ZpZGVyIFxuICAgICAqIEBwYXJhbSBzb3J0T3JkZXIgLSBBbiBvcHRpb25hbCBpbnRlZ2VyIHNvcnQgb3JkZXIuIERlZmF1bHRzIHRvIDAuIExvd2VyIG51bWJlciBydW5zIGJlZm9yZSBoaWdoZXIgbnVtYmVycy5cbiAgICAgKi9cbiAgICByZWdpc3RlclByb3ZpZGVyKHByb3ZpZGVyOiBQcm92aWRlciwgc29ydE9yZGVyPzogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMucHJvdmlkZXJzLmZpbmQoYW5vdGhlciA9PiBhbm90aGVyLnByb3ZpZGVyID09PSBwcm92aWRlcilcbiAgICAgICAgICAgID8/IHRoaXMucHJvdmlkZXJzLnB1c2goeyBwcm92aWRlciwgc29ydE9yZGVyOiBzb3J0T3JkZXIgPz8gMCB9KTtcbiAgICB9XG5cbiAgICBpdGVyYXRlUHJvdmlkZXJzKGNhbGxiYWNrOiAocHJvdmlkZXI6IFByb3ZpZGVyKSA9PiBhbnkpIHtcbiAgICAgICAgdGhpcy5wcm92aWRlcnNcbiAgICAgICAgICAgIC5zb3J0KChwMSwgcDIpID0+IHAxLnNvcnRPcmRlciAtIHAyLnNvcnRPcmRlcilcbiAgICAgICAgICAgIC5mb3JFYWNoKCh7IHByb3ZpZGVyIH0pID0+IGNhbGxiYWNrKHByb3ZpZGVyKSk7XG4gICAgfVxuXG4gICAgZW5hYmxlSW5Tb3VyY2VNb2RlKCk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gdGhpcy5wcm92aWRlcnMuc29tZSgoeyBwcm92aWRlciB9KSA9PiBwcm92aWRlci5lbmFibGVJblNvdXJjZU1vZGUpO1xuICAgIH1cbn1cbiIsICIvKipcbiAqIEluc3BpcmVkIGJ5ICYgYWRhcHRlZCBmcm9tIERhdGF2aWV3J3MgaW5saW5lIGZpZWxkcyByZW5kZXJpbmcgZmVhdHVyZTpcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ibGFja3NtaXRoZ3Uvb2JzaWRpYW4tZGF0YXZpZXcvYmxvYi9iMDBiZWI3NTk2Zjk5MjZjYTk1NzljNmYzMTkzNDFjZWFlNGY1YjVlL3NyYy91aS92aWV3cy9pbmxpbmUtZmllbGQtbGl2ZS1wcmV2aWV3LnRzXG4gKiBcbiAqIFRoZSBvcmlnaW5hbCB3b3JrIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZTpcbiAqIFxuICogTUlUIExpY2Vuc2VcbiAqIFxuICogQ29weXJpZ2h0IChjKSAyMDIxIE1pY2hhZWwgQnJlbmFuXG4gKiBcbiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbiAqIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbiAqIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbiAqIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuICogZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcbiAqIFxuICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsXG4gKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuICogXG4gKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG4gKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFXG4gKiBTT0ZUV0FSRS5cbiAqL1xuXG5pbXBvcnQgeyBLZXltYXAsIGVkaXRvckluZm9GaWVsZCwgZWRpdG9yTGl2ZVByZXZpZXdGaWVsZCwgZ2V0TGlua3BhdGggfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IFRyYW5zYWN0aW9uLCBFZGl0b3JTdGF0ZSwgUmFuZ2VTZXQsIFJhbmdlU2V0QnVpbGRlciwgUmFuZ2VWYWx1ZSwgU3RhdGVFZmZlY3QsIFN0YXRlRWZmZWN0VHlwZSwgU3RhdGVGaWVsZCwgRWRpdG9yU2VsZWN0aW9uLCBFeHRlbnNpb24gfSBmcm9tIFwiQGNvZGVtaXJyb3Ivc3RhdGVcIjtcbmltcG9ydCB7XG4gICAgRGVjb3JhdGlvbixcbiAgICBEZWNvcmF0aW9uU2V0LFxuICAgIEVkaXRvclZpZXcsXG4gICAgUGx1Z2luVmFsdWUsXG4gICAgVmlld1BsdWdpbixcbiAgICBWaWV3VXBkYXRlLFxuICAgIFdpZGdldFR5cGUsXG59IGZyb20gXCJAY29kZW1pcnJvci92aWV3XCI7XG5pbXBvcnQgTWF0aExpbmtzIGZyb20gJy4uL21haW4nO1xuaW1wb3J0IHsgc3ludGF4VHJlZSB9IGZyb20gXCJAY29kZW1pcnJvci9sYW5ndWFnZVwiO1xuaW1wb3J0IHsgZ2V0TWF0aExpbmssIHNldE1hdGhMaW5rIH0gZnJvbSBcIi4vaGVscGVyXCI7XG5pbXBvcnQgeyBhZGRTdXBlckNoYXJnZWQgfSBmcm9tIFwiLi9zdXBlcmNoYXJnZWRcIjtcblxuXG5mdW5jdGlvbiBzZWxlY3Rpb25BbmRSYW5nZU92ZXJsYXAoc2VsZWN0aW9uOiBFZGl0b3JTZWxlY3Rpb24sIHJhbmdlRnJvbTogbnVtYmVyLCByYW5nZVRvOiBudW1iZXIpOiBib29sZWFuIHtcbiAgICBmb3IgKGNvbnN0IHJhbmdlIG9mIHNlbGVjdGlvbi5yYW5nZXMpIHtcbiAgICAgICAgaWYgKHJhbmdlLmZyb20gPD0gcmFuZ2VUbyAmJiByYW5nZS50byA+PSByYW5nZUZyb20pIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cblxuZnVuY3Rpb24gaGFzRWZmZWN0PFQ+KHRyOiBUcmFuc2FjdGlvbiwgZWZmZWN0VHlwZTogU3RhdGVFZmZlY3RUeXBlPFQ+KTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRyLmVmZmVjdHMuc29tZShlZmZlY3QgPT4gZWZmZWN0LmlzKGVmZmVjdFR5cGUpKTtcbn1cblxuZXhwb3J0IGNvbnN0IGZvcmNlVXBkYXRlRWZmZWN0ID0gU3RhdGVFZmZlY3QuZGVmaW5lPG51bGw+KCk7XG5cbmNsYXNzIE1hdGhMaW5rSW5mbyBleHRlbmRzIFJhbmdlVmFsdWUge1xuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBsaW5rVGV4dDogc3RyaW5nLCBwdWJsaWMgbWF0aExpbms6IHN0cmluZykge1xuICAgICAgICBzdXBlcigpO1xuICAgIH1cblxuICAgIGVxKG90aGVyOiBNYXRoTGlua0luZm8pOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubGlua1RleHQgPT0gb3RoZXIubGlua1RleHQgJiYgdGhpcy5tYXRoTGluayA9PSBvdGhlci5tYXRoTGluaztcbiAgICB9XG59XG5cblxuZXhwb3J0IGNvbnN0IGNyZWF0ZUVkaXRvckV4dGVuc2lvbnMgPSAocGx1Z2luOiBNYXRoTGlua3MpOiBFeHRlbnNpb25bXSA9PiB7XG5cbiAgICBjb25zdCBidWlsZEZpZWxkID0gKHN0YXRlOiBFZGl0b3JTdGF0ZSk6IFJhbmdlU2V0PE1hdGhMaW5rSW5mbz4gPT4ge1xuICAgICAgICBsZXQgYnVpbGRlciA9IG5ldyBSYW5nZVNldEJ1aWxkZXI8TWF0aExpbmtJbmZvPigpO1xuICAgICAgICBjb25zdCBpc1NvdXJjZU1vZGUgPSAhc3RhdGUuZmllbGQoZWRpdG9yTGl2ZVByZXZpZXdGaWVsZCk7XG4gICAgICAgIGNvbnN0IGZpbGUgPSBzdGF0ZS5maWVsZChlZGl0b3JJbmZvRmllbGQpLmZpbGU7XG5cbiAgICAgICAgbGV0IHN0YXJ0ID0gLTEsIGVuZCA9IC0xLCBvdXRMaW5rVGV4dCA9IFwiXCIsIG91dExpbmtNYXRoTGluayA9IFwiXCI7XG5cbiAgICAgICAgc3ludGF4VHJlZShzdGF0ZSkuaXRlcmF0ZSh7XG4gICAgICAgICAgICBlbnRlcihub2RlKSB7XG4gICAgICAgICAgICAgICAgbGV0IG5hbWUgPSBub2RlLnR5cGUubmFtZTtcblxuICAgICAgICAgICAgICAgIC8vIFN0YXJ0XG4gICAgICAgICAgICAgICAgaWYgKG5hbWUuY29udGFpbnMoXCJmb3JtYXR0aW5nLWxpbmtfZm9ybWF0dGluZy1saW5rLXN0YXJ0XCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpc1NvdXJjZU1vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5zbGljZURvYyhub2RlLmZyb20sIG5vZGUudG8pID09IFwiW1tcIiAmJiBub2RlLm5vZGUubmV4dFNpYmxpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydCA9IG5vZGUubm9kZS5uZXh0U2libGluZy5mcm9tO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9ICAgIFxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQgPSBub2RlLmZyb207XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBTdGFydCAoY2hlY2sgdGhhdCBpdCBpcyBub3QgZW5kKVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKG5hbWUuY29udGFpbnMoXCJmb3JtYXR0aW5nX2Zvcm1hdHRpbmctbGlua19saW5rXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGFydCA9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQgPSBub2RlLmZyb207XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBBbGlhczogRmlsZSBuYW1lXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAobmFtZS5jb250YWlucyhcImhhcy1hbGlhc1wiKSkge1xuICAgICAgICAgICAgICAgICAgICBvdXRMaW5rVGV4dCArPSBzdGF0ZS5kb2Muc2xpY2VTdHJpbmcobm9kZS5mcm9tLCBub2RlLnRvKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGUgJiYgb3V0TGlua01hdGhMaW5rID09IG91dExpbmtUZXh0LnJlcGxhY2UoL1xcLm1kLywgXCJcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG91dExpbmtNYXRoTGluayA9IGdldE1hdGhMaW5rKHBsdWdpbiwgb3V0TGlua1RleHQsIGZpbGUucGF0aCwgaXNTb3VyY2VNb2RlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIEFsaWFzOiBGaWxlIG5hbWUgKHdpdGggZGVjb2RpbmcpXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoL3N0cmluZ191cmwkLy50ZXN0KG5hbWUpICYmICFuYW1lLmNvbnRhaW5zKFwiZm9ybWF0XCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIG91dExpbmtUZXh0ICs9IGRlY29kZVVSSShzdGF0ZS5kb2Muc2xpY2VTdHJpbmcobm9kZS5mcm9tLCBub2RlLnRvKSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWxlICYmIG91dExpbmtNYXRoTGluayA9PSBvdXRMaW5rVGV4dC5yZXBsYWNlKC9cXC5tZC8sIFwiXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvdXRMaW5rTWF0aExpbmsgPSBnZXRNYXRoTGluayhwbHVnaW4sIG91dExpbmtUZXh0LCBmaWxlLnBhdGgsIGlzU291cmNlTW9kZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBObyBhbGlhc1xuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGZpbGUgJiYgbmFtZS5jb250YWlucyhcImhtZC1pbnRlcm5hbC1saW5rXCIpICYmICFuYW1lLmNvbnRhaW5zKFwiYWxpYXNcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgb3V0TGlua1RleHQgKz0gc3RhdGUuZG9jLnNsaWNlU3RyaW5nKG5vZGUuZnJvbSwgbm9kZS50byk7XG4gICAgICAgICAgICAgICAgICAgIG91dExpbmtNYXRoTGluayA9IGdldE1hdGhMaW5rKHBsdWdpbiwgb3V0TGlua1RleHQsIGZpbGUucGF0aCwgaXNTb3VyY2VNb2RlKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBFbmRcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChuYW1lLmNvbnRhaW5zKFwiZm9ybWF0dGluZy1saW5rLWVuZFwiKSB8fCBuYW1lLmNvbnRhaW5zKFwiZm9ybWF0dGluZy1saW5rLXN0cmluZ1wiKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIW5hbWUuY29udGFpbnMoXCJlbmRcIikgJiYgZW5kID09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbmQgPSAtMjtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc1NvdXJjZU1vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5ub2RlLnByZXZTaWJsaW5nICYmIHN0YXRlLnNsaWNlRG9jKG5vZGUuZnJvbSwgbm9kZS50bykgPT0gXCJdXVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCA9IG5vZGUubm9kZS5wcmV2U2libGluZy50bztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQgPSBub2RlLnRvO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgY3Vyc29yUmFuZ2UgPSBzdGF0ZS5zZWxlY3Rpb24ubWFpbjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGFydCA+IGN1cnNvclJhbmdlLnRvIHx8IGVuZCA8IGN1cnNvclJhbmdlLmZyb20pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3V0TGlua1RleHQgJiYgb3V0TGlua01hdGhMaW5rKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1aWxkZXIuYWRkKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgTWF0aExpbmtJbmZvKG91dExpbmtUZXh0LCBvdXRMaW5rTWF0aExpbmsucmVwbGFjZSgvXFxcXFxcJC8sIFwiJFwiKSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQgPSAtMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVuZCA9IC0xO1xuICAgICAgICAgICAgICAgICAgICAgICAgb3V0TGlua1RleHQgPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgb3V0TGlua01hdGhMaW5rID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIEFsaWFzOiBNYXRoTGlua1xuICAgICAgICAgICAgICAgIGVsc2UgaWYgKCFuYW1lLmNvbnRhaW5zKFwicGlwZVwiKSAmJiAoKG5hbWUuY29udGFpbnMoXCJobWQtaW50ZXJuYWwtbGlua1wiKSAmJiBuYW1lLmNvbnRhaW5zKFwiYWxpYXNcIikpIHx8IChuYW1lLmNvbnRhaW5zKFwiaG1kLWVzY2FwZVwiKSAmJiBuYW1lLmNvbnRhaW5zKFwibGlua1wiKSkgfHwgL15saW5rLy50ZXN0KG5hbWUpKSkge1xuICAgICAgICAgICAgICAgICAgICBvdXRMaW5rTWF0aExpbmsgKz0gc3RhdGUuZG9jLnNsaWNlU3RyaW5nKG5vZGUuZnJvbSwgbm9kZS50byk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWxlICYmIG91dExpbmtNYXRoTGluayA9PSBvdXRMaW5rVGV4dC5yZXBsYWNlKC9cXC5tZC8sIFwiXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvdXRMaW5rTWF0aExpbmsgPSBnZXRNYXRoTGluayhwbHVnaW4sIG91dExpbmtUZXh0LCBmaWxlLnBhdGgsIGlzU291cmNlTW9kZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBidWlsZGVyLmZpbmlzaCgpO1xuICAgIH1cblxuXG4gICAgLyoqIEEgc3RhdGUgZmllbGQgdGhhdCBzdG9yZXMgbGlua3MgYW5kIHRoZWlyIHBvc2l0aW9ucyBhcyBhIHJhbmdlIHNldC4gKi9cbiAgICBjb25zdCBtYXRoTGlua0luZm9GaWVsZCA9IFN0YXRlRmllbGQuZGVmaW5lPFJhbmdlU2V0PE1hdGhMaW5rSW5mbz4+KHtcbiAgICAgICAgY3JlYXRlOiBidWlsZEZpZWxkLFxuICAgICAgICB1cGRhdGUob2xkRmllbGRzLCB0cikge1xuICAgICAgICAgICAgcmV0dXJuIHRyLmRvY0NoYW5nZWQgfHwgaGFzRWZmZWN0KHRyLCBmb3JjZVVwZGF0ZUVmZmVjdCkgPyBidWlsZEZpZWxkKHRyLnN0YXRlKSA6IG9sZEZpZWxkcztcbiAgICAgICAgfVxuICAgIH0pO1xuXG5cbiAgICBjbGFzcyBNYXRoV2lkZ2V0IGV4dGVuZHMgV2lkZ2V0VHlwZSB7XG4gICAgICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBvdXRMaW5rVGV4dDogc3RyaW5nLCBwdWJsaWMgb3V0TGlua01hdGhMaW5rOiBzdHJpbmcsIHB1YmxpYyBpc1NvdXJjZU1vZGU6IGJvb2xlYW4sIHB1YmxpYyBzb3VyY2VQYXRoOiBzdHJpbmcpIHsgc3VwZXIoKTsgfVxuXG4gICAgICAgIGVxKG90aGVyOiBNYXRoV2lkZ2V0KSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5vdXRMaW5rVGV4dCA9PSBvdGhlci5vdXRMaW5rVGV4dCAmJiB0aGlzLm91dExpbmtNYXRoTGluayA9PSBvdGhlci5vdXRMaW5rTWF0aExpbmsgJiYgdGhpcy5pc1NvdXJjZU1vZGUgPT0gb3RoZXIuaXNTb3VyY2VNb2RlICYmIHRoaXMuc291cmNlUGF0aCA9PSBvdGhlci5zb3VyY2VQYXRoO1xuICAgICAgICB9XG5cbiAgICAgICAgdG9ET00oKSB7XG4gICAgICAgICAgICBsZXQgbWF0aExpbmsgPSBjcmVhdGVTcGFuKCk7XG4gICAgICAgICAgICBzZXRNYXRoTGluayh0aGlzLm91dExpbmtNYXRoTGluaywgbWF0aExpbmspO1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlzU291cmNlTW9kZSkgbWF0aExpbmsuYWRkQ2xhc3MoXCJjbS11bmRlcmxpbmVcIik7XG4gICAgICAgICAgICBtYXRoTGluay5zZXRBdHRyaWJ1dGUoXCJkcmFnZ2FibGVcIiwgXCJ0cnVlXCIpO1xuXG4gICAgICAgICAgICBjb25zdCBsaW5rcGF0aCA9IGdldExpbmtwYXRoKHRoaXMub3V0TGlua1RleHQpO1xuICAgICAgICAgICAgY29uc3QgdGFyZ2V0RmlsZSA9IHBsdWdpbi5hcHAubWV0YWRhdGFDYWNoZS5nZXRGaXJzdExpbmtwYXRoRGVzdChsaW5rcGF0aCwgdGhpcy5zb3VyY2VQYXRoKTtcbiAgICAgICAgICAgIGlmICh0YXJnZXRGaWxlKSBhZGRTdXBlckNoYXJnZWQocGx1Z2luLCBtYXRoTGluaywgdGFyZ2V0RmlsZSk7XG5cbiAgICAgICAgICAgIGxldCBtYXRoTGlua1dyYXBwZXIgPSBjcmVhdGVTcGFuKCk7XG4gICAgICAgICAgICBtYXRoTGlua1dyYXBwZXIuYWRkQ2xhc3MoXCJjbS1obWQtaW50ZXJuYWwtbGlua1wiKTtcbiAgICAgICAgICAgIG1hdGhMaW5rV3JhcHBlci5hcHBlbmRDaGlsZChtYXRoTGluayk7XG5cbiAgICAgICAgICAgIG1hdGhMaW5rV3JhcHBlci5vbmNsaWNrID0gKChldnQ6IE1vdXNlRXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBpZiAodGFyZ2V0RmlsZSkge1xuICAgICAgICAgICAgICAgICAgICBwbHVnaW4uYXBwLndvcmtzcGFjZS5vcGVuTGlua1RleHQodGhpcy5vdXRMaW5rVGV4dCwgdGhpcy5zb3VyY2VQYXRoLCBLZXltYXAuaXNNb2RFdmVudChldnQpKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLm9wZW4odGhpcy5vdXRMaW5rVGV4dCwgXCJfYmxhbmtcIiwgXCJub3JlZmVycmVyXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBtYXRoTGlua1dyYXBwZXIub25tb3VzZWRvd24gPSAoKGV2dDogTW91c2VFdmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChldnQuYnV0dG9uID09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIG1hdGhMaW5rV3JhcHBlci5vbmF1eGNsaWNrID0gKChldnQ6IE1vdXNlRXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZXZ0LmJ1dHRvbiA9PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXRGaWxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwbHVnaW4uYXBwLndvcmtzcGFjZS5vcGVuTGlua1RleHQodGhpcy5vdXRMaW5rVGV4dCwgdGhpcy5zb3VyY2VQYXRoLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYub3Blbih0aGlzLm91dExpbmtUZXh0LCBcIl9ibGFua1wiLCBcIm5vcmVmZXJyZXJcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIG1hdGhMaW5rV3JhcHBlcjtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IG1hdGhMaW5rc1ZpZXdQbHVnaW4gPSBWaWV3UGx1Z2luLmZyb21DbGFzcyhcbiAgICAgICAgY2xhc3MgaW1wbGVtZW50cyBQbHVnaW5WYWx1ZSB7XG4gICAgICAgICAgICBkZWNvcmF0aW9uczogRGVjb3JhdGlvblNldDtcblxuICAgICAgICAgICAgY29uc3RydWN0b3IodmlldzogRWRpdG9yVmlldykge1xuICAgICAgICAgICAgICAgIHRoaXMuZGVjb3JhdGlvbnMgPSB0aGlzLmJ1aWxkRGVjb3JhdGlvbnModmlldyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGJ1aWxkRGVjb3JhdGlvbnModmlldzogRWRpdG9yVmlldyk6IERlY29yYXRpb25TZXQge1xuICAgICAgICAgICAgICAgIC8vIERpc2FibGUgaW4gc291cmNlIG1vZGUgaWYgYWxsIHRoZSBwcm92aWRlciBhcmUgZGlzYWJsZWQgaW4gc291cmNlIG1vZGUuXG4gICAgICAgICAgICAgICAgaWYgKCF2aWV3LnN0YXRlLmZpZWxkKGVkaXRvckxpdmVQcmV2aWV3RmllbGQpICYmICFwbHVnaW4uZW5hYmxlSW5Tb3VyY2VNb2RlKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIERlY29yYXRpb24ubm9uZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25zdCBzb3VyY2VQYXRoID0gdmlldy5zdGF0ZS5maWVsZChlZGl0b3JJbmZvRmllbGQpLmZpbGU/LnBhdGggPz8gJyc7XG4gICAgICAgICAgICAgICAgY29uc3QgaXNTb3VyY2VNb2RlID0gIXZpZXcuc3RhdGUuZmllbGQoZWRpdG9yTGl2ZVByZXZpZXdGaWVsZCk7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5mbyA9IHZpZXcuc3RhdGUuZmllbGQobWF0aExpbmtJbmZvRmllbGQpO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgYnVpbGRlciA9IG5ldyBSYW5nZVNldEJ1aWxkZXI8RGVjb3JhdGlvbj4oKTtcbiAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3Rpb24gPSB2aWV3LnN0YXRlLnNlbGVjdGlvbjtcblxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgeyBmcm9tLCB0byB9IG9mIHZpZXcudmlzaWJsZVJhbmdlcykge1xuICAgICAgICAgICAgICAgICAgICBpbmZvLmJldHdlZW4oZnJvbSwgdG8sIChzdGFydCwgZW5kLCB7IGxpbmtUZXh0LCBtYXRoTGluayB9KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGUgaW5saW5lIGZpZWxkIGlzIG5vdCBvdmVybGFwcGluZyB3aXRoIHRoZSBjdXJzb3IsIHdlIHJlcGxhY2UgaXQgd2l0aCBhIHdpZGdldC5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc2VsZWN0aW9uQW5kUmFuZ2VPdmVybGFwKHNlbGVjdGlvbiwgc3RhcnQsIGVuZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBidWlsZGVyLmFkZChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVjb3JhdGlvbi53aWRnZXQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkZ2V0OiBuZXcgTWF0aFdpZGdldChsaW5rVGV4dCwgbWF0aExpbmssIGlzU291cmNlTW9kZSwgc291cmNlUGF0aCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBidWlsZGVyLmZpbmlzaCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB1cGRhdGUodXBkYXRlOiBWaWV3VXBkYXRlKSB7XG4gICAgICAgICAgICAgICAgLy8gRGlzYWJsZSBpbiBzb3VyY2UgbW9kZSBpZiBhbGwgdGhlIHByb3ZpZGVyIGFyZSBkaXNhYmxlZCBpbiBzb3VyY2UgbW9kZS5cbiAgICAgICAgICAgICAgICBpZiAoIXVwZGF0ZS5zdGF0ZS5maWVsZChlZGl0b3JMaXZlUHJldmlld0ZpZWxkKSAmJiAhcGx1Z2luLmVuYWJsZUluU291cmNlTW9kZSgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGVjb3JhdGlvbnMgPSBEZWNvcmF0aW9uLm5vbmU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHVwZGF0ZS50cmFuc2FjdGlvbnMuc29tZSh0ciA9PiBoYXNFZmZlY3QodHIsIGZvcmNlVXBkYXRlRWZmZWN0KSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZWNvcmF0aW9ucyA9IHRoaXMuYnVpbGREZWNvcmF0aW9ucyh1cGRhdGUudmlldyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh1cGRhdGUuZG9jQ2hhbmdlZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRlY29yYXRpb25zID0gdGhpcy5kZWNvcmF0aW9ucy5tYXAodXBkYXRlLmNoYW5nZXMpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZURlY29yYXRpb25zKHVwZGF0ZS52aWV3KTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHVwZGF0ZS5zZWxlY3Rpb25TZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVEZWNvcmF0aW9ucyh1cGRhdGUudmlldyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh1cGRhdGUudmlld3BvcnRDaGFuZ2VkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGVjb3JhdGlvbnMgPSB0aGlzLmJ1aWxkRGVjb3JhdGlvbnModXBkYXRlLnZpZXcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdXBkYXRlRGVjb3JhdGlvbnModmlldzogRWRpdG9yVmlldykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGZpbGUgPSB2aWV3LnN0YXRlLmZpZWxkKGVkaXRvckluZm9GaWVsZCkuZmlsZTtcbiAgICAgICAgICAgICAgICBjb25zdCBzb3VyY2VQYXRoID0gZmlsZT8ucGF0aCA/PyAnJztcbiAgICAgICAgICAgICAgICBjb25zdCBpc1NvdXJjZU1vZGUgPSAhdmlldy5zdGF0ZS5maWVsZChlZGl0b3JMaXZlUHJldmlld0ZpZWxkKTtcbiAgICAgICAgICAgICAgICBjb25zdCBpbmZvID0gdmlldy5zdGF0ZS5maWVsZChtYXRoTGlua0luZm9GaWVsZCk7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0aW9uID0gdmlldy5zdGF0ZS5zZWxlY3Rpb247XG5cbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHsgZnJvbSwgdG8gfSBvZiB2aWV3LnZpc2libGVSYW5nZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgaW5mby5iZXR3ZWVuKGZyb20sIHRvLCAoc3RhcnQsIGVuZCwgdmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG92ZXJsYXAgPSBzZWxlY3Rpb25BbmRSYW5nZU92ZXJsYXAoc2VsZWN0aW9uLCBzdGFydCwgZW5kKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvdmVybGFwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVEZWNvKHN0YXJ0LCBlbmQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGREZWNvKHN0YXJ0LCBlbmQsIHZhbHVlLCBpc1NvdXJjZU1vZGUsIHNvdXJjZVBhdGgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJlbW92ZURlY28oc3RhcnQ6IG51bWJlciwgZW5kOiBudW1iZXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRlY29yYXRpb25zLmJldHdlZW4oc3RhcnQsIGVuZCwgKGZyb20sIHRvKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGVjb3JhdGlvbnMgPSB0aGlzLmRlY29yYXRpb25zLnVwZGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJGcm9tOiBmcm9tLFxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyVG86IHRvLFxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyOiAoKSA9PiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGFkZERlY28oc3RhcnQ6IG51bWJlciwgZW5kOiBudW1iZXIsIHZhbHVlOiBNYXRoTGlua0luZm8sIGlzU291cmNlTW9kZTogYm9vbGVhbiwgc291cmNlUGF0aDogc3RyaW5nKSB7XG4gICAgICAgICAgICAgICAgbGV0IGV4aXN0cyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHRoaXMuZGVjb3JhdGlvbnMuYmV0d2VlbihzdGFydCwgZW5kLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGV4aXN0cyA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaWYgKCFleGlzdHMpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZWNvcmF0aW9ucyA9IHRoaXMuZGVjb3JhdGlvbnMudXBkYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFkZDogW1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbTogc3RhcnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvOiBlbmQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBEZWNvcmF0aW9uLndpZGdldCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWRnZXQ6IG5ldyBNYXRoV2lkZ2V0KHZhbHVlLmxpbmtUZXh0LCB2YWx1ZS5tYXRoTGluaywgaXNTb3VyY2VNb2RlLCBzb3VyY2VQYXRoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgICAgZGVjb3JhdGlvbnM6IGluc3RhbmNlID0+IGluc3RhbmNlLmRlY29yYXRpb25zLFxuICAgICAgICB9XG4gICAgKTtcblxuICAgIHJldHVybiBbbWF0aExpbmtJbmZvRmllbGQsIG1hdGhMaW5rc1ZpZXdQbHVnaW5dO1xufVxuIiwgImltcG9ydCB7IE1hdGhMaW5rc0FQSUFjY291bnQgfSBmcm9tICcuL2RlcHJlY2F0ZWQnO1xuaW1wb3J0IHsgQmxvY2tTdWJwYXRoUmVzdWx0LCBDb21wb25lbnQsIEhlYWRpbmdTdWJwYXRoUmVzdWx0LCBURmlsZSB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7IGdldE1hdGhMaW5rRnJvbVN1YnBhdGgsIGdldE1hdGhMaW5rRnJvbVRlbXBsYXRlcyB9IGZyb20gJy4uL2xpbmtzL2hlbHBlcic7XG5pbXBvcnQgeyB1cGRhdGUgfSBmcm9tICcuL2luZGV4JztcbmltcG9ydCBNYXRoTGlua3MgZnJvbSAnLi4vbWFpbic7XG5cbi8qKlxuICogQSBjbGFzcyB0aGF0IHByb3ZpZGVzIGEgZGlzcGxheWVkIHRleHQgZm9yIGEgZ2l2ZW4gbGluay5cbiAqL1xuZXhwb3J0IGFic3RyYWN0IGNsYXNzIFByb3ZpZGVyIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgICBfZW5hYmxlSW5Tb3VyY2VNb2RlOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgbWF0aExpbmtzOiBNYXRoTGlua3MpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICB9XG5cbiAgICBnZXQgZW5hYmxlSW5Tb3VyY2VNb2RlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZW5hYmxlSW5Tb3VyY2VNb2RlO1xuICAgIH1cblxuICAgIHNldCBlbmFibGVJblNvdXJjZU1vZGUoZW5hYmxlOiBib29sZWFuKSB7XG4gICAgICAgIHRoaXMuX2VuYWJsZUluU291cmNlTW9kZSA9IGVuYWJsZTtcbiAgICAgICAgdXBkYXRlKHRoaXMubWF0aExpbmtzLmFwcCk7XG4gICAgfVxuXG4gICAgcHVibGljIGFic3RyYWN0IHByb3ZpZGUoXG4gICAgICAgIHBhcnNlZExpbmt0ZXh0OiB7IHBhdGg6IHN0cmluZywgc3VicGF0aDogc3RyaW5nIH0sXG4gICAgICAgIHRhcmdldEZpbGU6IFRGaWxlIHwgbnVsbCxcbiAgICAgICAgdGFyZ2V0U3VicGF0aFJlc3VsdDogSGVhZGluZ1N1YnBhdGhSZXN1bHQgfCBCbG9ja1N1YnBhdGhSZXN1bHQgfCBudWxsLFxuICAgICAgICBzb3VyY2VGaWxlOiBURmlsZSB8IG51bGwsXG4gICAgKTogc3RyaW5nIHwgbnVsbDtcblxuICAgIG9udW5sb2FkKCkge1xuICAgICAgICBjb25zdCBwcm92aWRlcnMgPSB0aGlzLm1hdGhMaW5rcy5wcm92aWRlcnM7XG4gICAgICAgIGxldCBpbmRleCA9IHByb3ZpZGVycy5maW5kSW5kZXgoKHsgcHJvdmlkZXIgfSkgPT4gcHJvdmlkZXIgPT09IHRoaXMpO1xuICAgICAgICBwcm92aWRlcnMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgdXBkYXRlKHRoaXMubWF0aExpbmtzLmFwcCk7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgTmF0aXZlUHJvdmlkZXIgZXh0ZW5kcyBQcm92aWRlciB7XG4gICAgZ2V0IGVuYWJsZUluU291cmNlTW9kZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubWF0aExpbmtzLnNldHRpbmdzLmVuYWJsZUluU291cmNlTW9kZTtcbiAgICB9XG5cbiAgICBzZXQgZW5hYmxlSW5Tb3VyY2VNb2RlKGVuYWJsZTogYm9vbGVhbikge1xuICAgICAgICB0aGlzLm1hdGhMaW5rcy5zZXR0aW5ncy5lbmFibGVJblNvdXJjZU1vZGUgPSBlbmFibGU7XG4gICAgICAgIHVwZGF0ZSh0aGlzLm1hdGhMaW5rcy5hcHApO1xuICAgICAgICB0aGlzLm1hdGhMaW5rcy5zYXZlU2V0dGluZ3MoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgcHJvdmlkZShcbiAgICAgICAgcGFyc2VkTGlua3RleHQ6IHsgcGF0aDogc3RyaW5nLCBzdWJwYXRoOiBzdHJpbmcgfSxcbiAgICAgICAgdGFyZ2V0RmlsZTogVEZpbGUgfCBudWxsLFxuICAgICAgICB0YXJnZXRTdWJwYXRoUmVzdWx0OiBIZWFkaW5nU3VicGF0aFJlc3VsdCB8IEJsb2NrU3VicGF0aFJlc3VsdCB8IG51bGxcbiAgICApOiBzdHJpbmcgfCBudWxsIHtcbiAgICAgICAgY29uc3QgeyBtYXRoTGlua3MgfSA9IHRoaXM7XG4gICAgICAgIGNvbnN0IHsgYXBwIH0gPSBtYXRoTGlua3M7XG5cbiAgICAgICAgaWYgKCF0YXJnZXRGaWxlKSByZXR1cm4gbnVsbDtcblxuICAgICAgICBsZXQgY2FjaGUgPSBhcHAubWV0YWRhdGFDYWNoZS5nZXRGaWxlQ2FjaGUodGFyZ2V0RmlsZSk7XG4gICAgICAgIGlmICghY2FjaGUpIHJldHVybiBudWxsO1xuXG4gICAgICAgIGxldCBtYXRoTGluazogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gICAgICAgIGlmICh0YXJnZXRTdWJwYXRoUmVzdWx0KSB7XG4gICAgICAgICAgICBtYXRoTGluayA9IGdldE1hdGhMaW5rRnJvbVN1YnBhdGgocGFyc2VkTGlua3RleHQucGF0aCwgdGFyZ2V0U3VicGF0aFJlc3VsdCwgY2FjaGUuZnJvbnRtYXR0ZXIsIG1hdGhMaW5rcy5zZXR0aW5ncy5ibG9ja1ByZWZpeCxcbiAgICAgICAgICAgICAgICAvLyBJZiBlbmFibGVGaWxlTmFtZUJsb2NrTGlua3MgPT0gdHJ1ZSwgcGFzcyBgbnVsbGAgdG8gdGhlIGxhc3QgcGFyYW1ldGVyIGBwcmVmaXhgLCB3aGljaCBtZWFucyB1c2luZyB0aGUgc3RhbmRhcmQgcHJlZml4IChlLmcuIG5vdGUgPiBibG9jaykuIFxuICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSwgcGFzcyBhbiBlbXB0eSBzdHJpbmcgdG8gYHByZWZpeGAsIHdoaWNoIG1lYW5zIHVzaW5nIG5vIHByZWZpeCAobm8gcHJlZml4IGlzIGEgc3BlY2lhbCBjYXNlIG9mIGN1c3RvbSBwcmVmaXhlcykuXG4gICAgICAgICAgICAgICAgbWF0aExpbmtzLnNldHRpbmdzLmVuYWJsZUZpbGVOYW1lQmxvY2tMaW5rcyA/IG51bGwgOiBcIlwiXG4gICAgICAgICAgICApO1xuICAgICAgICB9IGVsc2UgaWYgKHBhcnNlZExpbmt0ZXh0LnBhdGgpIHtcbiAgICAgICAgICAgIG1hdGhMaW5rID0gY2FjaGUuZnJvbnRtYXR0ZXI/Lm1hdGhMaW5rO1xuICAgICAgICAgICAgaWYgKG1hdGhMaW5rID09IFwiYXV0b1wiKSB7XG4gICAgICAgICAgICAgICAgbWF0aExpbmsgPSBnZXRNYXRoTGlua0Zyb21UZW1wbGF0ZXMobWF0aExpbmtzLCB0YXJnZXRGaWxlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBtYXRoTGluaztcbiAgICB9XG59XG5cbi8qKlxuICogUHJvdmlkZXIgZm9yIHByZXNlcnZpbmcgYmFja3dhcmQgY29tcGF0aWJpbGl0eSB3aXRoIHRoZSBkZXByZWNhdGVkIEFQSS5cbiAqL1xuZXhwb3J0IGNsYXNzIERlcHJlY2F0ZWRBUElQcm92aWRlciBleHRlbmRzIFByb3ZpZGVyIHtcbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgYWNjb3VudDogTWF0aExpbmtzQVBJQWNjb3VudCkge1xuICAgICAgICBzdXBlcihhY2NvdW50LnBsdWdpbik7XG4gICAgfVxuXG4gICAgcHVibGljIHByb3ZpZGUoXG4gICAgICAgIHBhcnNlZExpbmt0ZXh0OiB7IHBhdGg6IHN0cmluZywgc3VicGF0aDogc3RyaW5nIH0sXG4gICAgICAgIHRhcmdldEZpbGU6IFRGaWxlIHwgbnVsbCxcbiAgICAgICAgdGFyZ2V0U3VicGF0aFJlc3VsdDogSGVhZGluZ1N1YnBhdGhSZXN1bHQgfCBCbG9ja1N1YnBhdGhSZXN1bHQgfCBudWxsLFxuICAgICAgICBzb3VyY2VGaWxlOiBURmlsZSB8IG51bGwsXG4gICAgKTogc3RyaW5nIHwgbnVsbCB7XG4gICAgICAgIGlmICh0YXJnZXRGaWxlID09PSBudWxsIHx8IHNvdXJjZUZpbGUgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IG1hdGhMaW5rOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcbiAgICAgICAgY29uc3QgbWV0YWRhdGEgPSB0aGlzLmFjY291bnQubWV0YWRhdGFTZXQuZ2V0KHRhcmdldEZpbGUpO1xuICAgICAgICBpZiAobWV0YWRhdGEpIHtcbiAgICAgICAgICAgIGlmICh0YXJnZXRTdWJwYXRoUmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgbWF0aExpbmsgPSBnZXRNYXRoTGlua0Zyb21TdWJwYXRoKHBhcnNlZExpbmt0ZXh0LnBhdGgsIHRhcmdldFN1YnBhdGhSZXN1bHQsIG1ldGFkYXRhLCB0aGlzLmFjY291bnQuYmxvY2tQcmVmaXgsXG4gICAgICAgICAgICAgICAgICAgIC8vIEFuIEFQSSB1c2VyIGNhbiBzcGVjaWZ5IGN1c3RvbSBwcmVmaXhlcyBkZXBlbmRpbmcgb24gdGhlIHNvdXJjZSBmaWxlIChzb3VyY2VGaWxlKSAmIHRoZSB0YXJnZXQgZmlsZSAoZmlsZSkuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWNjb3VudC5wcmVmaXhlcihzb3VyY2VGaWxlLCB0YXJnZXRGaWxlLCB0YXJnZXRTdWJwYXRoUmVzdWx0KVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG1hdGhMaW5rID0gbWV0YWRhdGFbXCJtYXRoTGlua1wiXSA/PyBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG1hdGhMaW5rO1xuICAgIH1cbn1cbiIsICJpbXBvcnQgeyBBcHAsIE1hcmtkb3duVmlldywgVEFic3RyYWN0RmlsZSwgVEZpbGUsIFRGb2xkZXIsIFdvcmtzcGFjZUxlYWYgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCBNYXRoTGlua3MgZnJvbSBcIi4vbWFpblwiO1xuaW1wb3J0IHsgZm9yY2VVcGRhdGVFZmZlY3QgfSBmcm9tIFwiLi9saW5rcy9wcmV2aWV3XCI7XG5cbi8vIENoZWNrIGlmIHBhdGggaXMgZXhjbHVkZWRcbmV4cG9ydCBmdW5jdGlvbiBpc0V4Y2x1ZGVkKHBsdWdpbjogTWF0aExpbmtzLCBmaWxlOiBUQWJzdHJhY3RGaWxlKTogYm9vbGVhbiB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwbHVnaW4uc2V0dGluZ3MuZXhjbHVkZWRQYXRocy5sZW5ndGg7IGkrKykge1xuICAgICAgICBsZXQgZXhjbHVkZWQgPSBwbHVnaW4uYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChwbHVnaW4uc2V0dGluZ3MuZXhjbHVkZWRQYXRoc1tpXSk7XG4gICAgICAgIGlmIChleGNsdWRlZCAmJiBpc0VxdWFsVG9PckNoaWxkT2YoZmlsZSwgZXhjbHVkZWQpKSByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG59XG5cbi8vIENvbnZlcnQgXCJmaWxlbmFtZSNoZWFkaW5nXCIgdG8gXCJmaWxlbmFtZSA+IGhlYWRpbmdcIiBhbmQgXCJmaWxlbmFtZSNeYmxvY2tJRFwiIHRvIFwiZmlsZW5hbWUgPiBeYmxvY2tJRFwiXG5leHBvcnQgZnVuY3Rpb24gdHJhbnNsYXRlTGluayh0YXJnZXRMaW5rOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGZ1bmN0aW9uIHRyYW5zbGF0ZUxpbmtJbXBsKHRhcmdldExpbms6IHN0cmluZywgcGF0dGVybjogUmVnRXhwKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgICAgICAgbGV0IHJlc3VsdCA9IHBhdHRlcm4uZXhlYyh0YXJnZXRMaW5rKTtcbiAgICAgICAgaWYgKHJlc3VsdClcbiAgICAgICAgICAgIHJldHVybiAocmVzdWx0WzFdID8gYCR7cmVzdWx0WzFdfSA+IGAgOiBcIlwiKSArIGAke3Jlc3VsdFsyXX1gXG4gICAgfVxuXG4gICAgbGV0IGhlYWRpbmdQYXR0ZXJuID0gLyheLiopIyhbXlxcXl0uKikvO1xuICAgIGxldCBibG9ja1BhdHRlcm4gPSAvKF4uKikjKFxcXlthLXpBLVowLTlcXC1dKykvO1xuICAgIGxldCB0cmFuc2xhdGVkQXNIZWFkaW5nID0gdHJhbnNsYXRlTGlua0ltcGwodGFyZ2V0TGluaywgaGVhZGluZ1BhdHRlcm4pO1xuICAgIGxldCB0cmFuc2xhdGVkQXNCbG9jayA9IHRyYW5zbGF0ZUxpbmtJbXBsKHRhcmdldExpbmssIGJsb2NrUGF0dGVybik7XG4gICAgcmV0dXJuIHRyYW5zbGF0ZWRBc0hlYWRpbmcgPz8gdHJhbnNsYXRlZEFzQmxvY2sgPz8gXCJcIjtcbn1cblxuLy8gRnJvbSBodHRwczovL2dpdGh1Yi5jb20vUnlvdGFVc2hpby9vYnNpZGlhbi1tYXRoLWJvb3N0ZXIvYmxvYi9tYXN0ZXIvc3JjL3V0aWxzLnRzXG5leHBvcnQgZnVuY3Rpb24gaXNFcXVhbFRvT3JDaGlsZE9mKGZpbGUxOiBUQWJzdHJhY3RGaWxlLCBmaWxlMjogVEFic3RyYWN0RmlsZSk6IGJvb2xlYW4ge1xuICAgIGlmIChmaWxlMSA9PSBmaWxlMikgcmV0dXJuIHRydWU7XG4gICAgaWYgKGZpbGUyIGluc3RhbmNlb2YgVEZvbGRlciAmJiBmaWxlMi5pc1Jvb3QoKSkgcmV0dXJuIHRydWU7XG5cbiAgICBsZXQgYW5jZXN0b3IgPSBmaWxlMS5wYXJlbnQ7XG4gICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgaWYgKGFuY2VzdG9yID09IGZpbGUyKSByZXR1cm4gdHJ1ZTtcbiAgICAgICAgaWYgKGFuY2VzdG9yKSB7XG4gICAgICAgICAgICBpZiAoYW5jZXN0b3IuaXNSb290KCkpIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIGFuY2VzdG9yID0gYW5jZXN0b3IucGFyZW50O1xuICAgICAgICB9XG4gICAgfVxufVxuXG4vLyBldmVudE5hbWU6IHNlZSBzcmMvdHlwZS5kLnRzXG5leHBvcnQgZnVuY3Rpb24gaW5mb3JtQ2hhbmdlKGFwcDogQXBwLCBldmVudE5hbWU6IHN0cmluZywgLi4uY2FsbGJhY2tBcmdzOiBbZmlsZT86IFRGaWxlXSkge1xuICAgIC8vIHRyaWdnZXIgYW4gZXZlbnQgaW5mb3JtaW5nIHRoaXMgdXBkYXRlXG4gICAgYXBwLm1ldGFkYXRhQ2FjaGUudHJpZ2dlcihldmVudE5hbWUsIC4uLmNhbGxiYWNrQXJncyk7XG5cbiAgICAvLyByZWZyZXNoIG1hdGhMaW5rcyBkaXNwbGF5IGJhc2VkIG9uIHRoZSBuZXcgbWV0YWRhdGFcbiAgICBhcHAud29ya3NwYWNlLml0ZXJhdGVSb290TGVhdmVzKChsZWFmOiBXb3Jrc3BhY2VMZWFmKSA9PiB7XG4gICAgICAgIGlmIChsZWFmLnZpZXcgaW5zdGFuY2VvZiBNYXJrZG93blZpZXcgJiYgbGVhZi52aWV3LmdldE1vZGUoKSA9PSAnc291cmNlJykge1xuICAgICAgICAgICAgbGVhZi52aWV3LmVkaXRvci5jbT8uZGlzcGF0Y2goe1xuICAgICAgICAgICAgICAgIGVmZmVjdHM6IGZvcmNlVXBkYXRlRWZmZWN0Lm9mKG51bGwpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuIiwgImV4cG9ydCB0eXBlIHsgTWF0aExpbmtzTWV0YWRhdGEsIE1hdGhMaW5rc01ldGFkYXRhU2V0LCBNYXRoTGlua3NBUElBY2NvdW50IH0gZnJvbSBcIi4vZGVwcmVjYXRlZFwiO1xuZXhwb3J0IHsgUHJvdmlkZXIgfSBmcm9tICcuL3Byb3ZpZGVyJztcblxuaW1wb3J0IHsgVEZpbGUsIHR5cGUgQXBwLCB0eXBlIFBsdWdpbiB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgTWF0aExpbmtzQVBJQWNjb3VudCB9IGZyb20gXCIuL2RlcHJlY2F0ZWRcIjtcbmltcG9ydCB7IFByb3ZpZGVyIH0gZnJvbSBcIi4vcHJvdmlkZXJcIjtcbmltcG9ydCBNYXRoTGlua3MgZnJvbSBcIi4uL21haW5cIjtcbmltcG9ydCB7IGluZm9ybUNoYW5nZSB9IGZyb20gXCIuLi91dGlsc1wiO1xuXG5cbmV4cG9ydCBmdW5jdGlvbiBhZGRQcm92aWRlcjxDdXN0b21Qcm92aWRlciBleHRlbmRzIFByb3ZpZGVyPihhcHA6IEFwcCwgcHJvdmlkZXJGYWN0b3J5OiAobWF0aExpbmtzOiBNYXRoTGlua3MpID0+IEN1c3RvbVByb3ZpZGVyKTogQ3VzdG9tUHJvdmlkZXIge1xuICAgIGlmICghaXNQbHVnaW5FbmFibGVkKGFwcCkpIHRocm93IEVycm9yKFwiTWF0aExpbmtzIEFQSTogTWF0aExpbmtzIGlzIG5vdCBlbmFibGVkLlwiKTtcbiAgICBjb25zdCBtYXRoTGlua3MgPSBhcHAucGx1Z2lucy5wbHVnaW5zLm1hdGhsaW5rcyBhcyBNYXRoTGlua3M7XG4gICAgY29uc3QgcHJvdmlkZXIgPSBwcm92aWRlckZhY3RvcnkobWF0aExpbmtzKTtcbiAgICBtYXRoTGlua3MucmVnaXN0ZXJQcm92aWRlcihwcm92aWRlcik7XG4gICAgcmV0dXJuIHByb3ZpZGVyO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNQbHVnaW5FbmFibGVkKGFwcDogQXBwKSB7XG4gICAgcmV0dXJuIGFwcC5wbHVnaW5zLmVuYWJsZWRQbHVnaW5zLmhhcyhcIm1hdGhsaW5rc1wiKTtcbn1cblxuLyoqXG4gKiBJbmZvcm0gTWF0aExpbmtzIHRoYXQgaXQgc2hvdWxkIHVwZGF0ZSB0aGUgZGlzcGxheSB0ZXh0IG9mIGxpbmtzLlxuICogSWYgYGZpbGVgIGlzIGdpdmVuLCBNYXRoTGlua3Mgd2lsbCBvbmx5IHVwZGF0ZSB0aGUgbm90ZXMgYWZmZWN0ZWQgYnkgY2hhbmdlcyBpbiB0aGF0IGZpbGUuXG4gKiBPdGhlcndpc2UsIE1hdGhMaW5rcyB3aWxsIHVwZGF0ZSBhbGwgbm90ZXMgY3VycmVudGx5IG9wZW4uXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGUoYXBwOiBBcHAsIGZpbGU/OiBURmlsZSkge1xuICAgIGlmIChmaWxlKSB7XG4gICAgICAgIGluZm9ybUNoYW5nZShhcHAsIFwibWF0aGxpbmtzOnVwZGF0ZVwiLCBmaWxlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBpbmZvcm1DaGFuZ2UoYXBwLCBcIm1hdGhsaW5rczp1cGRhdGUtYWxsXCIpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBPYnNvbGV0ZSAmIERlcHJlY2F0ZWQgQVBJXG4gKi9cblxuLyoqXG4gKiBXaGVuIGNhbGxlZCBmb3IgdGhlIGZpcnN0IHRpbWUsIHJlZ2lzdGVyIHVzZXJQbHVnaW4gYXMgYSB1c2VyIG9mIE1hdGhMaW5rcyBBUEkgYW5kIHJldHVybnMgaXRzIGFjY291bnQuXG4gKiBGcm9tIHRoZSBzZWNvbmQgdGltZSBvbiwgcmV0dXJucyB0aGUgZXhpc3RpbmcgYWNjb3VudCBvZiB1c2VyUGx1Z2luLlxuICogQGRlcHJlY2F0ZWQgVXNlIHtAbGluayByZWdpc3RlclByb3ZpZGVyfSBpbnN0ZWFkLlxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0QVBJQWNjb3VudCh1c2VyUGx1Z2luOiBSZWFkb25seTxQbHVnaW4+KTogTWF0aExpbmtzQVBJQWNjb3VudCB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHVzZXJQbHVnaW4uYXBwLnBsdWdpbnMucGx1Z2lucy5tYXRobGlua3M/LmdldEFQSUFjY291bnQodXNlclBsdWdpbik7XG59XG5cbi8qKlxuICogVGhpcyBmdW5jdGlvbiBpcyBvYnNvbGV0ZSBhbmQgWW91IGRvbid0IGNhbGwgdGhpcyBmdW5jdGlvbiBubyBtb3JlLlxuICogSXQgd2lsbCBiZSByZW1vdmVkIGluIGEgZnV0dXJlIHZlcnNpb24uXG4gKi9cbmV4cG9ydCBjb25zdCBkZWxldGVBUElBY2NvdW50ID0gKHVzZXJQbHVnaW46IFJlYWRvbmx5PFBsdWdpbj4pOiB2b2lkID0+IHtcbiAgICBsZXQgYWNjb3VudHMgPSB1c2VyUGx1Z2luLmFwcC5wbHVnaW5zLnBsdWdpbnMubWF0aGxpbmtzPy5hcGlBY2NvdW50cztcbiAgICBpZiAoYWNjb3VudHMpIHtcbiAgICAgICAgbGV0IGluZGV4ID0gYWNjb3VudHMuZmluZEluZGV4KFxuICAgICAgICAgICAgKGFjY291bnQpID0+IGFjY291bnQubWFuaWZlc3QuaWQgPT0gdXNlclBsdWdpbi5tYW5pZmVzdC5pZFxuICAgICAgICApO1xuICAgICAgICBhY2NvdW50cy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICB1cGRhdGUodXNlclBsdWdpbi5hcHApO1xuICAgIH1cbn1cbiIsICJpbXBvcnQgeyBOYXRpdmVQcm92aWRlciB9IGZyb20gJy4vLi4vYXBpL3Byb3ZpZGVyJztcbmltcG9ydCB7IFRGaWxlLCByZW5kZXJNYXRoLCBmaW5pc2hSZW5kZXJNYXRoLCBwYXJzZUxpbmt0ZXh0LCByZXNvbHZlU3VicGF0aCwgQmxvY2tTdWJwYXRoUmVzdWx0LCBIZWFkaW5nU3VicGF0aFJlc3VsdCB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgTWF0aExpbmtzTWV0YWRhdGEgfSBmcm9tIFwiLi4vYXBpL2RlcHJlY2F0ZWRcIjtcbmltcG9ydCBNYXRoTGlua3MgZnJvbSBcIi4uL21haW5cIjtcblxuZXhwb3J0IGZ1bmN0aW9uIHNldE1hdGhMaW5rKHNvdXJjZTogc3RyaW5nLCBtYXRoTGlua0VsOiBIVE1MRWxlbWVudCkge1xuICAgIG1hdGhMaW5rRWwucmVwbGFjZUNoaWxkcmVuKCk7XG4gICAgY29uc3QgbWF0aFBhdHRlcm4gPSAvXFwkKC4qP1teXFxzXSlcXCQvZztcbiAgICBsZXQgdGV4dEZyb20gPSAwLCB0ZXh0VG8gPSAwO1xuICAgIGxldCByZXN1bHQ7XG4gICAgd2hpbGUgKChyZXN1bHQgPSBtYXRoUGF0dGVybi5leGVjKHNvdXJjZSkpICE9PSBudWxsKSB7XG4gICAgICAgIGNvbnN0IG1hdGhTdHJpbmcgPSByZXN1bHRbMV07XG4gICAgICAgIHRleHRUbyA9IHJlc3VsdC5pbmRleDtcbiAgICAgICAgaWYgKHRleHRUbyA+IHRleHRGcm9tKSBtYXRoTGlua0VsLmNyZWF0ZVNwYW4oKS5yZXBsYWNlV2l0aChzb3VyY2Uuc2xpY2UodGV4dEZyb20sIHRleHRUbykpO1xuXG4gICAgICAgIGNvbnN0IG1hdGhFbCA9IHJlbmRlck1hdGgobWF0aFN0cmluZywgZmFsc2UpO1xuICAgICAgICBtYXRoTGlua0VsLmNyZWF0ZVNwYW4oeyBjbHM6IFtcIm1hdGhcIiwgXCJtYXRoLWlubGluZVwiLCBcImlzLWxvYWRlZFwiXSB9KS5yZXBsYWNlV2l0aChtYXRoRWwpO1xuICAgICAgICBmaW5pc2hSZW5kZXJNYXRoKCk7XG5cbiAgICAgICAgdGV4dEZyb20gPSBtYXRoUGF0dGVybi5sYXN0SW5kZXg7XG4gICAgfVxuXG4gICAgaWYgKHRleHRGcm9tIDwgc291cmNlLmxlbmd0aCkgbWF0aExpbmtFbC5jcmVhdGVTcGFuKCkucmVwbGFjZVdpdGgoc291cmNlLnNsaWNlKHRleHRGcm9tKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRNYXRoTGluayhwbHVnaW46IE1hdGhMaW5rcywgdGFyZ2V0TGluazogc3RyaW5nLCBzb3VyY2VQYXRoOiBzdHJpbmcsIGlzU291cmNlTW9kZT86IGJvb2xlYW4pOiBzdHJpbmcge1xuICAgIGxldCB7IHBhdGgsIHN1YnBhdGggfSA9IHBhcnNlTGlua3RleHQodGFyZ2V0TGluayk7XG5cbiAgICBsZXQgZmlsZSA9IHBsdWdpbi5hcHAubWV0YWRhdGFDYWNoZS5nZXRGaXJzdExpbmtwYXRoRGVzdChwYXRoLCBzb3VyY2VQYXRoKTtcbiAgICBpZiAoIWZpbGUpIHJldHVybiBcIlwiO1xuXG4gICAgbGV0IGNhY2hlID0gcGx1Z2luLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZShmaWxlKTtcbiAgICBpZiAoIWNhY2hlKSByZXR1cm4gXCJcIjtcblxuICAgIGxldCBzdWJwYXRoUmVzdWx0ID0gcmVzb2x2ZVN1YnBhdGgoY2FjaGUsIHN1YnBhdGgpO1xuXG4gICAgY29uc3Qgc291cmNlRmlsZSA9IHBsdWdpbi5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKHNvdXJjZVBhdGgpO1xuICAgIGlmICghKHNvdXJjZUZpbGUgaW5zdGFuY2VvZiBURmlsZSkpIHtcbiAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfVxuXG4gICAgbGV0IG1hdGhMaW5rID0gXCJcIjtcbiAgICBwbHVnaW4uaXRlcmF0ZVByb3ZpZGVycygocHJvdmlkZXIpID0+IHtcbiAgICAgICAgaWYgKGlzU291cmNlTW9kZSAmJiAhcHJvdmlkZXIuZW5hYmxlSW5Tb3VyY2VNb2RlKSByZXR1cm47XG5cbiAgICAgICAgY29uc3QgcHJvdmlkZWQgPSBwcm92aWRlci5wcm92aWRlKHsgcGF0aCwgc3VicGF0aCB9LCBmaWxlLCBzdWJwYXRoUmVzdWx0LCBzb3VyY2VGaWxlKTtcbiAgICAgICAgaWYgKHByb3ZpZGVkKSB7XG4gICAgICAgICAgICBpZiAocHJvdmlkZXIgaW5zdGFuY2VvZiBOYXRpdmVQcm92aWRlciAmJiBzdWJwYXRoUmVzdWx0Py50eXBlID09ICdoZWFkaW5nJykge1xuICAgICAgICAgICAgICAgIGlmIChtYXRoTGluayAmJiBwcm92aWRlZCA9PSAocGF0aCA/IHBhdGggKyAnID4gJyA6ICcnKSArIHN1YnBhdGhSZXN1bHQuY3VycmVudC5oZWFkaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtYXRoTGluayA9IHByb3ZpZGVkO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gbWF0aExpbms7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRNYXRoTGlua0Zyb21TdWJwYXRoKGxpbmtwYXRoOiBzdHJpbmcsIHN1YnBhdGhSZXN1bHQ6IEhlYWRpbmdTdWJwYXRoUmVzdWx0IHwgQmxvY2tTdWJwYXRoUmVzdWx0LCBtZXRhZGF0YTogTWF0aExpbmtzTWV0YWRhdGEgfCB1bmRlZmluZWQsIGJsb2NrUHJlZml4OiBzdHJpbmcsIHByZWZpeDogc3RyaW5nIHwgbnVsbCk6IHN0cmluZyB7XG4gICAgbGV0IHN1Yk1hdGhMaW5rID0gXCJcIlxuICAgIGlmIChzdWJwYXRoUmVzdWx0LnR5cGUgPT0gXCJoZWFkaW5nXCIpIHtcbiAgICAgICAgc3ViTWF0aExpbmsgPSBzdWJwYXRoUmVzdWx0LmN1cnJlbnQuaGVhZGluZztcbiAgICB9IGVsc2UgaWYgKHN1YnBhdGhSZXN1bHQudHlwZSA9PSBcImJsb2NrXCIgJiYgbWV0YWRhdGE/LltcIm1hdGhMaW5rLWJsb2Nrc1wiXT8uW3N1YnBhdGhSZXN1bHQuYmxvY2suaWRdKSB7XG4gICAgICAgIHN1Yk1hdGhMaW5rID0gYmxvY2tQcmVmaXggKyBtZXRhZGF0YVtcIm1hdGhMaW5rLWJsb2Nrc1wiXVtzdWJwYXRoUmVzdWx0LmJsb2NrLmlkXTtcbiAgICB9XG4gICAgaWYgKHN1Yk1hdGhMaW5rKSB7XG4gICAgICAgIGlmIChwcmVmaXggPT09IG51bGwpIHsgLy8gdXNlIHN0YW5kYXJkIHByZWZpeFxuICAgICAgICAgICAgaWYgKGxpbmtwYXRoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChtZXRhZGF0YT8uW1wibWF0aExpbmtcIl0gPz8gbGlua3BhdGgpICsgXCIgPiBcIiArIHN1Yk1hdGhMaW5rO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3ViTWF0aExpbms7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7IC8vIHR5cGVvZiBwcmVmaXggPT0gJ3N0cmluZycgPT4gdXNlIGN1c3RvbSBwcmVmaXggXG4gICAgICAgICAgICByZXR1cm4gcHJlZml4ICsgc3ViTWF0aExpbms7XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gXCJcIjtcbiAgICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRNYXRoTGlua0Zyb21UZW1wbGF0ZXMocGx1Z2luOiBNYXRoTGlua3MsIGZpbGU6IFRGaWxlKTogc3RyaW5nIHtcbiAgICBsZXQgdGVtcGxhdGVzID0gcGx1Z2luLnNldHRpbmdzLnRlbXBsYXRlcztcbiAgICBsZXQgbWF0aExpbmsgPSBmaWxlLm5hbWUucmVwbGFjZSgvXFwubWQkLywgXCJcIik7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0ZW1wbGF0ZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgbGV0IHJlcGxhY2VkID0gbmV3IFJlZ0V4cCh0ZW1wbGF0ZXNbaV0ucmVwbGFjZWQpO1xuICAgICAgICBsZXQgcmVwbGFjZW1lbnQgPSB0ZW1wbGF0ZXNbaV0ucmVwbGFjZW1lbnQ7XG5cbiAgICAgICAgbGV0IGZsYWdzID0gXCJcIjtcbiAgICAgICAgaWYgKHRlbXBsYXRlc1tpXS5nbG9iYWxNYXRjaCkgZmxhZ3MgKz0gXCJnXCI7XG4gICAgICAgIGlmICghdGVtcGxhdGVzW2ldLnNlbnNpdGl2ZSkgZmxhZ3MgKz0gXCJpXCI7XG5cbiAgICAgICAgaWYgKHRlbXBsYXRlc1tpXS53b3JkKVxuICAgICAgICAgICAgcmVwbGFjZWQgPSBSZWdFeHAocmVwbGFjZWQuc291cmNlLnJlcGxhY2UoL14vLCBcIlxcXFxiXCIpLnJlcGxhY2UoLyQvLCBcIlxcXFxiXCIpLCBmbGFncyk7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJlcGxhY2VkID0gUmVnRXhwKHJlcGxhY2VkLnNvdXJjZSwgZmxhZ3MpO1xuXG4gICAgICAgIG1hdGhMaW5rID0gbWF0aExpbmsucmVwbGFjZShyZXBsYWNlZCwgcmVwbGFjZW1lbnQpO1xuICAgIH1cblxuICAgIHJldHVybiBtYXRoTGluaztcbn1cbiIsICJpbXBvcnQgeyBURmlsZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IE1hdGhMaW5rcyBmcm9tIFwiLi4vbWFpblwiO1xuXG5leHBvcnQgZnVuY3Rpb24gYWRkU3VwZXJDaGFyZ2VkKHBsdWdpbjogTWF0aExpbmtzLCBzcGFuOiBIVE1MRWxlbWVudCwgb3V0TGlua0ZpbGU6IFRGaWxlKTogdm9pZCB7XG4gICAgaWYgKG91dExpbmtGaWxlICYmIHBsdWdpbi5hcHAucGx1Z2lucy5lbmFibGVkUGx1Z2lucy5oYXMoXCJzdXBlcmNoYXJnZWQtbGlua3Mtb2JzaWRpYW5cIikpIHtcbiAgICAgICAgbGV0IHN1cGVyQ2hhcmdlZCA9IGdldFN1cGVyQ2hhcmdlZChwbHVnaW4sIG91dExpbmtGaWxlKTtcbiAgICAgICAgc3Bhbi5jbGFzc0xpc3QuYWRkKFwiZGF0YS1saW5rLWljb25cIik7XG4gICAgICAgIHNwYW4uY2xhc3NMaXN0LmFkZChcImRhdGEtbGluay1pY29uLWFmdGVyXCIpO1xuICAgICAgICBzcGFuLmNsYXNzTGlzdC5hZGQoXCJkYXRhLWxpbmstdGV4dFwiKTtcbiAgICAgICAgc3Bhbi5zZXRBdHRyaWJ1dGUoXCJkYXRhLWxpbmstcGF0aFwiLCBvdXRMaW5rRmlsZS5wYXRoKTtcbiAgICAgICAgc3Bhbi5zZXRBdHRyaWJ1dGUoXCJkYXRhLWxpbmstdGFnc1wiLCBzdXBlckNoYXJnZWRbMF0pO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN1cGVyQ2hhcmdlZFsxXS5sZW5ndGg7IGkrKylcbiAgICAgICAgICAgIHNwYW4uc2V0QXR0cmlidXRlKFwiZGF0YS1saW5rLVwiICsgc3VwZXJDaGFyZ2VkWzFdW2ldWzBdLCBzdXBlckNoYXJnZWRbMV1baV1bMV0pO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gZ2V0U3VwZXJDaGFyZ2VkKHBsdWdpbjogTWF0aExpbmtzLCBmaWxlOiBURmlsZSk6IFtzdHJpbmcsIFtzdHJpbmcsIHN0cmluZ11bXV0ge1xuICAgIGNvbnN0IGRhdGEgPSBwbHVnaW4uYXBwLnBsdWdpbnMucGx1Z2luc1tcInN1cGVyY2hhcmdlZC1saW5rcy1vYnNpZGlhblwiXT8uc2V0dGluZ3M7XG5cbiAgICBsZXQgdGFnQXJyID0gcGx1Z2luLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZShmaWxlKT8udGFncztcbiAgICBsZXQgdGFnczogc3RyaW5nID0gXCJcIjtcbiAgICBpZiAodGFnQXJyKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGFnQXJyLmxlbmd0aDsgaSsrKVxuICAgICAgICAgICAgdGFncyArPSB0YWdBcnJbaV0udGFnLnJlcGxhY2UoLyMvLCBcIlwiKSArIFwiIFwiO1xuICAgICAgICB0YWdzID0gdGFncy50cmltRW5kKCk7XG4gICAgfVxuXG4gICAgbGV0IGF0dHJpYnV0ZXM6IFtzdHJpbmcsIHN0cmluZ11bXSA9IFtdO1xuICAgIGxldCBmcm9udG1hdHRlciA9IHBsdWdpbi5hcHAubWV0YWRhdGFDYWNoZS5nZXRGaWxlQ2FjaGUoZmlsZSk/LmZyb250bWF0dGVyO1xuICAgIGlmIChkYXRhKSB7XG4gICAgICAgIGZvciAobGV0IGF0dHIgaW4gZnJvbnRtYXR0ZXIpIHtcbiAgICAgICAgICAgIGlmIChhdHRyICE9IFwibWF0aExpbmtcIiAmJiBhdHRyICE9IFwicG9zaXRpb25cIikge1xuICAgICAgICAgICAgICAgIGxldCBzZWxlY3RvcnMgPSBkYXRhLnNlbGVjdG9ycztcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNlbGVjdG9ycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZWN0b3JzW2ldLm5hbWUgPT0gYXR0ciAmJiBzZWxlY3RvcnNbaV0udmFsdWUgPT0gZnJvbnRtYXR0ZXJbYXR0cl0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXMucHVzaChbYXR0ciwgZnJvbnRtYXR0ZXJbYXR0cl1dKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChzZWxlY3RvcnNbaV0udHlwZSA9PSBcInRhZ1wiICYmIHNlbGVjdG9yc1tpXS52YWx1ZSA9PSBmcm9udG1hdHRlclthdHRyXSAmJiBkYXRhLnRhcmdldFRhZ3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZXMucHVzaChbYXR0ciwgZnJvbnRtYXR0ZXJbYXR0cl1dKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBbdGFncywgYXR0cmlidXRlc107XG59XG4iLCAiZXhwb3J0IGludGVyZmFjZSBNYXRoTGlua3NTZXR0aW5ncyB7XG4gICAgdGVtcGxhdGVzOiBUZW1wbGF0ZVtdO1xuICAgIGV4Y2x1ZGVkUGF0aHM6IHN0cmluZ1tdO1xuICAgIGJsb2NrUHJlZml4OiBzdHJpbmc7XG4gICAgZW5hYmxlRmlsZU5hbWVCbG9ja0xpbmtzOiBib29sZWFuO1xuICAgIGVuYWJsZUluU291cmNlTW9kZTogYm9vbGVhbjtcbn1cblxuZXhwb3J0IHR5cGUgVGVtcGxhdGUgPSB7XG4gICAgcmVwbGFjZWQ6IHN0cmluZztcbiAgICByZXBsYWNlbWVudDogc3RyaW5nO1xuICAgIGdsb2JhbE1hdGNoOiBib29sZWFuO1xuICAgIHNlbnNpdGl2ZTogYm9vbGVhbjtcbiAgICB3b3JkOiBib29sZWFuO1xufVxuXG5leHBvcnQgY29uc3QgREVGQVVMVF9TRVRUSU5HUzogTWF0aExpbmtzU2V0dGluZ3MgPSB7XG4gICAgdGVtcGxhdGVzOiBbXSxcbiAgICBleGNsdWRlZFBhdGhzOiBbXSxcbiAgICBibG9ja1ByZWZpeDogXCJeXCIsXG4gICAgZW5hYmxlRmlsZU5hbWVCbG9ja0xpbmtzOiB0cnVlLFxuICAgIGVuYWJsZUluU291cmNlTW9kZTogZmFsc2UsXG59XG4iLCAiaW1wb3J0IHsgU2V0dGluZywgUGx1Z2luU2V0dGluZ1RhYiwgQXBwIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBUZXh0Q29tcG9uZW50LCBUb2dnbGVDb21wb25lbnQsIEJ1dHRvbkNvbXBvbmVudCB9IGZyb20gXCJvYnNpZGlhblwiXG5pbXBvcnQgeyBUZW1wbGF0ZXNNb2RhbCwgRXhjbHVkZU1vZGFsIH0gZnJvbSBcIi4vbW9kYWxzXCJcbmltcG9ydCBNYXRoTGlua3MgZnJvbSBcIi4uL21haW5cIlxuXG5leHBvcnQgY2xhc3MgTWF0aExpbmtzU2V0dGluZ1RhYiBleHRlbmRzIFBsdWdpblNldHRpbmdUYWIge1xuICAgIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwdWJsaWMgcGx1Z2luOiBNYXRoTGlua3MpIHtcbiAgICAgICAgc3VwZXIoYXBwLCBwbHVnaW4pO1xuICAgIH1cblxuICAgIGFzeW5jIGRpc3BsYXkoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGNvbnN0IHsgY29udGFpbmVyRWwgfSA9IHRoaXM7XG5cbiAgICAgICAgY29udGFpbmVyRWwuZW1wdHkoKTtcbiAgICAgICAgY29udGFpbmVyRWwuY3JlYXRlRWwoXCJoMlwiLCB7IHRleHQ6IFwiTWF0aExpbmtzIFNldHRpbmdzXCIgfSk7XG5cbiAgICAgICAgLy8gVGVtcGxhdGVzXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoXCJUZW1wbGF0ZXNcIilcbiAgICAgICAgICAgIC5zZXREZXNjKFxuICAgICAgICAgICAgICAgIGNyZWF0ZUZyYWdtZW50KChlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGUuY3JlYXRlU3Bhbih7IHRleHQ6IFwiR2VuZXJhdGUgbWF0aExpbmtzIHdpdGggYSB0ZW1wbGF0ZS4gVXNlIFwiIH0pO1xuICAgICAgICAgICAgICAgICAgICBlLmNyZWF0ZUVsKFwiY29kZVwiLCB7IHRleHQ6IFwibWF0aExpbms6IGF1dG9cIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgZS5jcmVhdGVTcGFuKHsgdGV4dDogXCIgdG8gdXNlIHRlbXBsYXRlcyBpbiBhIGZpbGUuXCIgfSk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIC5hZGRCdXR0b24oKGJ1dHRvbjogQnV0dG9uQ29tcG9uZW50KTogQnV0dG9uQ29tcG9uZW50ID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYnV0dG9uLnNldEJ1dHRvblRleHQoXCJNYW5hZ2VcIikub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBtb2RhbCA9IG5ldyBUZW1wbGF0ZXNNb2RhbCh0aGlzLmFwcCwgdGhpcy5wbHVnaW4pO1xuICAgICAgICAgICAgICAgICAgICBtb2RhbC5vcGVuKCk7XG4gICAgICAgICAgICAgICAgICAgIG1vZGFsLm9uQ2xvc2UgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc3BsYXkoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gRXhjbHVkZWQgZmlsZXNcbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAgICAgICAuc2V0TmFtZShcIkV4Y2x1ZGVkIGZpbGVzXCIpXG4gICAgICAgICAgICAuc2V0RGVzYyhcIk1hbmFnZSBmaWxlcy9wYXRocyB0aGF0IE1hdGhMaW5rcyB3aWxsIGlnbm9yZS5cIilcbiAgICAgICAgICAgIC5hZGRCdXR0b24oKGJ1dHRvbjogQnV0dG9uQ29tcG9uZW50KTogQnV0dG9uQ29tcG9uZW50ID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYnV0dG9uLnNldEJ1dHRvblRleHQoXCJNYW5hZ2VcIikub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBtb2RhbCA9IG5ldyBFeGNsdWRlTW9kYWwodGhpcy5hcHAsIHRoaXMucGx1Z2luKTtcbiAgICAgICAgICAgICAgICAgICAgbW9kYWwub3BlbigpO1xuICAgICAgICAgICAgICAgICAgICBtb2RhbC5vbkNsb3NlID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXNwbGF5KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEJsb2NrIGxpbmtzXG4gICAgICAgIGxldCBwcmVmaXg6IFRleHRDb21wb25lbnQ7XG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoXCJFZGl0IHByZWZpeCBmb3IgYmxvY2sgbGlua3NcIilcbiAgICAgICAgICAgIC5zZXREZXNjKFxuICAgICAgICAgICAgICAgIGNyZWF0ZUZyYWdtZW50KChlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGUuY3JlYXRlU3Bhbih7IHRleHQ6IFwiTGlua3MgbGlrZSBcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgZS5jcmVhdGVFbChcImNvZGVcIiwgeyB0ZXh0OiBcIm5vdGUjXmJsb2NrLWlkXCIgfSk7XG4gICAgICAgICAgICAgICAgICAgIGUuY3JlYXRlU3Bhbih7IHRleHQ6IFwiIHdpbGwgYmUgcmVuZGVyZWQgYXNcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZUZpbGVOYW1lQmxvY2tMaW5rcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5jcmVhdGVFbChcImNvZGVcIiwgeyB0ZXh0OiBcIm5vdGUgPiBcIiArIHRoaXMucGx1Z2luLnNldHRpbmdzLmJsb2NrUHJlZml4ICsgXCJibG9jay1pZFwiIH0pO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5jcmVhdGVFbChcImNvZGVcIiwgeyB0ZXh0OiB0aGlzLnBsdWdpbi5zZXR0aW5ncy5ibG9ja1ByZWZpeCArIFwiYmxvY2staWRcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlLmNyZWF0ZVNwYW4oeyB0ZXh0OiBcIi5cIiB9KTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLmFkZFRleHQoKHRleHQpID0+IHtcbiAgICAgICAgICAgICAgICBwcmVmaXggPSB0ZXh0O1xuICAgICAgICAgICAgICAgIHByZWZpeC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5ibG9ja1ByZWZpeCkub25DaGFuZ2UoYXN5bmMgKGN1cnJlbnQ6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5ibG9ja1ByZWZpeCA9IGN1cnJlbnQ7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHByZWZpeC5zZXRQbGFjZWhvbGRlcihcIk5vIHByZWZpeCAoZGVmYXVsdDogXilcIik7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlOiBUb2dnbGVDb21wb25lbnQpID0+IHtcbiAgICAgICAgICAgICAgICB0b2dnbGUuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuZW5hYmxlRmlsZU5hbWVCbG9ja0xpbmtzKVxuICAgICAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlOiBib29sZWFuKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5lbmFibGVGaWxlTmFtZUJsb2NrTGlua3MgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzcGxheSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRvZ2dsZS5zZXRUb29sdGlwKFwiRGlzYWJsZSB0byBpZ25vcmUgbm90ZSBuYW1lLlwiKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFNvdXJjZSBtb2RlXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoXCJFbmFibGUgaW4gU291cmNlIG1vZGVcIilcbiAgICAgICAgICAgIC5zZXREZXNjKFwiQ3VycmVudGx5LCBvbmx5IHdpa2lsaW5rcyBhcmUgc3VwcG9ydGVkIGluIFNvdXJjZSBtb2RlLlwiKVxuICAgICAgICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlOiBUb2dnbGVDb21wb25lbnQpID0+IHtcbiAgICAgICAgICAgICAgICB0b2dnbGUuc2V0VmFsdWUodGhpcy5wbHVnaW4ubmF0aXZlUHJvdmlkZXIuZW5hYmxlSW5Tb3VyY2VNb2RlKVxuICAgICAgICAgICAgICAgICAgICAub25DaGFuZ2UoKHZhbHVlOiBib29sZWFuKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5uYXRpdmVQcm92aWRlci5lbmFibGVJblNvdXJjZU1vZGUgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG59XG4iLCAiaW1wb3J0IHsgU2V0dGluZywgTW9kYWwsIE5vdGljZSwgVEZpbGUsIFRBYnN0cmFjdEZpbGUsIFRGb2xkZXIsIEZ1enp5U3VnZ2VzdE1vZGFsLCBBcHAgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IFRleHRDb21wb25lbnQsIEV4dHJhQnV0dG9uQ29tcG9uZW50IH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBUZW1wbGF0ZSB9IGZyb20gXCIuL3NldHRpbmdzXCI7XG5pbXBvcnQgeyBpc0VxdWFsVG9PckNoaWxkT2YgfSBmcm9tIFwiLi4vdXRpbHNcIjtcbmltcG9ydCBNYXRoTGlua3MgZnJvbSBcIi4uL21haW5cIlxuXG5leHBvcnQgY2xhc3MgVGVtcGxhdGVzTW9kYWwgZXh0ZW5kcyBNb2RhbCB7XG4gICAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHB1YmxpYyBwbHVnaW46IE1hdGhMaW5rcykge1xuICAgICAgICBzdXBlcihhcHApO1xuICAgIH1cblxuICAgIG9uT3BlbigpIHtcbiAgICAgICAgdGhpcy5kaXNwbGF5KCk7XG4gICAgfVxuXG4gICAgLy8gQ3JlZGl0cyB0byBSeW90YVVzaGlvL29ic2lkaWFuLW1hdGgtYm9vc3RlclxuICAgIGFzeW5jIGRpc3BsYXkoKSB7XG4gICAgICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgICAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgICAgICAgY29udGVudEVsLmNyZWF0ZUVsKFwiaDRcIiwgeyB0ZXh0OiBcIkFkZC9FZGl0IFRlbXBsYXRlc1wiIH0pO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRlbnRFbClcbiAgICAgICAgICAgIC5zZXROYW1lKFxuICAgICAgICAgICAgICAgIGNyZWF0ZUZyYWdtZW50KChlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGUuY3JlYXRlU3Bhbih7IHRleHQ6IFwiVGhlIHRlbXBsYXRlcyBpbiB0aGUgbGlzdCBiZWxvdyBhcmUgc29ydGVkIGJ5IHByZWNlZGVuY2UsIHdpdGggdGhlIHRvcCBiZWluZyByZXBsYWNlZCBmaXJzdC4gTm90ZSB0aGF0IFwiIH0pO1xuICAgICAgICAgICAgICAgICAgICBlLmNyZWF0ZUVsKFwiY29kZVwiLCB7IHRleHQ6IFwiYVwiIH0pO1xuICAgICAgICAgICAgICAgICAgICBlLmNyZWF0ZVNwYW4oeyB0ZXh0OiBcIiA+IFwiIH0pO1xuICAgICAgICAgICAgICAgICAgICBlLmNyZWF0ZUVsKFwiY29kZVwiLCB7IHRleHQ6IFwiYlwiIH0pO1xuICAgICAgICAgICAgICAgICAgICBlLmNyZWF0ZVNwYW4oeyB0ZXh0OiBcIiBmb2xsb3dlZCBieSBcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgZS5jcmVhdGVFbChcImNvZGVcIiwgeyB0ZXh0OiBcImJcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgZS5jcmVhdGVTcGFuKHsgdGV4dDogXCIgPiBcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgZS5jcmVhdGVFbChcImNvZGVcIiwgeyB0ZXh0OiBcImNcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgZS5jcmVhdGVTcGFuKHsgdGV4dDogXCIgdG9nZXRoZXIgaXMgZXF1aXZhbGVudCB0byBcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgZS5jcmVhdGVFbChcImNvZGVcIiwgeyB0ZXh0OiBcImFcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgZS5jcmVhdGVTcGFuKHsgdGV4dDogXCIgPiBcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgZS5jcmVhdGVFbChcImNvZGVcIiwgeyB0ZXh0OiBcImNcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgZS5jcmVhdGVTcGFuKHsgdGV4dDogXCIsIGJ1dCBub3QgdGhlIG90aGVyIHdheSBhcm91bmQuXCIgfSk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIC5hZGRCdXR0b24oKGJ0bikgPT4ge1xuICAgICAgICAgICAgICAgIGJ0bi5zZXRUb29sdGlwKFwiQWRkXCIpLnNldEljb24oXCJwbHVzXCIpXG4gICAgICAgICAgICAgICAgICAgIC5vbkNsaWNrKChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG5ld1RlbXBsYXRlOiBUZW1wbGF0ZSA9IHsgcmVwbGFjZWQ6IFwiXCIsIHJlcGxhY2VtZW50OiBcIlwiLCBnbG9iYWxNYXRjaDogdHJ1ZSwgc2Vuc2l0aXZlOiB0cnVlLCB3b3JkOiB0cnVlIH07XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgVGVtcGxhdGVTZXR0aW5nc01vZGFsKHRoaXMuYXBwLCB0aGlzLnBsdWdpbiwgdGhpcywgbmV3VGVtcGxhdGUsIHRydWUpLm9wZW4oKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICBpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3MudGVtcGxhdGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgbGV0IGxpc3QgPSBjb250ZW50RWwuY3JlYXRlRWwoXCJ1bFwiKTtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wbHVnaW4uc2V0dGluZ3MudGVtcGxhdGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgbGV0IHRlbXBsYXRlID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MudGVtcGxhdGVzW2ldO1xuICAgICAgICAgICAgICAgIGxldCBpdGVtID0gbGlzdC5jcmVhdGVFbChcImxpXCIpLmNyZWF0ZURpdigpO1xuXG4gICAgICAgICAgICAgICAgbmV3IFNldHRpbmcoaXRlbSlcbiAgICAgICAgICAgICAgICAgICAgLnNldE5hbWUoXG4gICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVGcmFnbWVudCgoZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuY3JlYXRlRWwoXCJjb2RlXCIsIHsgdGV4dDogdGVtcGxhdGUucmVwbGFjZWQgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5jcmVhdGVTcGFuKHsgdGV4dDogXCIgPiBcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLmNyZWF0ZUVsKFwiY29kZVwiLCB7IHRleHQ6IHRlbXBsYXRlLnJlcGxhY2VtZW50IH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAuYWRkRXh0cmFCdXR0b24oKGJ1dHRvbjogRXh0cmFCdXR0b25Db21wb25lbnQpOiBFeHRyYUJ1dHRvbkNvbXBvbmVudCA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYnV0dG9uLnNldFRvb2x0aXAoXCJNb3ZlIHVwXCIpLnNldEljb24oXCJ1cC1hcnJvdy13aXRoLXRhaWxcIikub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkgIT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZG93biA9IHsuLi50ZW1wbGF0ZX07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCB1cCA9IHRoaXMucGx1Z2luLnNldHRpbmdzLnRlbXBsYXRlc1tpIC0gMV07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MudGVtcGxhdGVzW2ldID0gdXA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnRlbXBsYXRlc1tpIC0gMV0gPSBkb3duO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzcGxheSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmFkZEV4dHJhQnV0dG9uKChidXR0b246IEV4dHJhQnV0dG9uQ29tcG9uZW50KTogRXh0cmFCdXR0b25Db21wb25lbnQgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJ1dHRvbi5zZXRUb29sdGlwKFwiTW92ZSBkb3duXCIpLnNldEljb24oXCJkb3duLWFycm93LXdpdGgtdGFpbFwiKS5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSAhPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy50ZW1wbGF0ZXMubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgdXAgPSB7Li4udGVtcGxhdGV9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZG93biA9IHRoaXMucGx1Z2luLnNldHRpbmdzLnRlbXBsYXRlc1tpICsgMV07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MudGVtcGxhdGVzW2ldID0gZG93bjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MudGVtcGxhdGVzW2krMV0gPSB1cDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc3BsYXkoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5hZGRFeHRyYUJ1dHRvbigoYnV0dG9uOiBFeHRyYUJ1dHRvbkNvbXBvbmVudCk6IEV4dHJhQnV0dG9uQ29tcG9uZW50ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBidXR0b24uc2V0VG9vbHRpcChcIkVkaXRcIikuc2V0SWNvbihcImVkaXRcIikub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG1vZGFsID0gbmV3IFRlbXBsYXRlU2V0dGluZ3NNb2RhbCh0aGlzLmFwcCwgdGhpcy5wbHVnaW4sIHRoaXMsIHRlbXBsYXRlLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWwub3BlbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGFsLm9uQ2xvc2UgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXNwbGF5KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmFkZEV4dHJhQnV0dG9uKChidXR0b246IEV4dHJhQnV0dG9uQ29tcG9uZW50KTogRXh0cmFCdXR0b25Db21wb25lbnQgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJ1dHRvbi5zZXRUb29sdGlwKFwiUmVtb3ZlXCIpLnNldEljb24oXCJ4XCIpLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnRlbXBsYXRlcy5yZW1vdmUodGVtcGxhdGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc3BsYXkoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cblxuY2xhc3MgVGVtcGxhdGVTZXR0aW5nc01vZGFsIGV4dGVuZHMgTW9kYWwge1xuICAgIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwdWJsaWMgcGx1Z2luOiBNYXRoTGlua3MsIHB1YmxpYyBtb2RhbDogVGVtcGxhdGVzTW9kYWwsIHB1YmxpYyB0ZW1wbGF0ZTogVGVtcGxhdGUsIHB1YmxpYyBjcmVhdGU6IGJvb2xlYW4pIHtcbiAgICAgICAgc3VwZXIoYXBwKTtcbiAgICB9XG5cbiAgICBvbk9wZW4oKSB7XG4gICAgICAgIHRoaXMuZGlzcGxheSgpO1xuICAgIH1cblxuICAgIGFzeW5jIGRpc3BsYXkoKSB7XG4gICAgICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgICAgICBjb250ZW50RWwuZW1wdHkoKTtcblxuICAgICAgICBsZXQgcmVwbGFjZWRUZXh0OiBUZXh0Q29tcG9uZW50O1xuICAgICAgICBuZXcgU2V0dGluZyhjb250ZW50RWwpXG4gICAgICAgICAgICAuc2V0TmFtZShcIk1hdGNoIGZvci4uLlwiKVxuICAgICAgICAgICAgLnNldERlc2MoXCJTdHJpbmcgdG8gYmUgbWF0Y2hlZCBhbmQgcmVwbGFjZWQuIERvIG5vdCBpbmNsdWRlIHJlZ2V4LlwiKVxuICAgICAgICAgICAgLmFkZFRleHQoKHRleHQpID0+IHtcbiAgICAgICAgICAgICAgICByZXBsYWNlZFRleHQgPSB0ZXh0O1xuICAgICAgICAgICAgICAgIHJlcGxhY2VkVGV4dC5zZXRWYWx1ZSh0aGlzLnRlbXBsYXRlLnJlcGxhY2VkKS5vbkNoYW5nZSgoY3VycmVudCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRlbXBsYXRlLnJlcGxhY2VkID0gY3VycmVudDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIGxldCByZXBsYWNlbWVudFRleHQ6IFRleHRDb21wb25lbnQ7XG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRlbnRFbClcbiAgICAgICAgICAgIC5zZXROYW1lKFwiUmVwbGFjZSB3aXRoLi4uXCIpXG4gICAgICAgICAgICAuc2V0RGVzYyhcIlN0cmluZyB0byByZXBsYWNlIG1hdGNoZXMuIERvIG5vdCBlc2NhcGUgYmFja3NsYXNoZXMuXCIpXG4gICAgICAgICAgICAuYWRkVGV4dCgodGV4dCkgPT4ge1xuICAgICAgICAgICAgICAgIHJlcGxhY2VtZW50VGV4dCA9IHRleHQ7XG4gICAgICAgICAgICAgICAgcmVwbGFjZW1lbnRUZXh0LnNldFZhbHVlKHRoaXMudGVtcGxhdGUucmVwbGFjZW1lbnQpLm9uQ2hhbmdlKChjdXJyZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGVtcGxhdGUucmVwbGFjZW1lbnQgPSBjdXJyZW50O1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgbmV3IFNldHRpbmcoY29udGVudEVsKVxuICAgICAgICAgICAgLnNldE5hbWUoXCJHbG9iYWwgbWF0Y2hcIilcbiAgICAgICAgICAgIC5zZXREZXNjKFwiTWF0Y2ggYWxsIGluc3RhbmNlcyAoaW5zdGVhZCBvZiBqdXN0IHRoZSBmaXJzdCkuXCIpXG4gICAgICAgICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+IHtcbiAgICAgICAgICAgICAgICB0b2dnbGUuc2V0VmFsdWUodGhpcy50ZW1wbGF0ZS5nbG9iYWxNYXRjaCkub25DaGFuZ2UoKGN1cnJlbnQpID0+ICh0aGlzLnRlbXBsYXRlLmdsb2JhbE1hdGNoID0gY3VycmVudCkpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgbmV3IFNldHRpbmcoY29udGVudEVsKVxuICAgICAgICAgICAgLnNldE5hbWUoXCJDYXNlIHNlbnNpdGl2ZVwiKVxuICAgICAgICAgICAgLnNldERlc2MoXCJNYXRjaGVzIHdpbGwgYmUgY2FzZSBzZW5zaXRpdmUuXCIpXG4gICAgICAgICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+IHtcbiAgICAgICAgICAgICAgICB0b2dnbGUuc2V0VmFsdWUodGhpcy50ZW1wbGF0ZS5zZW5zaXRpdmUpLm9uQ2hhbmdlKChjdXJyZW50KSA9PiAodGhpcy50ZW1wbGF0ZS5zZW5zaXRpdmUgPSBjdXJyZW50KSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICBuZXcgU2V0dGluZyhjb250ZW50RWwpXG4gICAgICAgICAgICAuc2V0TmFtZShcIk1hdGNoIHdob2xlIHdvcmRzXCIpXG4gICAgICAgICAgICAuc2V0RGVzYyhcIk9ubHkgbWF0Y2ggd2hvbGUgd29yZHMuXCIpXG4gICAgICAgICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+IHtcbiAgICAgICAgICAgICAgICB0b2dnbGUuc2V0VmFsdWUodGhpcy50ZW1wbGF0ZS53b3JkKS5vbkNoYW5nZSgoY3VycmVudCkgPT4gKHRoaXMudGVtcGxhdGUud29yZCA9IGN1cnJlbnQpKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRlbnRFbClcbiAgICAgICAgICAgIC5hZGRCdXR0b24oKGIpID0+IHtcbiAgICAgICAgICAgICAgICBiLnNldFRvb2x0aXAodGhpcy5jcmVhdGUgPyBcIkFkZFwiIDogXCJTYXZlXCIpLnNldEljb24oXCJjaGVja21hcmtcIikub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnRlbXBsYXRlLnJlcGxhY2VkID09IFwiXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoXCJNYXRoTGlua3M6IFBsZWFzZSBlbnRlciBhIG5vbi1lbXB0eSBzdHJpbmcgdG8gYmUgcmVwbGFjZWRcIik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jcmVhdGUpIHRoaXMucGx1Z2luLnNldHRpbmdzLnRlbXBsYXRlcy5wdXNoKHRoaXMudGVtcGxhdGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kYWwuZGlzcGxheSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuYWRkRXh0cmFCdXR0b24oKGI6IEV4dHJhQnV0dG9uQ29tcG9uZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgYi5zZXRUb29sdGlwKFwiQ2FuY2VsXCIpLnNldEljb24oXCJjcm9zc1wiKS5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgRXhjbHVkZU1vZGFsIGV4dGVuZHMgTW9kYWwge1xuICAgIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwdWJsaWMgcGx1Z2luOiBNYXRoTGlua3MpIHtcbiAgICAgICAgc3VwZXIoYXBwKTtcbiAgICB9XG5cbiAgICBvbk9wZW4oKSB7XG4gICAgICAgIHRoaXMuZGlzcGxheSgpO1xuICAgIH1cblxuICAgIC8vIENyZWRpdHMgdG8gUnlvdGFVc2hpby9vYnNpZGlhbi1tYXRoLWJvb3N0ZXJcbiAgICBhc3luYyBkaXNwbGF5KCkge1xuICAgICAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICAgICAgY29udGVudEVsLmVtcHR5KCk7XG4gICAgICAgIGNvbnRlbnRFbC5jcmVhdGVFbChcImg0XCIsIHsgdGV4dDogXCJFeGNsdWRlZCBmaWxlc1wiIH0pO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRlbnRFbClcbiAgICAgICAgICAgIC5zZXROYW1lKFwiVGhlIGZpbGVzL2ZvbGRlcnMgaW4gdGhpcyBsaXN0IHdpbGwgYmUgaWdub3JlZCBieSBNYXRoTGlua3MuXCIpXG4gICAgICAgICAgICAuYWRkQnV0dG9uKChidG4pID0+IHtcbiAgICAgICAgICAgICAgICBidG4uc2V0VG9vbHRpcChcIkFkZFwiKS5zZXRJY29uKFwicGx1c1wiKVxuICAgICAgICAgICAgICAgICAgICAub25DbGljaygoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBGaWxlRXhjbHVkZVN1Z2dlc3RNb2RhbCh0aGlzLmFwcCwgdGhpcy5wbHVnaW4sIHRoaXMpLm9wZW4oKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICBpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3MuZXhjbHVkZWRQYXRocy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGxldCBsaXN0ID0gY29udGVudEVsLmNyZWF0ZUVsKFwidWxcIik7XG4gICAgICAgICAgICBmb3IgKGxldCBwYXRoIG9mIHRoaXMucGx1Z2luLnNldHRpbmdzLmV4Y2x1ZGVkUGF0aHMpIHtcbiAgICAgICAgICAgICAgICBsZXQgaXRlbSA9IGxpc3QuY3JlYXRlRWwoXCJsaVwiKS5jcmVhdGVEaXYoKTtcbiAgICAgICAgICAgICAgICBuZXcgU2V0dGluZyhpdGVtKS5zZXROYW1lKHBhdGgpLmFkZEV4dHJhQnV0dG9uKChidXR0b246IEV4dHJhQnV0dG9uQ29tcG9uZW50KTogRXh0cmFCdXR0b25Db21wb25lbnQgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYnV0dG9uLnNldFRvb2x0aXAoXCJSZW1vdmVcIikuc2V0SWNvbihcInhcIikub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5leGNsdWRlZFBhdGhzLnJlbW92ZShwYXRoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzcGxheSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuXG5hYnN0cmFjdCBjbGFzcyBGaWxlU3VnZ2VzdE1vZGFsIGV4dGVuZHMgRnV6enlTdWdnZXN0TW9kYWw8VEFic3RyYWN0RmlsZT4ge1xuICAgIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwdWJsaWMgcGx1Z2luOiBNYXRoTGlua3MpIHtcbiAgICAgICAgc3VwZXIoYXBwKTtcbiAgICB9XG5cbiAgICBnZXRJdGVtcygpOiBUQWJzdHJhY3RGaWxlW10ge1xuICAgICAgICByZXR1cm4gdGhpcy5hcHAudmF1bHQuZ2V0QWxsTG9hZGVkRmlsZXMoKS5maWx0ZXIodGhpcy5maWx0ZXJDYWxsYmFjay5iaW5kKHRoaXMpKTtcbiAgICB9XG5cbiAgICBnZXRJdGVtVGV4dChmaWxlOiBUQWJzdHJhY3RGaWxlKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIGZpbGUucGF0aDtcbiAgICB9XG5cbiAgICBmaWx0ZXJDYWxsYmFjayhhYnN0cmFjdEZpbGU6IFRBYnN0cmFjdEZpbGUpOiBib29sZWFuIHtcbiAgICAgICAgaWYgKGFic3RyYWN0RmlsZSBpbnN0YW5jZW9mIFRGaWxlICYmIGFic3RyYWN0RmlsZS5leHRlbnNpb24gIT0gXCJtZFwiKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIGlmIChhYnN0cmFjdEZpbGUgaW5zdGFuY2VvZiBURm9sZGVyICYmIGFic3RyYWN0RmlsZS5pc1Jvb3QoKSkgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgIGZvciAoY29uc3QgcGF0aCBvZiB0aGlzLnBsdWdpbi5zZXR0aW5ncy5leGNsdWRlZFBhdGhzKSB7XG4gICAgICAgICAgICBjb25zdCBmaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKHBhdGgpXG4gICAgICAgICAgICBpZiAoZmlsZSAmJiBpc0VxdWFsVG9PckNoaWxkT2YoYWJzdHJhY3RGaWxlLCBmaWxlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxufVxuXG5jbGFzcyBGaWxlRXhjbHVkZVN1Z2dlc3RNb2RhbCBleHRlbmRzIEZpbGVTdWdnZXN0TW9kYWwge1xuICAgIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwbHVnaW46IE1hdGhMaW5rcywgcHVibGljIG1vZGFsOiBFeGNsdWRlTW9kYWwpIHtcbiAgICAgICAgc3VwZXIoYXBwLCBwbHVnaW4pO1xuICAgIH1cblxuICAgIGFzeW5jIG9uQ2hvb3NlSXRlbShmaWxlOiBUQWJzdHJhY3RGaWxlLCBldnQ6IE1vdXNlRXZlbnQgfCBLZXlib2FyZEV2ZW50KSB7XG4gICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmV4Y2x1ZGVkUGF0aHMucHVzaChmaWxlLnBhdGgpO1xuICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMubW9kYWwuZGlzcGxheSgpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG4iLCAiLyoqXG4gKiBUaGlzIGZpbGVzIGNvbnRhaW5zIHRoZSBvYnNvbGV0ZSBBUEkuIFVzZSB0aGUgbmV3IEFQSSBpbiBwcm92aWRlci50cyBpbnN0ZWFkLlxuICovXG5cbmltcG9ydCB7IEJsb2NrU3VicGF0aFJlc3VsdCwgSGVhZGluZ1N1YnBhdGhSZXN1bHQsIFBsdWdpbk1hbmlmZXN0LCBURmlsZSB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCBNYXRoTGlua3MgZnJvbSAnLi4vbWFpbic7XG5pbXBvcnQgeyBpbmZvcm1DaGFuZ2UgfSBmcm9tICdzcmMvdXRpbHMnO1xuXG5leHBvcnQgaW50ZXJmYWNlIE1hdGhMaW5rc01ldGFkYXRhIHtcbiAgICBcIm1hdGhMaW5rXCI/OiBzdHJpbmc7XG4gICAgXCJtYXRoTGluay1ibG9ja3NcIj86IFJlY29yZDxzdHJpbmcsIHN0cmluZz47XG59XG5cbmV4cG9ydCB0eXBlIE1hdGhMaW5rc01ldGFkYXRhU2V0ID0gTWFwPFRGaWxlLCBNYXRoTGlua3NNZXRhZGF0YT47XG5cbmV4cG9ydCBjbGFzcyBNYXRoTGlua3NBUElBY2NvdW50IHtcbiAgICBtZXRhZGF0YVNldDogTWF0aExpbmtzTWV0YWRhdGFTZXQ7XG5cbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgcGx1Z2luOiBNYXRoTGlua3MsIHB1YmxpYyBtYW5pZmVzdDogUmVhZG9ubHk8UGx1Z2luTWFuaWZlc3Q+LCBwdWJsaWMgYmxvY2tQcmVmaXg6IHN0cmluZywgcHVibGljIHByZWZpeGVyOiAoc291cmNlRmlsZTogVEZpbGUsIHRhcmdldEZpbGU6IFRGaWxlLCBzdWJwYXRoUmVzdWx0OiBIZWFkaW5nU3VicGF0aFJlc3VsdCB8IEJsb2NrU3VicGF0aFJlc3VsdCkgPT4gc3RyaW5nIHwgbnVsbCkge1xuICAgICAgICB0aGlzLm1ldGFkYXRhU2V0ID0gbmV3IE1hcCgpO1xuICAgIH1cblxuICAgIGdldChmaWxlOiBURmlsZSwgYmxvY2tJRD86IHN0cmluZyk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG4gICAgICAgIC8vIElmIGJsb2NrSUQgPT09IHVuZGVmaW5lZCwgcmV0dXJuIG1hdGhMaW5rXG4gICAgICAgIC8vIElmIGJsb2NrSUQgaXMgZ2l2ZW4sIHJldHVybiB0aGUgY29ycmVzcG9uZGluZyBpdGVtIG9mIG1hdGhMaW5rLWJsb2Nrc1xuICAgICAgICBsZXQgbWV0YWRhdGEgPSB0aGlzLm1ldGFkYXRhU2V0LmdldChmaWxlKTtcbiAgICAgICAgaWYgKG1ldGFkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYmxvY2tJRCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1ldGFkYXRhW1wibWF0aExpbmtcIl07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgYmxvY2tzID0gbWV0YWRhdGFbXCJtYXRoTGluay1ibG9ja3NcIl07XG4gICAgICAgICAgICBpZiAoYmxvY2tzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGJsb2Nrc1tibG9ja0lEXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHVwZGF0ZShmaWxlOiBURmlsZSwgbmV3TWV0YWRhdGE6IE1hdGhMaW5rc01ldGFkYXRhKTogdm9pZCB7XG4gICAgICAgIGlmIChmaWxlLmV4dGVuc2lvbiA9PSBcIm1kXCIpIHtcbiAgICAgICAgICAgIHRoaXMubWV0YWRhdGFTZXQuc2V0KGZpbGUsIE9iamVjdC5hc3NpZ24oe30sIHRoaXMubWV0YWRhdGFTZXQuZ2V0KGZpbGUpLCBuZXdNZXRhZGF0YSkpO1xuICAgICAgICAgICAgaW5mb3JtQ2hhbmdlKHRoaXMucGx1Z2luLmFwcCwgXCJtYXRobGlua3M6dXBkYXRlXCIsIGZpbGUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoYE1hdGhMaW5rcyBBUEk6ICR7dGhpcy5tYW5pZmVzdC5uYW1lfSBwYXNzZWQgYSBub24tbWFya2Rvd24gZmlsZSAke2ZpbGUucGF0aH0gdG8gdXBkYXRlKCkuYCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBkZWxldGUoZmlsZTogVEZpbGUsIHdoaWNoPzogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIC8vIGB3aGljaCA9PT0gdW5kZWZpbmVkYDogcmVtb3ZlIGFsbCB0aGUgbWF0aExpbmtzIGFzc29jaWF0ZWQgd2l0aCBgcGF0aGBcbiAgICAgICAgLy8gYHdoaWNoID09IFwibWF0aExpbmtcIjogcmVtb3ZlIGBtYXRoTGlua2BcbiAgICAgICAgLy8gYHdoaWNoID09IFwibWF0aExpbmstYmxvY2tzXCI6IHJlbW92ZSBgbWF0aExpbmstYmxvY2tzYFxuICAgICAgICAvLyBgd2hpY2ggPT0gPGJsb2NrSUQ+YDogcmVtb3ZlIGBtYXRoTGluay1ibG9ja3NbPGJsb2NrSUQ+XWBcbiAgICAgICAgbGV0IG1ldGFkYXRhID0gdGhpcy5tZXRhZGF0YVNldC5nZXQoZmlsZSk7XG4gICAgICAgIGlmIChtZXRhZGF0YSkge1xuICAgICAgICAgICAgaWYgKHdoaWNoID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1ldGFkYXRhU2V0LmRlbGV0ZShmaWxlKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAod2hpY2ggPT0gXCJtYXRoTGlua1wiIHx8IHdoaWNoID09IFwibWF0aExpbmstYmxvY2tzXCIpIHtcbiAgICAgICAgICAgICAgICBpZiAobWV0YWRhdGFbd2hpY2hdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIG1ldGFkYXRhW3doaWNoXTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcihgTWF0aExpbmtzIEFQSTogJHt0aGlzLm1hbmlmZXN0Lm5hbWV9IGF0dGVtcHRlZCB0byBkZWxldGUgJHt3aGljaH0gb2YgJHtmaWxlLnBhdGh9LCBidXQgaXQgZG9lcyBub3QgZXhpc3QuYCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBsZXQgYmxvY2tzID0gbWV0YWRhdGFbXCJtYXRoTGluay1ibG9ja3NcIl07XG4gICAgICAgICAgICAgICAgaWYgKGJsb2NrcyAmJiBibG9ja3Nbd2hpY2hdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGJsb2Nrc1t3aGljaF07XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoYE1hdGhMaW5rcyBBUEk6ICR7dGhpcy5tYW5pZmVzdC5uYW1lfSBhdHRlbXB0ZWQgdG8gZGVsZXRlIG1hdGhMaW5rLWJsb2NrcyBmb3IgJHtmaWxlLnBhdGh9I14ke3doaWNofVwiLCBidXQgaXQgZG9lcyBub3QgZXhpc3RgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcihgTWF0aExpbmtzIEFQSTogJHt0aGlzLm1hbmlmZXN0Lm5hbWV9IGF0dGVtcHRlZCB0byBkZWxldGUgdGhlIE1hdGhMaW5rcyBtZXRhZGF0YSBvZiAke2ZpbGUucGF0aH0sIGJ1dCBpdCBkb2VzIG5vdCBleGlzdC5gKTtcbiAgICAgICAgfVxuICAgICAgICBpbmZvcm1DaGFuZ2UodGhpcy5wbHVnaW4uYXBwLCBcIm1hdGhsaW5rczp1cGRhdGVcIiwgZmlsZSk7XG4gICAgfVxufVxuIiwgImltcG9ydCB7IFRGaWxlLCBnZXRMaW5rcGF0aCwgTWFya2Rvd25SZW5kZXJDaGlsZCwgTWFya2Rvd25Qb3N0UHJvY2Vzc29yQ29udGV4dCB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgc2V0TWF0aExpbmssIGdldE1hdGhMaW5rIH0gZnJvbSBcIi4vaGVscGVyXCJcbmltcG9ydCB7IHRyYW5zbGF0ZUxpbmsgfSBmcm9tIFwiLi4vdXRpbHNcIjtcbmltcG9ydCBNYXRoTGlua3MgZnJvbSBcIi4uL21haW5cIlxuXG5leHBvcnQgY2xhc3MgTWF0aExpbmtzUmVuZGVyQ2hpbGQgZXh0ZW5kcyBNYXJrZG93blJlbmRlckNoaWxkIHtcbiAgICByZWFkb25seSB0YXJnZXRGaWxlOiBURmlsZSB8IG51bGw7XG4gICAgcmVhZG9ubHkgZ2V0TWF0aExpbms6ICgpID0+IHN0cmluZztcbiAgICBtYXRoTGlua0VsOiBIVE1MRWxlbWVudDtcblxuICAgIGNvbnN0cnVjdG9yKGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudCwgcHVibGljIHBsdWdpbjogTWF0aExpbmtzLCBwdWJsaWMgc291cmNlUGF0aDogc3RyaW5nLCBwdWJsaWMgdGFyZ2V0TGluazogc3RyaW5nLCBwdWJsaWMgZGlzcGxheVRleHQ6IHN0cmluZykge1xuICAgICAgICBzdXBlcihjb250YWluZXJFbCk7XG4gICAgICAgIHRoaXMudGFyZ2V0RmlsZSA9IHRoaXMucGx1Z2luLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpcnN0TGlua3BhdGhEZXN0KGdldExpbmtwYXRoKHRoaXMudGFyZ2V0TGluayksIHRoaXMuc291cmNlUGF0aCk7XG4gICAgICAgIHRoaXMubWF0aExpbmtFbCA9IHRoaXMuY29udGFpbmVyRWwuY2xvbmVOb2RlKHRydWUpIGFzIEhUTUxFbGVtZW50O1xuICAgICAgICB0aGlzLm1hdGhMaW5rRWwudGV4dENvbnRlbnQgPSBcIlwiO1xuICAgICAgICB0aGlzLmNvbnRhaW5lckVsLnBhcmVudE5vZGU/Lmluc2VydEJlZm9yZSh0aGlzLm1hdGhMaW5rRWwsIHRoaXMuY29udGFpbmVyRWwubmV4dFNpYmxpbmcpO1xuICAgICAgICB0aGlzLm1hdGhMaW5rRWwuY2xhc3NMaXN0LmFkZChcIm1hdGhMaW5rLWludGVybmFsLWxpbmtcIik7XG4gICAgICAgIHRoaXMuY29udGFpbmVyRWwuY2xhc3NMaXN0LmFkZChcIm9yaWdpbmFsLWludGVybmFsLWxpbmtcIik7XG4gICAgICAgIHRoaXMuY29udGFpbmVyRWwuY2xhc3NMaXN0LnJlbW92ZShcImludGVybmFsLWxpbmtcIik7IC8vICM1MTogdGhpcyBpcyB0byBmaXggdGhlIGluY29tcGF0aWJpbGl0eSB3aXRoIFN0cmFuZ2UgTmV3IFdvcmxkc1xuICAgICAgICB0aGlzLmNvbnRhaW5lckVsLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgdGhpcy5nZXRNYXRoTGluayA9IHRoaXMuc2V0TWF0aExpbmtHZXR0ZXIoKTtcbiAgICB9XG5cbiAgICBvbmxvYWQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMudXBkYXRlKCk7XG5cbiAgICAgICAgLy8gMS4gd2hlbiBhbiBBUEkgdXNlciB1cGRhdGVzIGl0cyBtZXRhZGF0YVxuICAgICAgICB0aGlzLnJlZ2lzdGVyRXZlbnQodGhpcy5wbHVnaW4uYXBwLm1ldGFkYXRhQ2FjaGUub24oXCJtYXRobGlua3M6dXBkYXRlXCIsIChjaGFuZ2VkRmlsZSkgPT4ge1xuICAgICAgICAgICAgaWYgKCF0aGlzLnRhcmdldEZpbGUgfHwgdGhpcy50YXJnZXRGaWxlID09IGNoYW5nZWRGaWxlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpO1xuXG4gICAgICAgIC8vIDIuIHdoZW4gYW4gQVBJIGFjY291bnQgaXMgZGVsZXRlZFxuICAgICAgICB0aGlzLnJlZ2lzdGVyRXZlbnQodGhpcy5wbHVnaW4uYXBwLm1ldGFkYXRhQ2FjaGUub24oXCJtYXRobGlua3M6dXBkYXRlLWFsbFwiLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZSgpO1xuICAgICAgICB9KSk7XG4gICAgfVxuXG4gICAgc2V0TWF0aExpbmtHZXR0ZXIoKTogKCkgPT4gc3RyaW5nIHtcbiAgICAgICAgbGV0IGdldHRlciA9ICgpID0+IFwiXCI7XG4gICAgICAgIGlmICh0aGlzLmRpc3BsYXlUZXh0ICE9IHRoaXMudGFyZ2V0TGluayAmJiB0aGlzLmRpc3BsYXlUZXh0ICE9IHRyYW5zbGF0ZUxpbmsodGhpcy50YXJnZXRMaW5rKSkge1xuICAgICAgICAgICAgLy8gW1tub3RlfGRpc3BsYXldXSAtPiB1c2UgZGlzcGxheSBhcyBtYXRoTGlua1xuICAgICAgICAgICAgZ2V0dGVyID0gKCkgPT4gdGhpcy5kaXNwbGF5VGV4dDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmRpc3BsYXlUZXh0ID09IHRoaXMudGFyZ2V0RmlsZT8ubmFtZSB8fCB0aGlzLmRpc3BsYXlUZXh0ID09IHRoaXMudGFyZ2V0RmlsZT8uYmFzZW5hbWUgfHwgdGhpcy5kaXNwbGF5VGV4dCA9PSB0cmFuc2xhdGVMaW5rKHRoaXMudGFyZ2V0TGluaykpIHtcbiAgICAgICAgICAgICAgICAvLyBbW25vdGVdXSwgW1tub3RlI2hlYWRpbmddXSBvciBbW25vdGUjXmJsb2NrSURdXVxuICAgICAgICAgICAgICAgIGdldHRlciA9ICgpID0+IGdldE1hdGhMaW5rKHRoaXMucGx1Z2luLCB0aGlzLnRhcmdldExpbmssIHRoaXMuc291cmNlUGF0aCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGdldHRlcjtcbiAgICB9XG5cbiAgICB1cGRhdGUoKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IG1hdGhMaW5rID0gdGhpcy5nZXRNYXRoTGluaygpO1xuXG4gICAgICAgIGlmIChtYXRoTGluaykge1xuICAgICAgICAgICAgc2V0TWF0aExpbmsobWF0aExpbmssIHRoaXMubWF0aExpbmtFbCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzZXRNYXRoTGluayh0aGlzLmRpc3BsYXlUZXh0LCB0aGlzLm1hdGhMaW5rRWwpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVNYXRoTGlua3MocGx1Z2luOiBNYXRoTGlua3MsIGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBjb250ZXh0OiBNYXJrZG93blBvc3RQcm9jZXNzb3JDb250ZXh0KTogdm9pZCB7XG4gICAgZm9yIChsZXQgdGFyZ2V0RWwgb2YgZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsPEhUTUxFbGVtZW50PihcIi5pbnRlcm5hbC1saW5rXCIpKSB7XG4gICAgICAgIGlmICh0YXJnZXRFbC5jbGFzc0xpc3QuY29udGFpbnMoXCJtYXRoTGluay1pbnRlcm5hbC1saW5rXCIpKSB7XG4gICAgICAgICAgICB0YXJnZXRFbC5yZW1vdmUoKTtcbiAgICAgICAgICAgIGxldCBxdWVyeVJlc3VsdCA9IGVsZW1lbnQucXVlcnlTZWxlY3RvcjxIVE1MRWxlbWVudD4oXCIub3JpZ2luYWwtaW50ZXJuYWwtbGlua1wiKTtcbiAgICAgICAgICAgIGlmIChxdWVyeVJlc3VsdCkge1xuICAgICAgICAgICAgICAgIHRhcmdldEVsID0gcXVlcnlSZXN1bHQ7XG4gICAgICAgICAgICAgICAgdGFyZ2V0RWwuY2xhc3NMaXN0LnJlbW92ZShcIm9yaWdpbmFsLWludGVybmFsLWxpbmtcIik7XG4gICAgICAgICAgICAgICAgdGFyZ2V0RWwuc3R5bGUuZGlzcGxheSA9IFwiXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB0YXJnZXREaXNwbGF5ID0gdGFyZ2V0RWwudGV4dENvbnRlbnQ/LnRyaW0oKS5yZXBsYWNlKC9cXC5tZC8sIFwiXCIpO1xuICAgICAgICBpZiAodGFyZ2V0RGlzcGxheSAhPSBcIlwiICYmICEvbWF0aC1pbmxpbmUgaXMtbG9hZGVkLy50ZXN0KHRhcmdldEVsLmlubmVySFRNTCkpIHtcbiAgICAgICAgICAgIGNvbnN0IHRhcmdldExpbmsgPSB0YXJnZXRFbC5nZXRBdHRyaWJ1dGUoXCJkYXRhLWhyZWZcIik/LnJlcGxhY2UoL1xcLm1kLywgXCJcIik7XG4gICAgICAgICAgICBpZiAodGFyZ2V0TGluaykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldEZpbGUgPSBwbHVnaW4uYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0Rmlyc3RMaW5rcGF0aERlc3QoZ2V0TGlua3BhdGgodGFyZ2V0TGluayksIGNvbnRleHQuc291cmNlUGF0aCk7XG4gICAgICAgICAgICAgICAgaWYgKHRhcmdldERpc3BsYXkgJiYgdGFyZ2V0RmlsZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGlsZCA9IG5ldyBNYXRoTGlua3NSZW5kZXJDaGlsZCh0YXJnZXRFbCwgcGx1Z2luLCBjb250ZXh0LnNvdXJjZVBhdGgsIHRhcmdldExpbmssIHRhcmdldERpc3BsYXkpO1xuICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmFkZENoaWxkKGNoaWxkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG4iLCAiZXhwb3J0IGZ1bmN0aW9uIGFyb3VuZChvYmosIGZhY3Rvcmllcykge1xuICAgIGNvbnN0IHJlbW92ZXJzID0gT2JqZWN0LmtleXMoZmFjdG9yaWVzKS5tYXAoa2V5ID0+IGFyb3VuZDEob2JqLCBrZXksIGZhY3Rvcmllc1trZXldKSk7XG4gICAgcmV0dXJuIHJlbW92ZXJzLmxlbmd0aCA9PT0gMSA/IHJlbW92ZXJzWzBdIDogZnVuY3Rpb24gKCkgeyByZW1vdmVycy5mb3JFYWNoKHIgPT4gcigpKTsgfTtcbn1cbmZ1bmN0aW9uIGFyb3VuZDEob2JqLCBtZXRob2QsIGNyZWF0ZVdyYXBwZXIpIHtcbiAgICBjb25zdCBvcmlnaW5hbCA9IG9ialttZXRob2RdLCBoYWRPd24gPSBvYmouaGFzT3duUHJvcGVydHkobWV0aG9kKTtcbiAgICBsZXQgY3VycmVudCA9IGNyZWF0ZVdyYXBwZXIob3JpZ2luYWwpO1xuICAgIC8vIExldCBvdXIgd3JhcHBlciBpbmhlcml0IHN0YXRpYyBwcm9wcyBmcm9tIHRoZSB3cmFwcGluZyBtZXRob2QsXG4gICAgLy8gYW5kIHRoZSB3cmFwcGluZyBtZXRob2QsIHByb3BzIGZyb20gdGhlIG9yaWdpbmFsIG1ldGhvZFxuICAgIGlmIChvcmlnaW5hbClcbiAgICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKGN1cnJlbnQsIG9yaWdpbmFsKTtcbiAgICBPYmplY3Quc2V0UHJvdG90eXBlT2Yod3JhcHBlciwgY3VycmVudCk7XG4gICAgb2JqW21ldGhvZF0gPSB3cmFwcGVyO1xuICAgIC8vIFJldHVybiBhIGNhbGxiYWNrIHRvIGFsbG93IHNhZmUgcmVtb3ZhbFxuICAgIHJldHVybiByZW1vdmU7XG4gICAgZnVuY3Rpb24gd3JhcHBlciguLi5hcmdzKSB7XG4gICAgICAgIC8vIElmIHdlIGhhdmUgYmVlbiBkZWFjdGl2YXRlZCBhbmQgYXJlIG5vIGxvbmdlciB3cmFwcGVkLCByZW1vdmUgb3Vyc2VsdmVzXG4gICAgICAgIGlmIChjdXJyZW50ID09PSBvcmlnaW5hbCAmJiBvYmpbbWV0aG9kXSA9PT0gd3JhcHBlcilcbiAgICAgICAgICAgIHJlbW92ZSgpO1xuICAgICAgICByZXR1cm4gY3VycmVudC5hcHBseSh0aGlzLCBhcmdzKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gcmVtb3ZlKCkge1xuICAgICAgICAvLyBJZiBubyBvdGhlciBwYXRjaGVzLCBqdXN0IGRvIGEgZGlyZWN0IHJlbW92YWxcbiAgICAgICAgaWYgKG9ialttZXRob2RdID09PSB3cmFwcGVyKSB7XG4gICAgICAgICAgICBpZiAoaGFkT3duKVxuICAgICAgICAgICAgICAgIG9ialttZXRob2RdID0gb3JpZ2luYWw7XG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgZGVsZXRlIG9ialttZXRob2RdO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjdXJyZW50ID09PSBvcmlnaW5hbClcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgLy8gRWxzZSBwYXNzIGZ1dHVyZSBjYWxscyB0aHJvdWdoLCBhbmQgcmVtb3ZlIHdyYXBwZXIgZnJvbSB0aGUgcHJvdG90eXBlIGNoYWluXG4gICAgICAgIGN1cnJlbnQgPSBvcmlnaW5hbDtcbiAgICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKHdyYXBwZXIsIG9yaWdpbmFsIHx8IEZ1bmN0aW9uKTtcbiAgICB9XG59XG5leHBvcnQgZnVuY3Rpb24gZGVkdXBlKGtleSwgb2xkRm4sIG5ld0ZuKSB7XG4gICAgY2hlY2tba2V5XSA9IGtleTtcbiAgICByZXR1cm4gY2hlY2s7XG4gICAgZnVuY3Rpb24gY2hlY2soLi4uYXJncykge1xuICAgICAgICByZXR1cm4gKG9sZEZuW2tleV0gPT09IGtleSA/IG9sZEZuIDogbmV3Rm4pLmFwcGx5KHRoaXMsIGFyZ3MpO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiBhZnRlcihwcm9taXNlLCBjYikge1xuICAgIHJldHVybiBwcm9taXNlLnRoZW4oY2IsIGNiKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBzZXJpYWxpemUoYXN5bmNGdW5jdGlvbikge1xuICAgIGxldCBsYXN0UnVuID0gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgZnVuY3Rpb24gd3JhcHBlciguLi5hcmdzKSB7XG4gICAgICAgIHJldHVybiBsYXN0UnVuID0gbmV3IFByb21pc2UoKHJlcywgcmVqKSA9PiB7XG4gICAgICAgICAgICBhZnRlcihsYXN0UnVuLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgYXN5bmNGdW5jdGlvbi5hcHBseSh0aGlzLCBhcmdzKS50aGVuKHJlcywgcmVqKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgd3JhcHBlci5hZnRlciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGxhc3RSdW4gPSBuZXcgUHJvbWlzZSgocmVzLCByZWopID0+IHsgYWZ0ZXIobGFzdFJ1biwgcmVzKTsgfSk7XG4gICAgfTtcbiAgICByZXR1cm4gd3JhcHBlcjtcbn1cbiIsICIvLyBodHRwczovL2dpdGh1Yi5jb20vemhhb3NoZW56aGFpL29ic2lkaWFuLW1hdGhsaW5rcy9pc3N1ZXMvNTVcbi8vIFBhdGNoIHRoZSBjb3JlIE91dGxpbmUgdmlldyB0byByZW5kZXIgTWF0aEpheCBpbiBpdFxuXG5pbXBvcnQgeyBhcm91bmQgfSBmcm9tICdtb25rZXktYXJvdW5kJztcbmltcG9ydCBNYXRoTGlua3MgZnJvbSAnLi9tYWluJztcbmltcG9ydCB7IHNldE1hdGhMaW5rIH0gZnJvbSAnLi9saW5rcy9oZWxwZXInO1xuXG5leHBvcnQgY29uc3QgcGF0Y2hPdXRsaW5lID0gKHBsdWdpbjogTWF0aExpbmtzKTogYm9vbGVhbiA9PiB7XG4gICAgY29uc3Qgb3V0bGluZVZpZXcgPSBwbHVnaW4uYXBwLndvcmtzcGFjZS5nZXRMZWF2ZXNPZlR5cGUoJ291dGxpbmUnKVswXT8udmlldztcbiAgICBpZiAoIW91dGxpbmVWaWV3KSByZXR1cm4gZmFsc2U7XG5cbiAgICBwbHVnaW4ucmVnaXN0ZXIoXG4gICAgICAgIGFyb3VuZChvdXRsaW5lVmlldy5jb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHtcbiAgICAgICAgICAgIGdldEl0ZW1Eb20ob2xkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhcmcpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmV0ID0gb2xkLmNhbGwodGhpcywgYXJnKTtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiBzZXRNYXRoTGluayhyZXQuaGVhZGluZy5oZWFkaW5nLCByZXQuaW5uZXJFbCksIDEwKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KVxuICAgIClcblxuICAgIHJldHVybiB0cnVlO1xufVxuIl0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBOzs7QUM2QkEsdUJBQTZFO0FBQzdFLG1CQUFzSjtBQUN0SixrQkFRTztBQUVQLHNCQUEyQjs7O0FDeEMzQix1QkFBMkU7OztBQ0QzRSxzQkFBZ0Y7QUFLekUsb0JBQW9CLFFBQW1CLE1BQThCO0FBQ3hFLFdBQVMsSUFBSSxHQUFHLElBQUksT0FBTyxTQUFTLGNBQWMsUUFBUSxLQUFLO0FBQzNELFFBQUksV0FBVyxPQUFPLElBQUksTUFBTSxzQkFBc0IsT0FB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
