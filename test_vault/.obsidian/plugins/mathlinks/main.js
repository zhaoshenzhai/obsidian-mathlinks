/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin:
https://github.com/zhaoshenzhai/obsidian-mathlinks
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getOwnPropSymbols = Object.getOwnPropertySymbols;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __propIsEnum = Object.prototype.propertyIsEnumerable;
var __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;
var __spreadValues = (a, b) => {
  for (var prop in b || (b = {}))
    if (__hasOwnProp.call(b, prop))
      __defNormalProp(a, prop, b[prop]);
  if (__getOwnPropSymbols)
    for (var prop of __getOwnPropSymbols(b)) {
      if (__propIsEnum.call(b, prop))
        __defNormalProp(a, prop, b[prop]);
    }
  return a;
};
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);
var __async = (__this, __arguments, generator) => {
  return new Promise((resolve, reject) => {
    var fulfilled = (value) => {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    };
    var rejected = (value) => {
      try {
        step(generator.throw(value));
      } catch (e) {
        reject(e);
      }
    };
    var step = (x) => x.done ? resolve(x.value) : Promise.resolve(x.value).then(fulfilled, rejected);
    step((generator = generator.apply(__this, __arguments)).next());
  });
};

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => MathLinks
});
module.exports = __toCommonJS(main_exports);
var import_obsidian9 = require("obsidian");
var import_state2 = require("@codemirror/state");

// src/links/preview.ts
var import_obsidian3 = require("obsidian");
var import_state = require("@codemirror/state");
var import_view = require("@codemirror/view");
var import_language = require("@codemirror/language");

// src/api/provider.ts
var import_obsidian = require("obsidian");
var Provider = class extends import_obsidian.Component {
  constructor(mathLinks) {
    super();
    this.mathLinks = mathLinks;
    this._enableInSourceMode = false;
  }
  get enableInSourceMode() {
    return this._enableInSourceMode;
  }
  set enableInSourceMode(enable) {
    this._enableInSourceMode = enable;
    this.mathLinks.update();
  }
  onunload() {
    const providers = this.mathLinks.providers;
    let index = providers.findIndex(({ provider }) => provider === this);
    providers.splice(index, 1);
    this.mathLinks.update();
  }
};
var NativeProvider = class extends Provider {
  get enableInSourceMode() {
    return this.mathLinks.settings.enableInSourceMode;
  }
  set enableInSourceMode(enable) {
    this.mathLinks.settings.enableInSourceMode = enable;
    this.mathLinks.update();
    this.mathLinks.saveSettings();
  }
  provide(parsedLinktext, targetFile, targetSubpathResult) {
    var _a;
    const { mathLinks } = this;
    const { app } = mathLinks;
    if (!targetFile)
      return null;
    let cache = app.metadataCache.getFileCache(targetFile);
    if (!cache)
      return null;
    let mathLink = null;
    if (targetSubpathResult) {
      mathLink = getMathLinkFromSubpath(parsedLinktext.path, targetSubpathResult, cache.frontmatter, mathLinks.settings.blockPrefix, mathLinks.settings.enableFileNameBlockLinks ? null : "");
    } else if (parsedLinktext.path) {
      mathLink = (_a = cache.frontmatter) == null ? void 0 : _a.mathLink;
      if (mathLink == "auto") {
        mathLink = getMathLinkFromTemplates(mathLinks, targetFile);
      }
    }
    return mathLink;
  }
};
var DeprecatedAPIProvider = class extends Provider {
  constructor(account) {
    super(account.plugin);
    this.account = account;
  }
  provide(parsedLinktext, targetFile, targetSubpathResult, sourceFile) {
    var _a;
    if (targetFile === null || sourceFile === null) {
      return null;
    }
    let mathLink = null;
    const metadata = this.account.metadataSet.get(targetFile);
    if (metadata) {
      if (targetSubpathResult) {
        mathLink = getMathLinkFromSubpath(parsedLinktext.path, targetSubpathResult, metadata, this.account.blockPrefix, this.account.prefixer(sourceFile, targetFile, targetSubpathResult));
      } else {
        mathLink = (_a = metadata["mathLink"]) != null ? _a : null;
      }
    }
    return mathLink;
  }
};

// src/links/helper.ts
var import_obsidian2 = require("obsidian");
function setMathLink(source, mathLinkEl) {
  mathLinkEl.replaceChildren();
  const mathPattern = /\$(.*?[^\s])\$/g;
  let textFrom = 0, textTo = 0;
  let result;
  while ((result = mathPattern.exec(source)) !== null) {
    const mathString = result[1];
    textTo = result.index;
    if (textTo > textFrom)
      mathLinkEl.createSpan().replaceWith(source.slice(textFrom, textTo));
    const mathEl = (0, import_obsidian2.renderMath)(mathString, false);
    mathLinkEl.createSpan({ cls: ["math", "math-inline", "is-loaded"] }).replaceWith(mathEl);
    (0, import_obsidian2.finishRenderMath)();
    textFrom = mathPattern.lastIndex;
  }
  if (textFrom < source.length)
    mathLinkEl.createSpan().replaceWith(source.slice(textFrom));
}
function getMathLink(plugin, targetLink, sourcePath, isSourceMode) {
  let { path, subpath } = (0, import_obsidian2.parseLinktext)(targetLink);
  let file = plugin.app.metadataCache.getFirstLinkpathDest(path, sourcePath);
  if (!file)
    return "";
  let cache = plugin.app.metadataCache.getFileCache(file);
  if (!cache)
    return "";
  let subpathResult = (0, import_obsidian2.resolveSubpath)(cache, subpath);
  const sourceFile = plugin.app.vault.getAbstractFileByPath(sourcePath);
  if (!(sourceFile instanceof import_obsidian2.TFile)) {
    return "";
  }
  return _getMathLink(plugin, path, subpath, file, subpathResult, sourceFile, isSourceMode);
}
function _getMathLink(plugin, path, subpath, targetFile, subpathResult, sourceFile, isSourceMode) {
  let mathLink = "";
  plugin.iterateProviders((provider) => {
    if (isSourceMode && !provider.enableInSourceMode)
      return;
    const provided = provider.provide({ path, subpath }, targetFile, subpathResult, sourceFile);
    if (provided) {
      if (provider instanceof NativeProvider && (subpathResult == null ? void 0 : subpathResult.type) == "heading") {
        if (mathLink && provided == (path ? path + " > " : "") + subpathResult.current.heading) {
          return;
        }
      }
      mathLink = provided;
    }
  });
  return mathLink;
}
function getMathLinkFromSubpath(linkpath, subpathResult, metadata, blockPrefix, prefix) {
  var _a, _b;
  let subMathLink = "";
  if (subpathResult.type == "heading") {
    subMathLink = subpathResult.current.heading;
  } else if (subpathResult.type == "block" && ((_a = metadata == null ? void 0 : metadata["mathLink-blocks"]) == null ? void 0 : _a[subpathResult.block.id])) {
    subMathLink = blockPrefix + metadata["mathLink-blocks"][subpathResult.block.id];
  }
  if (subMathLink) {
    if (prefix === null) {
      if (linkpath) {
        return ((_b = metadata == null ? void 0 : metadata["mathLink"]) != null ? _b : linkpath) + " > " + subMathLink;
      } else {
        return subMathLink;
      }
    } else {
      return prefix + subMathLink;
    }
  } else {
    return "";
  }
}
function getMathLinkFromTemplates(plugin, file) {
  let templates = plugin.settings.templates;
  let mathLink = file.name.replace(/\.md$/, "");
  for (let i = 0; i < templates.length; i++) {
    let replaced = new RegExp(templates[i].replaced);
    let replacement = templates[i].replacement;
    let flags = "";
    if (templates[i].globalMatch)
      flags += "g";
    if (!templates[i].sensitive)
      flags += "i";
    if (templates[i].word)
      replaced = RegExp(replaced.source.replace(/^/, "\\b").replace(/$/, "\\b"), flags);
    else
      replaced = RegExp(replaced.source, flags);
    mathLink = mathLink.replace(replaced, replacement);
  }
  return mathLink;
}

// src/links/supercharged.ts
function addSuperCharged(plugin, span, outLinkFile) {
  if (outLinkFile && plugin.app.plugins.enabledPlugins.has("supercharged-links-obsidian")) {
    let superCharged = getSuperCharged(plugin, outLinkFile);
    span.classList.add("data-link-icon");
    span.classList.add("data-link-icon-after");
    span.classList.add("data-link-text");
    span.setAttribute("data-link-path", outLinkFile.path);
    span.setAttribute("data-link-tags", superCharged[0]);
    for (let i = 0; i < superCharged[1].length; i++)
      span.setAttribute("data-link-" + superCharged[1][i][0], superCharged[1][i][1]);
  }
}
function getSuperCharged(plugin, file) {
  var _a, _b, _c;
  const data = (_a = plugin.app.plugins.plugins["supercharged-links-obsidian"]) == null ? void 0 : _a.settings;
  let tagArr = (_b = plugin.app.metadataCache.getFileCache(file)) == null ? void 0 : _b.tags;
  let tags = "";
  if (tagArr) {
    for (let i = 0; i < tagArr.length; i++)
      tags += tagArr[i].tag.replace(/#/, "") + " ";
    tags = tags.trimEnd();
  }
  let attributes = [];
  let frontmatter = (_c = plugin.app.metadataCache.getFileCache(file)) == null ? void 0 : _c.frontmatter;
  if (data) {
    for (let attr in frontmatter) {
      if (attr != "mathLink" && attr != "position") {
        let selectors = data.selectors;
        for (let i = 0; i < selectors.length; i++) {
          if (selectors[i].name == attr && selectors[i].value == frontmatter[attr]) {
            attributes.push([attr, frontmatter[attr]]);
          } else if (selectors[i].type == "tag" && selectors[i].value == frontmatter[attr] && data.targetTags) {
            attributes.push([attr, frontmatter[attr]]);
          }
        }
      }
    }
  }
  return [tags, attributes];
}

// src/links/preview.ts
function selectionAndRangeOverlap(selection, rangeFrom, rangeTo) {
  for (const range of selection.ranges) {
    if (range.from <= rangeTo && range.to >= rangeFrom) {
      return true;
    }
  }
  return false;
}
function hasEffect(tr, effectType) {
  return tr.effects.some((effect) => effect.is(effectType));
}
var MathLinkInfo = class extends import_state.RangeValue {
  constructor(linkText, mathLink) {
    super();
    this.linkText = linkText;
    this.mathLink = mathLink;
  }
  eq(other) {
    return this.linkText == other.linkText && this.mathLink == other.mathLink;
  }
};
var createEditorExtensions = (plugin) => {
  const buildField = (state) => {
    let builder = new import_state.RangeSetBuilder();
    const isSourceMode = !state.field(import_obsidian3.editorLivePreviewField);
    const file = state.field(import_obsidian3.editorInfoField).file;
    let start = -1, end = -1, outLinkText = "", outLinkMathLink = "";
    (0, import_language.syntaxTree)(state).iterate({
      enter(node) {
        let name = node.type.name;
        if (name.contains("formatting-link_formatting-link-start")) {
          if (isSourceMode) {
            if (state.sliceDoc(node.from, node.to) == "[[" && node.node.nextSibling) {
              start = node.node.nextSibling.from;
            } else {
              return;
            }
          } else {
            start = node.from;
          }
        } else if (name.contains("formatting_formatting-link_link")) {
          if (start == -1) {
            start = node.from;
          }
        } else if (name.contains("has-alias")) {
          outLinkText += state.doc.sliceString(node.from, node.to);
          if (file && outLinkMathLink == outLinkText.replace(/\.md/, "")) {
            outLinkMathLink = getMathLink(plugin, outLinkText, file.path, isSourceMode);
          }
        } else if (/string_url$/.test(name) && !name.contains("format")) {
          outLinkText += decodeURI(state.doc.sliceString(node.from, node.to));
          if (file && outLinkMathLink == outLinkText.replace(/\.md/, "")) {
            outLinkMathLink = getMathLink(plugin, outLinkText, file.path, isSourceMode);
          }
        } else if (file && name.contains("hmd-internal-link") && !name.contains("alias")) {
          outLinkText += state.doc.sliceString(node.from, node.to);
          outLinkMathLink = getMathLink(plugin, outLinkText, file.path, isSourceMode);
        } else if (name.contains("formatting-link-end") || name.contains("formatting-link-string")) {
          if (!name.contains("end") && end == -1) {
            end = -2;
          } else {
            if (isSourceMode) {
              if (node.node.prevSibling && state.sliceDoc(node.from, node.to) == "]]") {
                end = node.node.prevSibling.to;
              } else {
                return;
              }
            } else {
              end = node.to;
            }
            if (outLinkText && outLinkMathLink) {
              builder.add(start, end, new MathLinkInfo(outLinkText, outLinkMathLink.replace(/\\\$/, "$")));
            }
            start = -1;
            end = -1;
            outLinkText = "";
            outLinkMathLink = "";
          }
        } else if (!name.contains("pipe") && (name.contains("hmd-internal-link") && name.contains("alias") || name.contains("hmd-escape") && name.contains("link") || /^link/.test(name))) {
          outLinkMathLink += state.doc.sliceString(node.from, node.to);
          if (file && outLinkMathLink == outLinkText.replace(/\.md/, "")) {
            outLinkMathLink = getMathLink(plugin, outLinkText, file.path, isSourceMode);
          }
        }
      }
    });
    return builder.finish();
  };
  const mathLinkInfoField = import_state.StateField.define({
    create: buildField,
    update(oldFields, tr) {
      return tr.docChanged || hasEffect(tr, plugin.forceUpdateEffect) ? buildField(tr.state) : oldFields;
    }
  });
  class MathWidget extends import_view.WidgetType {
    constructor(outLinkText, outLinkMathLink, isSourceMode, sourcePath) {
      super();
      this.outLinkText = outLinkText;
      this.outLinkMathLink = outLinkMathLink;
      this.isSourceMode = isSourceMode;
      this.sourcePath = sourcePath;
    }
    eq(other) {
      return this.outLinkText == other.outLinkText && this.outLinkMathLink == other.outLinkMathLink && this.isSourceMode == other.isSourceMode && this.sourcePath == other.sourcePath;
    }
    toDOM() {
      let mathLink = createSpan();
      setMathLink(this.outLinkMathLink, mathLink);
      if (!this.isSourceMode)
        mathLink.addClass("cm-underline");
      mathLink.setAttribute("draggable", "true");
      const linkpath = (0, import_obsidian3.getLinkpath)(this.outLinkText);
      const targetFile = plugin.app.metadataCache.getFirstLinkpathDest(linkpath, this.sourcePath);
      if (targetFile)
        addSuperCharged(plugin, mathLink, targetFile);
      let mathLinkWrapper = createSpan();
      mathLinkWrapper.addClass("cm-hmd-internal-link");
      mathLinkWrapper.appendChild(mathLink);
      mathLinkWrapper.onclick = (evt) => {
        evt.preventDefault();
        if (targetFile) {
          plugin.app.workspace.openLinkText(this.outLinkText, this.sourcePath, import_obsidian3.Keymap.isModEvent(evt));
        } else {
          self.open(this.outLinkText, "_blank", "noreferrer");
        }
      };
      mathLinkWrapper.onmousedown = (evt) => {
        if (evt.button == 1) {
          evt.preventDefault();
        }
      };
      mathLinkWrapper.onauxclick = (evt) => {
        if (evt.button == 1) {
          if (targetFile) {
            plugin.app.workspace.openLinkText(this.outLinkText, this.sourcePath, true);
          } else {
            self.open(this.outLinkText, "_blank", "noreferrer");
          }
        }
      };
      return mathLinkWrapper;
    }
  }
  const mathLinksViewPlugin = import_view.ViewPlugin.fromClass(class {
    constructor(view) {
      this.decorations = this.buildDecorations(view);
    }
    buildDecorations(view) {
      var _a, _b;
      if (!view.state.field(import_obsidian3.editorLivePreviewField) && !plugin.enableInSourceMode()) {
        return import_view.Decoration.none;
      }
      const sourcePath = (_b = (_a = view.state.field(import_obsidian3.editorInfoField).file) == null ? void 0 : _a.path) != null ? _b : "";
      const isSourceMode = !view.state.field(import_obsidian3.editorLivePreviewField);
      const info = view.state.field(mathLinkInfoField);
      const builder = new import_state.RangeSetBuilder();
      const selection = view.state.selection;
      for (const { from, to } of view.visibleRanges) {
        info.between(from, to, (start, end, { linkText, mathLink }) => {
          if (!selectionAndRangeOverlap(selection, start, end)) {
            builder.add(start, end, import_view.Decoration.widget({
              widget: new MathWidget(linkText, mathLink, isSourceMode, sourcePath)
            }));
          }
        });
      }
      return builder.finish();
    }
    update(update) {
      if (!update.state.field(import_obsidian3.editorLivePreviewField) && !plugin.enableInSourceMode()) {
        this.decorations = import_view.Decoration.none;
      }
      if (update.transactions.some((tr) => hasEffect(tr, plugin.forceUpdateEffect))) {
        this.decorations = this.buildDecorations(update.view);
      } else if (update.docChanged) {
        this.decorations = this.decorations.map(update.changes);
        this.updateDecorations(update.view);
      } else if (update.selectionSet) {
        this.updateDecorations(update.view);
      } else if (update.viewportChanged) {
        this.decorations = this.buildDecorations(update.view);
      }
    }
    updateDecorations(view) {
      var _a;
      const file = view.state.field(import_obsidian3.editorInfoField).file;
      const sourcePath = (_a = file == null ? void 0 : file.path) != null ? _a : "";
      const isSourceMode = !view.state.field(import_obsidian3.editorLivePreviewField);
      const info = view.state.field(mathLinkInfoField);
      const selection = view.state.selection;
      for (const { from, to } of view.visibleRanges) {
        info.between(from, to, (start, end, value) => {
          const overlap = selectionAndRangeOverlap(selection, start, end);
          if (overlap) {
            this.removeDeco(start, end);
            return;
          } else {
            this.addDeco(start, end, value, isSourceMode, sourcePath);
          }
        });
      }
    }
    removeDeco(start, end) {
      this.decorations.between(start, end, (from, to) => {
        this.decorations = this.decorations.update({
          filterFrom: from,
          filterTo: to,
          filter: () => false
        });
      });
    }
    addDeco(start, end, value, isSourceMode, sourcePath) {
      let exists = false;
      this.decorations.between(start, end, () => {
        exists = true;
      });
      if (!exists) {
        this.decorations = this.decorations.update({
          add: [
            {
              from: start,
              to: end,
              value: import_view.Decoration.widget({
                widget: new MathWidget(value.linkText, value.mathLink, isSourceMode, sourcePath)
              })
            }
          ]
        });
      }
    }
  }, {
    decorations: (instance) => instance.decorations
  });
  return [mathLinkInfoField, mathLinksViewPlugin];
};

// src/settings/settings.ts
var DEFAULT_SETTINGS = {
  templates: [],
  excludedPaths: [],
  blockPrefix: "^",
  enableFileNameBlockLinks: true,
  enableInSourceMode: false,
  renderOutline: true
};

// src/settings/tab.ts
var import_obsidian6 = require("obsidian");

// src/settings/modals.ts
var import_obsidian5 = require("obsidian");

// src/utils.ts
var import_obsidian4 = require("obsidian");
function isExcluded(plugin, file) {
  for (let i = 0; i < plugin.settings.excludedPaths.length; i++) {
    let excluded = plugin.app.vault.getAbstractFileByPath(plugin.settings.excludedPaths[i]);
    if (excluded && isEqualToOrChildOf(file, excluded))
      return false;
  }
  return true;
}
function translateLink(targetLink) {
  var _a;
  function translateLinkImpl(targetLink2, pattern) {
    let result = pattern.exec(targetLink2);
    if (result)
      return (result[1] ? `${result[1]} > ` : "") + `${result[2]}`;
  }
  let headingPattern = /(^.*)#([^\^].*)/;
  let blockPattern = /(^.*)#(\^[a-zA-Z0-9\-]+)/;
  let translatedAsHeading = translateLinkImpl(targetLink, headingPattern);
  let translatedAsBlock = translateLinkImpl(targetLink, blockPattern);
  return (_a = translatedAsHeading != null ? translatedAsHeading : translatedAsBlock) != null ? _a : "";
}
function isEqualToOrChildOf(file1, file2) {
  if (file1 == file2)
    return true;
  if (file2 instanceof import_obsidian4.TFolder && file2.isRoot())
    return true;
  let ancestor = file1.parent;
  while (true) {
    if (ancestor == file2)
      return true;
    if (ancestor) {
      if (ancestor.isRoot())
        return false;
      ancestor = ancestor.parent;
    }
  }
}

// src/settings/modals.ts
var TemplatesModal = class extends import_obsidian5.Modal {
  constructor(app, plugin) {
    super(app);
    this.plugin = plugin;
  }
  onOpen() {
    this.display();
  }
  display() {
    return __async(this, null, function* () {
      const { contentEl } = this;
      contentEl.empty();
      contentEl.createEl("h4", { text: "Add/Edit Templates" });
      new import_obsidian5.Setting(contentEl).setName(createFragment((e) => {
        e.createSpan({ text: "The templates in the list below are sorted by precedence, with the top being replaced first. Note that " });
        e.createEl("code", { text: "a" });
        e.createSpan({ text: " > " });
        e.createEl("code", { text: "b" });
        e.createSpan({ text: " followed by " });
        e.createEl("code", { text: "b" });
        e.createSpan({ text: " > " });
        e.createEl("code", { text: "c" });
        e.createSpan({ text: " together is equivalent to " });
        e.createEl("code", { text: "a" });
        e.createSpan({ text: " > " });
        e.createEl("code", { text: "c" });
        e.createSpan({ text: ", but not the other way around." });
      })).addButton((btn) => {
        btn.setTooltip("Add").setIcon("plus").onClick((event) => {
          let newTemplate = { replaced: "", replacement: "", globalMatch: true, sensitive: true, word: true };
          new TemplateSettingsModal(this.app, this.plugin, this, newTemplate, true).open();
        });
      });
      if (this.plugin.settings.templates.length) {
        let list = contentEl.createEl("ul");
        for (let i = 0; i < this.plugin.settings.templates.length; i++) {
          let template = this.plugin.settings.templates[i];
          let item = list.createEl("li").createDiv();
          new import_obsidian5.Setting(item).setName(createFragment((e) => {
            e.createEl("code", { text: template.replaced });
            e.createSpan({ text: " > " });
            e.createEl("code", { text: template.replacement });
          })).addExtraButton((button) => {
            return button.setTooltip("Move up").setIcon("up-arrow-with-tail").onClick(() => __async(this, null, function* () {
              if (i != 0) {
                let down = __spreadValues({}, template);
                let up = this.plugin.settings.templates[i - 1];
                this.plugin.settings.templates[i] = up;
                this.plugin.settings.templates[i - 1] = down;
                yield this.plugin.saveSettings().then(() => {
                  this.display();
                });
              }
            }));
          }).addExtraButton((button) => {
            return button.setTooltip("Move down").setIcon("down-arrow-with-tail").onClick(() => __async(this, null, function* () {
              if (i != this.plugin.settings.templates.length - 1) {
                let up = __spreadValues({}, template);
                let down = this.plugin.settings.templates[i + 1];
                this.plugin.settings.templates[i] = down;
                this.plugin.settings.templates[i + 1] = up;
                yield this.plugin.saveSettings().then(() => {
                  this.display();
                });
              }
            }));
          }).addExtraButton((button) => {
            return button.setTooltip("Edit").setIcon("edit").onClick(() => __async(this, null, function* () {
              let modal = new TemplateSettingsModal(this.app, this.plugin, this, template, false);
              modal.open();
              modal.onClose = () => __async(this, null, function* () {
                yield this.plugin.saveSettings().then(() => {
                  this.display();
                });
              });
            }));
          }).addExtraButton((button) => {
            return button.setTooltip("Remove").setIcon("x").onClick(() => __async(this, null, function* () {
              this.plugin.settings.templates.remove(template);
              yield this.plugin.saveSettings().then(() => {
                this.display();
              });
            }));
          });
        }
      }
    });
  }
};
var TemplateSettingsModal = class extends import_obsidian5.Modal {
  constructor(app, plugin, modal, template, create) {
    super(app);
    this.plugin = plugin;
    this.modal = modal;
    this.template = template;
    this.create = create;
  }
  onOpen() {
    this.display();
  }
  display() {
    return __async(this, null, function* () {
      const { contentEl } = this;
      contentEl.empty();
      let replacedText;
      new import_obsidian5.Setting(contentEl).setName("Match for...").setDesc("String to be matched and replaced. Do not include regex.").addText((text) => {
        replacedText = text;
        replacedText.setValue(this.template.replaced).onChange((current) => {
          this.template.replaced = current;
        });
      });
      let replacementText;
      new import_obsidian5.Setting(contentEl).setName("Replace with...").setDesc("String to replace matches. Do not escape backslashes.").addText((text) => {
        replacementText = text;
        replacementText.setValue(this.template.replacement).onChange((current) => {
          this.template.replacement = current;
        });
      });
      new import_obsidian5.Setting(contentEl).setName("Global match").setDesc("Match all instances (instead of just the first).").addToggle((toggle) => {
        toggle.setValue(this.template.globalMatch).onChange((current) => this.template.globalMatch = current);
      });
      new import_obsidian5.Setting(contentEl).setName("Case sensitive").setDesc("Matches will be case sensitive.").addToggle((toggle) => {
        toggle.setValue(this.template.sensitive).onChange((current) => this.template.sensitive = current);
      });
      new import_obsidian5.Setting(contentEl).setName("Match whole words").setDesc("Only match whole words.").addToggle((toggle) => {
        toggle.setValue(this.template.word).onChange((current) => this.template.word = current);
      });
      new import_obsidian5.Setting(contentEl).addButton((b) => {
        b.setTooltip(this.create ? "Add" : "Save").setIcon("checkmark").onClick(() => __async(this, null, function* () {
          if (this.template.replaced == "") {
            new import_obsidian5.Notice("MathLinks: Please enter a non-empty string to be replaced");
          } else {
            if (this.create)
              this.plugin.settings.templates.push(this.template);
            yield this.plugin.saveSettings().then(() => {
              this.close();
              this.modal.display();
            });
          }
        }));
      }).addExtraButton((b) => {
        b.setTooltip("Cancel").setIcon("cross").onClick(() => __async(this, null, function* () {
          this.close();
        }));
      });
    });
  }
};
var ExcludeModal = class extends import_obsidian5.Modal {
  constructor(app, plugin) {
    super(app);
    this.plugin = plugin;
  }
  onOpen() {
    this.display();
  }
  display() {
    return __async(this, null, function* () {
      const { contentEl } = this;
      contentEl.empty();
      contentEl.createEl("h4", { text: "Excluded files" });
      new import_obsidian5.Setting(contentEl).setName("The files/folders in this list will be ignored by MathLinks.").addButton((btn) => {
        btn.setTooltip("Add").setIcon("plus").onClick((event) => {
          new FileExcludeSuggestModal(this.app, this.plugin, this).open();
        });
      });
      if (this.plugin.settings.excludedPaths.length) {
        let list = contentEl.createEl("ul");
        for (let path of this.plugin.settings.excludedPaths) {
          let item = list.createEl("li").createDiv();
          new import_obsidian5.Setting(item).setName(path).addExtraButton((button) => {
            return button.setTooltip("Remove").setIcon("x").onClick(() => __async(this, null, function* () {
              this.plugin.settings.excludedPaths.remove(path);
              yield this.plugin.saveSettings().then(() => {
                this.display();
              });
            }));
          });
        }
      }
    });
  }
};
var FileSuggestModal = class extends import_obsidian5.FuzzySuggestModal {
  constructor(app, plugin) {
    super(app);
    this.plugin = plugin;
  }
  getItems() {
    return this.app.vault.getAllLoadedFiles().filter(this.filterCallback.bind(this));
  }
  getItemText(file) {
    return file.path;
  }
  filterCallback(abstractFile) {
    if (abstractFile instanceof import_obsidian5.TFile && abstractFile.extension != "md")
      return false;
    if (abstractFile instanceof import_obsidian5.TFolder && abstractFile.isRoot())
      return false;
    for (const path of this.plugin.settings.excludedPaths) {
      const file = this.app.vault.getAbstractFileByPath(path);
      if (file && isEqualToOrChildOf(abstractFile, file)) {
        return false;
      }
    }
    return true;
  }
};
var FileExcludeSuggestModal = class extends FileSuggestModal {
  constructor(app, plugin, modal) {
    super(app, plugin);
    this.modal = modal;
  }
  onChooseItem(file, evt) {
    return __async(this, null, function* () {
      this.plugin.settings.excludedPaths.push(file.path);
      yield this.plugin.saveSettings().then(() => {
        this.modal.display();
      });
    });
  }
};

// src/settings/tab.ts
var MathLinksSettingTab = class extends import_obsidian6.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    return __async(this, null, function* () {
      const { containerEl } = this;
      containerEl.empty();
      containerEl.createEl("h2", { text: "MathLinks Settings" });
      new import_obsidian6.Setting(containerEl).setName("Templates").setDesc(createFragment((e) => {
        e.createSpan({ text: "Generate mathLinks with a template. Use " });
        e.createEl("code", { text: "mathLink: auto" });
        e.createSpan({ text: " to use templates in a file." });
      })).addButton((button) => {
        return button.setButtonText("Manage").onClick(() => __async(this, null, function* () {
          let modal = new TemplatesModal(this.app, this.plugin);
          modal.open();
          modal.onClose = () => __async(this, null, function* () {
            yield this.plugin.saveSettings().then(() => {
              this.display();
            });
          });
        }));
      });
      new import_obsidian6.Setting(containerEl).setName("Excluded files").setDesc("Manage files/paths that MathLinks will ignore.").addButton((button) => {
        return button.setButtonText("Manage").onClick(() => __async(this, null, function* () {
          let modal = new ExcludeModal(this.app, this.plugin);
          modal.open();
          modal.onClose = () => __async(this, null, function* () {
            yield this.plugin.saveSettings().then(() => {
              this.display();
            });
          });
        }));
      });
      let prefix;
      new import_obsidian6.Setting(containerEl).setName("Edit prefix for block links").setDesc(createFragment((e) => {
        e.createSpan({ text: "Links like " });
        e.createEl("code", { text: "note#^block-id" });
        e.createSpan({ text: " will be rendered as" });
        if (this.plugin.settings.enableFileNameBlockLinks) {
          e.createEl("code", { text: "note > " + this.plugin.settings.blockPrefix + "block-id" });
        } else {
          e.createEl("code", { text: this.plugin.settings.blockPrefix + "block-id" });
        }
        e.createSpan({ text: "." });
      })).addText((text) => {
        prefix = text;
        prefix.setValue(this.plugin.settings.blockPrefix).onChange((current) => __async(this, null, function* () {
          this.plugin.settings.blockPrefix = current;
          yield this.plugin.saveSettings();
        }));
        prefix.setPlaceholder("No prefix (default: ^)");
      }).addToggle((toggle) => {
        toggle.setValue(this.plugin.settings.enableFileNameBlockLinks).onChange((value) => __async(this, null, function* () {
          this.plugin.settings.enableFileNameBlockLinks = value;
          yield this.plugin.saveSettings().then(() => {
            this.display();
          });
        }));
        toggle.setTooltip("Disable to ignore note name.");
      });
      new import_obsidian6.Setting(containerEl).setName("Enable in Source mode").setDesc("Currently, only wikilinks are supported in Source mode.").addToggle((toggle) => {
        toggle.setValue(this.plugin.nativeProvider.enableInSourceMode).onChange((value) => {
          this.plugin.nativeProvider.enableInSourceMode = value;
        });
      });
      new import_obsidian6.Setting(containerEl).setName("Render MathJax in Outline").setDesc("Render headings with MathJax in the core Outline view. You need to reload the app for this option to take effect.").addToggle((toggle) => {
        toggle.setValue(this.plugin.settings.renderOutline).onChange((value) => __async(this, null, function* () {
          this.plugin.settings.renderOutline = value;
          yield this.plugin.saveSettings();
        }));
      });
    });
  }
};

// src/api/deprecated.ts
var MathLinksAPIAccount = class {
  constructor(plugin, manifest, blockPrefix, prefixer) {
    this.plugin = plugin;
    this.manifest = manifest;
    this.blockPrefix = blockPrefix;
    this.prefixer = prefixer;
    this.metadataSet = /* @__PURE__ */ new Map();
  }
  get(file, blockID) {
    let metadata = this.metadataSet.get(file);
    if (metadata) {
      if (blockID === void 0) {
        return metadata["mathLink"];
      }
      let blocks = metadata["mathLink-blocks"];
      if (blocks) {
        return blocks[blockID];
      }
    }
  }
  update(file, newMetadata) {
    if (file.extension == "md") {
      this.metadataSet.set(file, Object.assign({}, this.metadataSet.get(file), newMetadata));
      this.plugin.update(file);
    } else {
      throw Error(`MathLinks API: ${this.manifest.name} passed a non-markdown file ${file.path} to update().`);
    }
  }
  delete(file, which) {
    let metadata = this.metadataSet.get(file);
    if (metadata) {
      if (which === void 0) {
        this.metadataSet.delete(file);
      } else if (which == "mathLink" || which == "mathLink-blocks") {
        if (metadata[which] !== void 0) {
          delete metadata[which];
        } else {
          throw Error(`MathLinks API: ${this.manifest.name} attempted to delete ${which} of ${file.path}, but it does not exist.`);
        }
      } else {
        let blocks = metadata["mathLink-blocks"];
        if (blocks && blocks[which] !== void 0) {
          delete blocks[which];
        } else {
          throw Error(`MathLinks API: ${this.manifest.name} attempted to delete mathLink-blocks for ${file.path}#^${which}", but it does not exist`);
        }
      }
    } else {
      throw Error(`MathLinks API: ${this.manifest.name} attempted to delete the MathLinks metadata of ${file.path}, but it does not exist.`);
    }
    this.plugin.update(file);
  }
};

// src/links/reading.ts
var import_obsidian7 = require("obsidian");
var MathLinksRenderChild = class extends import_obsidian7.MarkdownRenderChild {
  constructor(containerEl, plugin, sourcePath, targetLink, displayText) {
    var _a;
    super(containerEl);
    this.plugin = plugin;
    this.sourcePath = sourcePath;
    this.targetLink = targetLink;
    this.displayText = displayText;
    this.targetFile = this.plugin.app.metadataCache.getFirstLinkpathDest((0, import_obsidian7.getLinkpath)(this.targetLink), this.sourcePath);
    this.mathLinkEl = this.containerEl.cloneNode(true);
    this.mathLinkEl.textContent = "";
    (_a = this.containerEl.parentNode) == null ? void 0 : _a.insertBefore(this.mathLinkEl, this.containerEl.nextSibling);
    this.mathLinkEl.classList.add("mathLink-internal-link");
    this.containerEl.classList.add("original-internal-link");
    this.containerEl.classList.remove("internal-link");
    this.containerEl.style.display = "none";
    this.getMathLink = this.setMathLinkGetter();
  }
  onload() {
    this.update();
    this.registerEvent(this.plugin.app.metadataCache.on("mathlinks:update", (changedFile) => {
      if (!this.targetFile || this.targetFile == changedFile) {
        this.update();
      }
    }));
    this.registerEvent(this.plugin.app.metadataCache.on("mathlinks:update-all", () => {
      this.update();
    }));
  }
  setMathLinkGetter() {
    var _a, _b;
    let getter = () => "";
    if (this.displayText != this.targetLink && this.displayText != translateLink(this.targetLink)) {
      getter = () => this.displayText;
    } else {
      if (this.displayText == ((_a = this.targetFile) == null ? void 0 : _a.name) || this.displayText == ((_b = this.targetFile) == null ? void 0 : _b.basename) || this.displayText == translateLink(this.targetLink)) {
        getter = () => getMathLink(this.plugin, this.targetLink, this.sourcePath);
      }
    }
    return getter;
  }
  update() {
    const mathLink = this.getMathLink();
    if (mathLink) {
      setMathLink(mathLink, this.mathLinkEl);
    } else {
      setMathLink(this.displayText, this.mathLinkEl);
    }
  }
};
function generateMathLinks(plugin, element, context) {
  var _a, _b;
  for (let targetEl of element.querySelectorAll(".internal-link")) {
    if (targetEl.classList.contains("mathLink-internal-link")) {
      targetEl.remove();
      let queryResult = element.querySelector(".original-internal-link");
      if (queryResult) {
        targetEl = queryResult;
        targetEl.classList.remove("original-internal-link");
        targetEl.style.display = "";
      }
    }
    const targetDisplay = (_a = targetEl.textContent) == null ? void 0 : _a.trim().replace(/\.md/, "");
    if (targetDisplay != "" && !/math-inline is-loaded/.test(targetEl.innerHTML)) {
      const targetLink = (_b = targetEl.getAttribute("data-href")) == null ? void 0 : _b.replace(/\.md/, "");
      if (targetLink) {
        const targetFile = plugin.app.metadataCache.getFirstLinkpathDest((0, import_obsidian7.getLinkpath)(targetLink), context.sourcePath);
        if (targetDisplay && targetFile) {
          const child = new MathLinksRenderChild(targetEl, plugin, context.sourcePath, targetLink, targetDisplay);
          context.addChild(child);
        }
      }
    }
  }
}

// src/patchers.ts
var import_obsidian8 = require("obsidian");

// node_modules/monkey-around/mjs/index.js
function around(obj, factories) {
  const removers = Object.keys(factories).map((key) => around1(obj, key, factories[key]));
  return removers.length === 1 ? removers[0] : function() {
    removers.forEach((r) => r());
  };
}
function around1(obj, method, createWrapper) {
  const original = obj[method], hadOwn = obj.hasOwnProperty(method);
  let current = createWrapper(original);
  if (original)
    Object.setPrototypeOf(current, original);
  Object.setPrototypeOf(wrapper, current);
  obj[method] = wrapper;
  return remove;
  function wrapper(...args) {
    if (current === original && obj[method] === wrapper)
      remove();
    return current.apply(this, args);
  }
  function remove() {
    if (obj[method] === wrapper) {
      if (hadOwn)
        obj[method] = original;
      else
        delete obj[method];
    }
    if (current === original)
      return;
    current = original;
    Object.setPrototypeOf(wrapper, original || Function);
  }
}

// src/patchers.ts
var patchOutline = (plugin) => {
  var _a;
  const outlineView = (_a = plugin.app.workspace.getLeavesOfType("outline")[0]) == null ? void 0 : _a.view;
  if (!outlineView)
    return false;
  plugin.register(around(outlineView.constructor.prototype, {
    getItemDom(old) {
      return function(arg) {
        const ret = old.call(this, arg);
        setTimeout(() => setMathLink(ret.heading.heading, ret.innerEl));
        return ret;
      };
    }
  }));
  return true;
};
var patchLinkAutocompletion = (plugin) => {
  const suggest = plugin.app.workspace.editorSuggest.suggests[0];
  if (!suggest)
    return false;
  plugin.register(around(suggest.constructor.prototype, {
    renderSuggestion(old) {
      return function(value, el) {
        var _a, _b, _c;
        const sourceFile = (_b = (_a = this.context) == null ? void 0 : _a.file) != null ? _b : null;
        let subpathResult = null;
        if (value.type === "heading" || value.type === "block") {
          const cache = plugin.app.metadataCache.getFileCache(value.file);
          if (cache) {
            subpathResult = (0, import_obsidian8.resolveSubpath)(cache, value.subpath);
          }
        }
        const mathLink = _getMathLink(plugin, value.path, (_c = value.subpath) != null ? _c : "", value.file, subpathResult, sourceFile);
        old.call(this, value, el);
        if (mathLink) {
          const titleEl = el.querySelector(".suggestion-title");
          if (titleEl)
            setMathLink(mathLink, titleEl);
        }
      };
    }
  }));
  return true;
};

// src/main.ts
var MathLinks = class extends import_obsidian9.Plugin {
  constructor() {
    super(...arguments);
    this.providers = [];
    this.forceUpdateEffect = import_state2.StateEffect.define();
  }
  onload() {
    return __async(this, null, function* () {
      yield this.loadSettings();
      yield (0, import_obsidian9.loadMathJax)();
      this.nativeProvider = new NativeProvider(this);
      this.addChild(this.nativeProvider);
      this.registerProvider(this.nativeProvider, Infinity);
      this.registerMarkdownPostProcessor((element, context) => {
        let file = this.app.vault.getAbstractFileByPath(context.sourcePath);
        if (file && isExcluded(this, file)) {
          generateMathLinks(this, element, context);
        }
      });
      this.registerEditorExtension(createEditorExtensions(this));
      this.registerEvent(this.app.metadataCache.on("changed", (file) => this.update(file)));
      this.registerEvent(this.app.workspace.on("layout-change", () => this.update()));
      this.apiAccounts = [];
      this.app.workspace.onLayoutReady(() => {
        if (this.settings.renderOutline && this.app.internalPlugins.plugins.outline.enabled) {
          this.patch(patchOutline);
        }
        this.patch(patchLinkAutocompletion);
      });
    });
  }
  patch(patcher) {
    const success = patcher(this);
    if (!success) {
      const eventRef = this.app.workspace.on("layout-change", () => {
        const success2 = patcher(this);
        if (success2)
          this.app.workspace.offref(eventRef);
      });
      this.registerEvent(eventRef);
    }
  }
  getAPIAccount(userPlugin) {
    let account = this.apiAccounts.find((account2) => account2.manifest.id == userPlugin.manifest.id);
    if (account)
      return account;
    account = new MathLinksAPIAccount(this, userPlugin.manifest, DEFAULT_SETTINGS.blockPrefix, () => null);
    this.apiAccounts.push(account);
    const provider = new DeprecatedAPIProvider(account);
    userPlugin.addChild(provider);
    this.registerProvider(provider);
    return account;
  }
  loadSettings() {
    return __async(this, null, function* () {
      this.settings = Object.assign({}, DEFAULT_SETTINGS, yield this.loadData());
      this.addSettingTab(new MathLinksSettingTab(this.app, this));
    });
  }
  saveSettings() {
    return __async(this, null, function* () {
      yield this.saveData(this.settings);
    });
  }
  registerProvider(provider, sortOrder) {
    var _a;
    (_a = this.providers.find((another) => another.provider === provider)) != null ? _a : this.providers.push({ provider, sortOrder: sortOrder != null ? sortOrder : 0 });
  }
  iterateProviders(callback) {
    this.providers.sort((p1, p2) => p1.sortOrder - p2.sortOrder).forEach(({ provider }) => callback(provider));
  }
  enableInSourceMode() {
    return this.providers.some(({ provider }) => provider.enableInSourceMode);
  }
  update(file) {
    if (file) {
      this._update("mathlinks:update", file);
    } else {
      this._update("mathlinks:update-all");
    }
  }
  _update(...args) {
    const [eventName, file] = args;
    this.app.metadataCache.trigger(eventName, file);
    this.app.workspace.iterateAllLeaves((leaf) => {
      if (leaf.view instanceof import_obsidian9.MarkdownView && leaf.view.getMode() === "source") {
        const editorView = leaf.view.editor.cm;
        if (!editorView)
          return;
        let shouldDispatch = !file;
        if (file && leaf.view.file) {
          shouldDispatch = file.path in this.app.metadataCache.resolvedLinks[leaf.view.file.path];
        }
        if (shouldDispatch) {
          editorView.dispatch({ effects: this.forceUpdateEffect.of(null) });
        }
      }
    });
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL21haW4udHMiLCAic3JjL2xpbmtzL3ByZXZpZXcudHMiLCAic3JjL2FwaS9wcm92aWRlci50cyIsICJzcmMvbGlua3MvaGVscGVyLnRzIiwgInNyYy9saW5rcy9zdXBlcmNoYXJnZWQudHMiLCAic3JjL3NldHRpbmdzL3NldHRpbmdzLnRzIiwgInNyYy9zZXR0aW5ncy90YWIudHMiLCAic3JjL3NldHRpbmdzL21vZGFscy50cyIsICJzcmMvdXRpbHMudHMiLCAic3JjL2FwaS9kZXByZWNhdGVkLnRzIiwgInNyYy9saW5rcy9yZWFkaW5nLnRzIiwgInNyYy9wYXRjaGVycy50cyIsICJub2RlX21vZHVsZXMvbW9ua2V5LWFyb3VuZC9tanMvaW5kZXguanMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbImltcG9ydCB7IE1hcmtkb3duVmlldywgUGx1Z2luLCBURmlsZSwgbG9hZE1hdGhKYXggfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IFN0YXRlRWZmZWN0IH0gZnJvbSAnQGNvZGVtaXJyb3Ivc3RhdGUnO1xuaW1wb3J0IHsgY3JlYXRlRWRpdG9yRXh0ZW5zaW9ucyB9IGZyb20gJy4vbGlua3MvcHJldmlldyc7XG5pbXBvcnQgeyBNYXRoTGlua3NTZXR0aW5ncywgREVGQVVMVF9TRVRUSU5HUyB9IGZyb20gXCIuL3NldHRpbmdzL3NldHRpbmdzXCI7XG5pbXBvcnQgeyBNYXRoTGlua3NTZXR0aW5nVGFiIH0gZnJvbSBcIi4vc2V0dGluZ3MvdGFiXCJcbmltcG9ydCB7IE1hdGhMaW5rc0FQSUFjY291bnQgfSBmcm9tIFwiLi9hcGkvZGVwcmVjYXRlZFwiO1xuaW1wb3J0IHsgRGVwcmVjYXRlZEFQSVByb3ZpZGVyLCBOYXRpdmVQcm92aWRlciwgUHJvdmlkZXIgfSBmcm9tIFwiLi9hcGkvcHJvdmlkZXJcIjtcbmltcG9ydCB7IGdlbmVyYXRlTWF0aExpbmtzIH0gZnJvbSBcIi4vbGlua3MvcmVhZGluZ1wiO1xuaW1wb3J0IHsgaXNFeGNsdWRlZCB9IGZyb20gXCIuL3V0aWxzXCI7XG5pbXBvcnQgeyBwYXRjaE91dGxpbmUsIHBhdGNoTGlua0F1dG9jb21wbGV0aW9uIH0gZnJvbSAnLi9wYXRjaGVycyc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1hdGhMaW5rcyBleHRlbmRzIFBsdWdpbiB7XG4gICAgc2V0dGluZ3M6IE1hdGhMaW5rc1NldHRpbmdzO1xuICAgIGFwaUFjY291bnRzOiBNYXRoTGlua3NBUElBY2NvdW50W107XG4gICAgcHJvdmlkZXJzOiB7IHByb3ZpZGVyOiBQcm92aWRlciwgc29ydE9yZGVyOiBudW1iZXIgfVtdID0gW107XG4gICAgbmF0aXZlUHJvdmlkZXI6IE5hdGl2ZVByb3ZpZGVyO1xuICAgIGZvcmNlVXBkYXRlRWZmZWN0ID0gU3RhdGVFZmZlY3QuZGVmaW5lPG51bGw+KCk7XG5cbiAgICBhc3luYyBvbmxvYWQoKSB7XG4gICAgICAgIGF3YWl0IHRoaXMubG9hZFNldHRpbmdzKCk7XG4gICAgICAgIGF3YWl0IGxvYWRNYXRoSmF4KCk7XG5cbiAgICAgICAgdGhpcy5uYXRpdmVQcm92aWRlciA9IG5ldyBOYXRpdmVQcm92aWRlcih0aGlzKTtcbiAgICAgICAgdGhpcy5hZGRDaGlsZCh0aGlzLm5hdGl2ZVByb3ZpZGVyKTtcbiAgICAgICAgdGhpcy5yZWdpc3RlclByb3ZpZGVyKHRoaXMubmF0aXZlUHJvdmlkZXIsIEluZmluaXR5KTtcblxuICAgICAgICAvLyBNYXJrZG93biBQb3N0IFByb2Nlc3NvciBmb3IgcmVhZGluZyB2aWV3XG4gICAgICAgIHRoaXMucmVnaXN0ZXJNYXJrZG93blBvc3RQcm9jZXNzb3IoKGVsZW1lbnQsIGNvbnRleHQpID0+IHtcbiAgICAgICAgICAgIGxldCBmaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKGNvbnRleHQuc291cmNlUGF0aCk7XG4gICAgICAgICAgICBpZiAoZmlsZSAmJiBpc0V4Y2x1ZGVkKHRoaXMsIGZpbGUpKSB7XG4gICAgICAgICAgICAgICAgZ2VuZXJhdGVNYXRoTGlua3ModGhpcywgZWxlbWVudCwgY29udGV4dCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMucmVnaXN0ZXJFZGl0b3JFeHRlbnNpb24oY3JlYXRlRWRpdG9yRXh0ZW5zaW9ucyh0aGlzKSk7XG5cbiAgICAgICAgdGhpcy5yZWdpc3RlckV2ZW50KHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUub24oJ2NoYW5nZWQnLCBmaWxlID0+IHRoaXMudXBkYXRlKGZpbGUpKSk7XG4gICAgICAgIC8vIEZvcmNlLXVwZGF0ZSB3aGVuIHN3aXRjaGluZyBiZXR3ZWVuIFJlYWRpbmcgJiBFZGl0aW5nIHZpZXdzXG4gICAgICAgIHRoaXMucmVnaXN0ZXJFdmVudCh0aGlzLmFwcC53b3Jrc3BhY2Uub24oJ2xheW91dC1jaGFuZ2UnLCAoKSA9PiB0aGlzLnVwZGF0ZSgpKSk7XG5cbiAgICAgICAgdGhpcy5hcGlBY2NvdW50cyA9IFtdO1xuXG4gICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS96aGFvc2hlbnpoYWkvb2JzaWRpYW4tbWF0aGxpbmtzL2lzc3Vlcy81NVxuICAgICAgICAvLyBQYXRjaCB0aGUgY29yZSBPdXRsaW5lIHZpZXcgdG8gcmVuZGVyIE1hdGhKYXggaW4gaXQ7IHRyeSB1bnRpbCBzdWNjZXNzZnVsXG4gICAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5vbkxheW91dFJlYWR5KCgpID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLnNldHRpbmdzLnJlbmRlck91dGxpbmUgJiYgKHRoaXMuYXBwIGFzIGFueSkuaW50ZXJuYWxQbHVnaW5zLnBsdWdpbnMub3V0bGluZS5lbmFibGVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wYXRjaChwYXRjaE91dGxpbmUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5wYXRjaChwYXRjaExpbmtBdXRvY29tcGxldGlvbik7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHBhdGNoKHBhdGNoZXI6IChwbHVnaW46IE1hdGhMaW5rcykgPT4gYm9vbGVhbikge1xuICAgICAgICBjb25zdCBzdWNjZXNzID0gcGF0Y2hlcih0aGlzKTtcbiAgICAgICAgaWYgKCFzdWNjZXNzKSB7XG4gICAgICAgICAgICBjb25zdCBldmVudFJlZiA9IHRoaXMuYXBwLndvcmtzcGFjZS5vbignbGF5b3V0LWNoYW5nZScsICgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBzdWNjZXNzID0gcGF0Y2hlcih0aGlzKTtcbiAgICAgICAgICAgICAgICBpZiAoc3VjY2VzcykgdGhpcy5hcHAud29ya3NwYWNlLm9mZnJlZihldmVudFJlZik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMucmVnaXN0ZXJFdmVudChldmVudFJlZik7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXRBUElBY2NvdW50KHVzZXJQbHVnaW46IFJlYWRvbmx5PFBsdWdpbj4pOiBNYXRoTGlua3NBUElBY2NvdW50IHtcbiAgICAgICAgbGV0IGFjY291bnQgPSB0aGlzLmFwaUFjY291bnRzLmZpbmQoKGFjY291bnQpID0+IGFjY291bnQubWFuaWZlc3QuaWQgPT0gdXNlclBsdWdpbi5tYW5pZmVzdC5pZCk7XG4gICAgICAgIGlmIChhY2NvdW50KSByZXR1cm4gYWNjb3VudDtcblxuICAgICAgICBhY2NvdW50ID0gbmV3IE1hdGhMaW5rc0FQSUFjY291bnQodGhpcywgdXNlclBsdWdpbi5tYW5pZmVzdCwgREVGQVVMVF9TRVRUSU5HUy5ibG9ja1ByZWZpeCwgKCkgPT4gbnVsbCk7XG4gICAgICAgIHRoaXMuYXBpQWNjb3VudHMucHVzaChhY2NvdW50KTtcblxuICAgICAgICBjb25zdCBwcm92aWRlciA9IG5ldyBEZXByZWNhdGVkQVBJUHJvdmlkZXIoYWNjb3VudCk7XG4gICAgICAgIHVzZXJQbHVnaW4uYWRkQ2hpbGQocHJvdmlkZXIpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyUHJvdmlkZXIocHJvdmlkZXIpO1xuXG4gICAgICAgIHJldHVybiBhY2NvdW50O1xuICAgIH1cblxuICAgIGFzeW5jIGxvYWRTZXR0aW5ncygpIHtcbiAgICAgICAgdGhpcy5zZXR0aW5ncyA9IE9iamVjdC5hc3NpZ24oe30sIERFRkFVTFRfU0VUVElOR1MsIGF3YWl0IHRoaXMubG9hZERhdGEoKSk7XG4gICAgICAgIHRoaXMuYWRkU2V0dGluZ1RhYihuZXcgTWF0aExpbmtzU2V0dGluZ1RhYih0aGlzLmFwcCwgdGhpcykpO1xuICAgIH1cblxuICAgIGFzeW5jIHNhdmVTZXR0aW5ncygpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5zYXZlRGF0YSh0aGlzLnNldHRpbmdzKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcGFyYW0gcHJvdmlkZXIgXG4gICAgICogQHBhcmFtIHNvcnRPcmRlciAtIEFuIG9wdGlvbmFsIGludGVnZXIgc29ydCBvcmRlci4gRGVmYXVsdHMgdG8gMC4gTG93ZXIgbnVtYmVyIHJ1bnMgYmVmb3JlIGhpZ2hlciBudW1iZXJzLlxuICAgICAqL1xuICAgIHJlZ2lzdGVyUHJvdmlkZXIocHJvdmlkZXI6IFByb3ZpZGVyLCBzb3J0T3JkZXI/OiBudW1iZXIpIHtcbiAgICAgICAgdGhpcy5wcm92aWRlcnMuZmluZChhbm90aGVyID0+IGFub3RoZXIucHJvdmlkZXIgPT09IHByb3ZpZGVyKVxuICAgICAgICAgICAgPz8gdGhpcy5wcm92aWRlcnMucHVzaCh7IHByb3ZpZGVyLCBzb3J0T3JkZXI6IHNvcnRPcmRlciA/PyAwIH0pO1xuICAgIH1cblxuICAgIGl0ZXJhdGVQcm92aWRlcnMoY2FsbGJhY2s6IChwcm92aWRlcjogUHJvdmlkZXIpID0+IGFueSkge1xuICAgICAgICB0aGlzLnByb3ZpZGVyc1xuICAgICAgICAgICAgLnNvcnQoKHAxLCBwMikgPT4gcDEuc29ydE9yZGVyIC0gcDIuc29ydE9yZGVyKVxuICAgICAgICAgICAgLmZvckVhY2goKHsgcHJvdmlkZXIgfSkgPT4gY2FsbGJhY2socHJvdmlkZXIpKTtcbiAgICB9XG5cbiAgICBlbmFibGVJblNvdXJjZU1vZGUoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLnByb3ZpZGVycy5zb21lKCh7IHByb3ZpZGVyIH0pID0+IHByb3ZpZGVyLmVuYWJsZUluU291cmNlTW9kZSk7XG4gICAgfVxuXG4gICAgdXBkYXRlKGZpbGU/OiBURmlsZSkge1xuICAgICAgICBpZiAoZmlsZSkge1xuICAgICAgICAgICAgdGhpcy5fdXBkYXRlKFwibWF0aGxpbmtzOnVwZGF0ZVwiLCBmaWxlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX3VwZGF0ZShcIm1hdGhsaW5rczp1cGRhdGUtYWxsXCIpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gZXZlbnROYW1lOiBzZWUgc3JjL3R5cGUuZC50c1xuICAgIHByaXZhdGUgX3VwZGF0ZSguLi5hcmdzOiBbZXZlbnROYW1lOiBcIm1hdGhsaW5rczp1cGRhdGVcIiwgZmlsZTogVEZpbGVdIHwgW2V2ZW50TmFtZTogXCJtYXRobGlua3M6dXBkYXRlLWFsbFwiXSkge1xuICAgICAgICAvLyB0cmlnZ2VyIGFuIGV2ZW50IGluZm9ybWluZyB0aGlzIHVwZGF0ZVxuICAgICAgICBjb25zdCBbZXZlbnROYW1lLCBmaWxlXSA9IGFyZ3M7XG4gICAgICAgIHRoaXMuYXBwLm1ldGFkYXRhQ2FjaGUudHJpZ2dlcihldmVudE5hbWUsIGZpbGUpO1xuXG4gICAgICAgIC8vIHJlZnJlc2ggbWF0aExpbmtzIGRpc3BsYXkgYmFzZWQgb24gdGhlIG5ldyBtZXRhZGF0YVxuICAgICAgICB0aGlzLmFwcC53b3Jrc3BhY2UuaXRlcmF0ZUFsbExlYXZlcygobGVhZikgPT4ge1xuICAgICAgICAgICAgaWYgKGxlYWYudmlldyBpbnN0YW5jZW9mIE1hcmtkb3duVmlldyAmJiBsZWFmLnZpZXcuZ2V0TW9kZSgpID09PSAnc291cmNlJykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGVkaXRvclZpZXcgPSBsZWFmLnZpZXcuZWRpdG9yLmNtO1xuICAgICAgICAgICAgICAgIGlmICghZWRpdG9yVmlldykgcmV0dXJuOyAvLyBpZ25vcmUgdGhlIGxlZ2FjeSBlZGl0b3JcblxuICAgICAgICAgICAgICAgIC8vIFNob3VsZCBkaXNwYXRjaCBpZiBubyBmaWxlIGlzIHNwZWNpZmllZCAoaS5lLiBcInVwZGF0ZS1hbGxcIilcbiAgICAgICAgICAgICAgICBsZXQgc2hvdWxkRGlzcGF0Y2ggPSAhZmlsZTtcbiAgICAgICAgICAgICAgICBpZiAoZmlsZSAmJiBsZWFmLnZpZXcuZmlsZSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBTaG91bGQgZGlzcGF0Y2ggaWYgdGhlIG9wZW5lZCBmaWxlIChsZWFmLnZpZXcuZmlsZSkgbGlua3MgdG8gdGhlIGNoYW5nZWQgZmlsZSAoZmlsZSlcbiAgICAgICAgICAgICAgICAgICAgc2hvdWxkRGlzcGF0Y2ggPSBmaWxlLnBhdGggaW4gdGhpcy5hcHAubWV0YWRhdGFDYWNoZS5yZXNvbHZlZExpbmtzW2xlYWYudmlldy5maWxlLnBhdGhdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoc2hvdWxkRGlzcGF0Y2gpIHtcbiAgICAgICAgICAgICAgICAgICAgZWRpdG9yVmlldy5kaXNwYXRjaCh7IGVmZmVjdHM6IHRoaXMuZm9yY2VVcGRhdGVFZmZlY3Qub2YobnVsbCkgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbn1cbiIsICIvKipcbiAqIEluc3BpcmVkIGJ5ICYgYWRhcHRlZCBmcm9tIERhdGF2aWV3J3MgaW5saW5lIGZpZWxkcyByZW5kZXJpbmcgZmVhdHVyZTpcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9ibGFja3NtaXRoZ3Uvb2JzaWRpYW4tZGF0YXZpZXcvYmxvYi9iMDBiZWI3NTk2Zjk5MjZjYTk1NzljNmYzMTkzNDFjZWFlNGY1YjVlL3NyYy91aS92aWV3cy9pbmxpbmUtZmllbGQtbGl2ZS1wcmV2aWV3LnRzXG4gKiBcbiAqIFRoZSBvcmlnaW5hbCB3b3JrIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZTpcbiAqIFxuICogTUlUIExpY2Vuc2VcbiAqIFxuICogQ29weXJpZ2h0IChjKSAyMDIxIE1pY2hhZWwgQnJlbmFuXG4gKiBcbiAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbiAqIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbiAqIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbiAqIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbiAqIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuICogZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcbiAqIFxuICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsXG4gKiBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuICogXG4gKiBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG4gKiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbiAqIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuICogQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuICogTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbiAqIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFXG4gKiBTT0ZUV0FSRS5cbiAqL1xuXG5pbXBvcnQgeyBLZXltYXAsIGVkaXRvckluZm9GaWVsZCwgZWRpdG9yTGl2ZVByZXZpZXdGaWVsZCwgZ2V0TGlua3BhdGggfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IFRyYW5zYWN0aW9uLCBFZGl0b3JTdGF0ZSwgUmFuZ2VTZXQsIFJhbmdlU2V0QnVpbGRlciwgUmFuZ2VWYWx1ZSwgU3RhdGVFZmZlY3RUeXBlLCBTdGF0ZUZpZWxkLCBFZGl0b3JTZWxlY3Rpb24sIEV4dGVuc2lvbiB9IGZyb20gXCJAY29kZW1pcnJvci9zdGF0ZVwiO1xuaW1wb3J0IHtcbiAgICBEZWNvcmF0aW9uLFxuICAgIERlY29yYXRpb25TZXQsXG4gICAgRWRpdG9yVmlldyxcbiAgICBQbHVnaW5WYWx1ZSxcbiAgICBWaWV3UGx1Z2luLFxuICAgIFZpZXdVcGRhdGUsXG4gICAgV2lkZ2V0VHlwZSxcbn0gZnJvbSBcIkBjb2RlbWlycm9yL3ZpZXdcIjtcbmltcG9ydCBNYXRoTGlua3MgZnJvbSAnLi4vbWFpbic7XG5pbXBvcnQgeyBzeW50YXhUcmVlIH0gZnJvbSBcIkBjb2RlbWlycm9yL2xhbmd1YWdlXCI7XG5pbXBvcnQgeyBnZXRNYXRoTGluaywgc2V0TWF0aExpbmsgfSBmcm9tIFwiLi9oZWxwZXJcIjtcbmltcG9ydCB7IGFkZFN1cGVyQ2hhcmdlZCB9IGZyb20gXCIuL3N1cGVyY2hhcmdlZFwiO1xuXG5cbmZ1bmN0aW9uIHNlbGVjdGlvbkFuZFJhbmdlT3ZlcmxhcChzZWxlY3Rpb246IEVkaXRvclNlbGVjdGlvbiwgcmFuZ2VGcm9tOiBudW1iZXIsIHJhbmdlVG86IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIGZvciAoY29uc3QgcmFuZ2Ugb2Ygc2VsZWN0aW9uLnJhbmdlcykge1xuICAgICAgICBpZiAocmFuZ2UuZnJvbSA8PSByYW5nZVRvICYmIHJhbmdlLnRvID49IHJhbmdlRnJvbSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufVxuXG5mdW5jdGlvbiBoYXNFZmZlY3Q8VD4odHI6IFRyYW5zYWN0aW9uLCBlZmZlY3RUeXBlOiBTdGF0ZUVmZmVjdFR5cGU8VD4pOiBib29sZWFuIHtcbiAgICByZXR1cm4gdHIuZWZmZWN0cy5zb21lKGVmZmVjdCA9PiBlZmZlY3QuaXMoZWZmZWN0VHlwZSkpO1xufVxuXG5jbGFzcyBNYXRoTGlua0luZm8gZXh0ZW5kcyBSYW5nZVZhbHVlIHtcbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgbGlua1RleHQ6IHN0cmluZywgcHVibGljIG1hdGhMaW5rOiBzdHJpbmcpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICB9XG5cbiAgICBlcShvdGhlcjogTWF0aExpbmtJbmZvKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmxpbmtUZXh0ID09IG90aGVyLmxpbmtUZXh0ICYmIHRoaXMubWF0aExpbmsgPT0gb3RoZXIubWF0aExpbms7XG4gICAgfVxufVxuXG5cbmV4cG9ydCBjb25zdCBjcmVhdGVFZGl0b3JFeHRlbnNpb25zID0gKHBsdWdpbjogTWF0aExpbmtzKTogRXh0ZW5zaW9uW10gPT4ge1xuXG4gICAgY29uc3QgYnVpbGRGaWVsZCA9IChzdGF0ZTogRWRpdG9yU3RhdGUpOiBSYW5nZVNldDxNYXRoTGlua0luZm8+ID0+IHtcbiAgICAgICAgbGV0IGJ1aWxkZXIgPSBuZXcgUmFuZ2VTZXRCdWlsZGVyPE1hdGhMaW5rSW5mbz4oKTtcbiAgICAgICAgY29uc3QgaXNTb3VyY2VNb2RlID0gIXN0YXRlLmZpZWxkKGVkaXRvckxpdmVQcmV2aWV3RmllbGQpO1xuICAgICAgICBjb25zdCBmaWxlID0gc3RhdGUuZmllbGQoZWRpdG9ySW5mb0ZpZWxkKS5maWxlO1xuXG4gICAgICAgIGxldCBzdGFydCA9IC0xLCBlbmQgPSAtMSwgb3V0TGlua1RleHQgPSBcIlwiLCBvdXRMaW5rTWF0aExpbmsgPSBcIlwiO1xuXG4gICAgICAgIHN5bnRheFRyZWUoc3RhdGUpLml0ZXJhdGUoe1xuICAgICAgICAgICAgZW50ZXIobm9kZSkge1xuICAgICAgICAgICAgICAgIGxldCBuYW1lID0gbm9kZS50eXBlLm5hbWU7XG5cbiAgICAgICAgICAgICAgICAvLyBTdGFydFxuICAgICAgICAgICAgICAgIGlmIChuYW1lLmNvbnRhaW5zKFwiZm9ybWF0dGluZy1saW5rX2Zvcm1hdHRpbmctbGluay1zdGFydFwiKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXNTb3VyY2VNb2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGUuc2xpY2VEb2Mobm9kZS5mcm9tLCBub2RlLnRvKSA9PSBcIltbXCIgJiYgbm9kZS5ub2RlLm5leHRTaWJsaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQgPSBub2RlLm5vZGUubmV4dFNpYmxpbmcuZnJvbTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQgPSBub2RlLmZyb207XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBTdGFydCAoY2hlY2sgdGhhdCBpdCBpcyBub3QgZW5kKVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKG5hbWUuY29udGFpbnMoXCJmb3JtYXR0aW5nX2Zvcm1hdHRpbmctbGlua19saW5rXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGFydCA9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQgPSBub2RlLmZyb207XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBBbGlhczogRmlsZSBuYW1lXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAobmFtZS5jb250YWlucyhcImhhcy1hbGlhc1wiKSkge1xuICAgICAgICAgICAgICAgICAgICBvdXRMaW5rVGV4dCArPSBzdGF0ZS5kb2Muc2xpY2VTdHJpbmcobm9kZS5mcm9tLCBub2RlLnRvKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGUgJiYgb3V0TGlua01hdGhMaW5rID09IG91dExpbmtUZXh0LnJlcGxhY2UoL1xcLm1kLywgXCJcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG91dExpbmtNYXRoTGluayA9IGdldE1hdGhMaW5rKHBsdWdpbiwgb3V0TGlua1RleHQsIGZpbGUucGF0aCwgaXNTb3VyY2VNb2RlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIEFsaWFzOiBGaWxlIG5hbWUgKHdpdGggZGVjb2RpbmcpXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoL3N0cmluZ191cmwkLy50ZXN0KG5hbWUpICYmICFuYW1lLmNvbnRhaW5zKFwiZm9ybWF0XCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIG91dExpbmtUZXh0ICs9IGRlY29kZVVSSShzdGF0ZS5kb2Muc2xpY2VTdHJpbmcobm9kZS5mcm9tLCBub2RlLnRvKSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWxlICYmIG91dExpbmtNYXRoTGluayA9PSBvdXRMaW5rVGV4dC5yZXBsYWNlKC9cXC5tZC8sIFwiXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvdXRMaW5rTWF0aExpbmsgPSBnZXRNYXRoTGluayhwbHVnaW4sIG91dExpbmtUZXh0LCBmaWxlLnBhdGgsIGlzU291cmNlTW9kZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBObyBhbGlhc1xuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGZpbGUgJiYgbmFtZS5jb250YWlucyhcImhtZC1pbnRlcm5hbC1saW5rXCIpICYmICFuYW1lLmNvbnRhaW5zKFwiYWxpYXNcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgb3V0TGlua1RleHQgKz0gc3RhdGUuZG9jLnNsaWNlU3RyaW5nKG5vZGUuZnJvbSwgbm9kZS50byk7XG4gICAgICAgICAgICAgICAgICAgIG91dExpbmtNYXRoTGluayA9IGdldE1hdGhMaW5rKHBsdWdpbiwgb3V0TGlua1RleHQsIGZpbGUucGF0aCwgaXNTb3VyY2VNb2RlKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBFbmRcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChuYW1lLmNvbnRhaW5zKFwiZm9ybWF0dGluZy1saW5rLWVuZFwiKSB8fCBuYW1lLmNvbnRhaW5zKFwiZm9ybWF0dGluZy1saW5rLXN0cmluZ1wiKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIW5hbWUuY29udGFpbnMoXCJlbmRcIikgJiYgZW5kID09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbmQgPSAtMjtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc1NvdXJjZU1vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobm9kZS5ub2RlLnByZXZTaWJsaW5nICYmIHN0YXRlLnNsaWNlRG9jKG5vZGUuZnJvbSwgbm9kZS50bykgPT0gXCJdXVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCA9IG5vZGUubm9kZS5wcmV2U2libGluZy50bztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQgPSBub2RlLnRvO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob3V0TGlua1RleHQgJiYgb3V0TGlua01hdGhMaW5rKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnVpbGRlci5hZGQoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBNYXRoTGlua0luZm8ob3V0TGlua1RleHQsIG91dExpbmtNYXRoTGluay5yZXBsYWNlKC9cXFxcXFwkLywgXCIkXCIpKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydCA9IC0xO1xuICAgICAgICAgICAgICAgICAgICAgICAgZW5kID0gLTE7XG4gICAgICAgICAgICAgICAgICAgICAgICBvdXRMaW5rVGV4dCA9IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBvdXRMaW5rTWF0aExpbmsgPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gQWxpYXM6IE1hdGhMaW5rXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoIW5hbWUuY29udGFpbnMoXCJwaXBlXCIpICYmICgobmFtZS5jb250YWlucyhcImhtZC1pbnRlcm5hbC1saW5rXCIpICYmIG5hbWUuY29udGFpbnMoXCJhbGlhc1wiKSkgfHwgKG5hbWUuY29udGFpbnMoXCJobWQtZXNjYXBlXCIpICYmIG5hbWUuY29udGFpbnMoXCJsaW5rXCIpKSB8fCAvXmxpbmsvLnRlc3QobmFtZSkpKSB7XG4gICAgICAgICAgICAgICAgICAgIG91dExpbmtNYXRoTGluayArPSBzdGF0ZS5kb2Muc2xpY2VTdHJpbmcobm9kZS5mcm9tLCBub2RlLnRvKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGUgJiYgb3V0TGlua01hdGhMaW5rID09IG91dExpbmtUZXh0LnJlcGxhY2UoL1xcLm1kLywgXCJcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG91dExpbmtNYXRoTGluayA9IGdldE1hdGhMaW5rKHBsdWdpbiwgb3V0TGlua1RleHQsIGZpbGUucGF0aCwgaXNTb3VyY2VNb2RlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIGJ1aWxkZXIuZmluaXNoKCk7XG4gICAgfVxuXG5cbiAgICAvKiogQSBzdGF0ZSBmaWVsZCB0aGF0IHN0b3JlcyBsaW5rcyBhbmQgdGhlaXIgcG9zaXRpb25zIGFzIGEgcmFuZ2Ugc2V0LiAqL1xuICAgIGNvbnN0IG1hdGhMaW5rSW5mb0ZpZWxkID0gU3RhdGVGaWVsZC5kZWZpbmU8UmFuZ2VTZXQ8TWF0aExpbmtJbmZvPj4oe1xuICAgICAgICBjcmVhdGU6IGJ1aWxkRmllbGQsXG4gICAgICAgIHVwZGF0ZShvbGRGaWVsZHMsIHRyKSB7XG4gICAgICAgICAgICByZXR1cm4gdHIuZG9jQ2hhbmdlZCB8fCBoYXNFZmZlY3QodHIsIHBsdWdpbi5mb3JjZVVwZGF0ZUVmZmVjdCkgPyBidWlsZEZpZWxkKHRyLnN0YXRlKSA6IG9sZEZpZWxkcztcbiAgICAgICAgfVxuICAgIH0pO1xuXG5cbiAgICBjbGFzcyBNYXRoV2lkZ2V0IGV4dGVuZHMgV2lkZ2V0VHlwZSB7XG4gICAgICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBvdXRMaW5rVGV4dDogc3RyaW5nLCBwdWJsaWMgb3V0TGlua01hdGhMaW5rOiBzdHJpbmcsIHB1YmxpYyBpc1NvdXJjZU1vZGU6IGJvb2xlYW4sIHB1YmxpYyBzb3VyY2VQYXRoOiBzdHJpbmcpIHsgc3VwZXIoKTsgfVxuXG4gICAgICAgIGVxKG90aGVyOiBNYXRoV2lkZ2V0KSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5vdXRMaW5rVGV4dCA9PSBvdGhlci5vdXRMaW5rVGV4dCAmJiB0aGlzLm91dExpbmtNYXRoTGluayA9PSBvdGhlci5vdXRMaW5rTWF0aExpbmsgJiYgdGhpcy5pc1NvdXJjZU1vZGUgPT0gb3RoZXIuaXNTb3VyY2VNb2RlICYmIHRoaXMuc291cmNlUGF0aCA9PSBvdGhlci5zb3VyY2VQYXRoO1xuICAgICAgICB9XG5cbiAgICAgICAgdG9ET00oKSB7XG4gICAgICAgICAgICBsZXQgbWF0aExpbmsgPSBjcmVhdGVTcGFuKCk7XG4gICAgICAgICAgICBzZXRNYXRoTGluayh0aGlzLm91dExpbmtNYXRoTGluaywgbWF0aExpbmspO1xuICAgICAgICAgICAgaWYgKCF0aGlzLmlzU291cmNlTW9kZSkgbWF0aExpbmsuYWRkQ2xhc3MoXCJjbS11bmRlcmxpbmVcIik7XG4gICAgICAgICAgICBtYXRoTGluay5zZXRBdHRyaWJ1dGUoXCJkcmFnZ2FibGVcIiwgXCJ0cnVlXCIpO1xuXG4gICAgICAgICAgICBjb25zdCBsaW5rcGF0aCA9IGdldExpbmtwYXRoKHRoaXMub3V0TGlua1RleHQpO1xuICAgICAgICAgICAgY29uc3QgdGFyZ2V0RmlsZSA9IHBsdWdpbi5hcHAubWV0YWRhdGFDYWNoZS5nZXRGaXJzdExpbmtwYXRoRGVzdChsaW5rcGF0aCwgdGhpcy5zb3VyY2VQYXRoKTtcbiAgICAgICAgICAgIGlmICh0YXJnZXRGaWxlKSBhZGRTdXBlckNoYXJnZWQocGx1Z2luLCBtYXRoTGluaywgdGFyZ2V0RmlsZSk7XG5cbiAgICAgICAgICAgIGxldCBtYXRoTGlua1dyYXBwZXIgPSBjcmVhdGVTcGFuKCk7XG4gICAgICAgICAgICBtYXRoTGlua1dyYXBwZXIuYWRkQ2xhc3MoXCJjbS1obWQtaW50ZXJuYWwtbGlua1wiKTtcbiAgICAgICAgICAgIG1hdGhMaW5rV3JhcHBlci5hcHBlbmRDaGlsZChtYXRoTGluayk7XG5cbiAgICAgICAgICAgIG1hdGhMaW5rV3JhcHBlci5vbmNsaWNrID0gKChldnQ6IE1vdXNlRXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICBpZiAodGFyZ2V0RmlsZSkge1xuICAgICAgICAgICAgICAgICAgICBwbHVnaW4uYXBwLndvcmtzcGFjZS5vcGVuTGlua1RleHQodGhpcy5vdXRMaW5rVGV4dCwgdGhpcy5zb3VyY2VQYXRoLCBLZXltYXAuaXNNb2RFdmVudChldnQpKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLm9wZW4odGhpcy5vdXRMaW5rVGV4dCwgXCJfYmxhbmtcIiwgXCJub3JlZmVycmVyXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBtYXRoTGlua1dyYXBwZXIub25tb3VzZWRvd24gPSAoKGV2dDogTW91c2VFdmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChldnQuYnV0dG9uID09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIG1hdGhMaW5rV3JhcHBlci5vbmF1eGNsaWNrID0gKChldnQ6IE1vdXNlRXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZXZ0LmJ1dHRvbiA9PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXRGaWxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwbHVnaW4uYXBwLndvcmtzcGFjZS5vcGVuTGlua1RleHQodGhpcy5vdXRMaW5rVGV4dCwgdGhpcy5zb3VyY2VQYXRoLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYub3Blbih0aGlzLm91dExpbmtUZXh0LCBcIl9ibGFua1wiLCBcIm5vcmVmZXJyZXJcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIG1hdGhMaW5rV3JhcHBlcjtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IG1hdGhMaW5rc1ZpZXdQbHVnaW4gPSBWaWV3UGx1Z2luLmZyb21DbGFzcyhcbiAgICAgICAgY2xhc3MgaW1wbGVtZW50cyBQbHVnaW5WYWx1ZSB7XG4gICAgICAgICAgICBkZWNvcmF0aW9uczogRGVjb3JhdGlvblNldDtcblxuICAgICAgICAgICAgY29uc3RydWN0b3IodmlldzogRWRpdG9yVmlldykge1xuICAgICAgICAgICAgICAgIHRoaXMuZGVjb3JhdGlvbnMgPSB0aGlzLmJ1aWxkRGVjb3JhdGlvbnModmlldyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGJ1aWxkRGVjb3JhdGlvbnModmlldzogRWRpdG9yVmlldyk6IERlY29yYXRpb25TZXQge1xuICAgICAgICAgICAgICAgIC8vIERpc2FibGUgaW4gc291cmNlIG1vZGUgaWYgYWxsIHRoZSBwcm92aWRlciBhcmUgZGlzYWJsZWQgaW4gc291cmNlIG1vZGUuXG4gICAgICAgICAgICAgICAgaWYgKCF2aWV3LnN0YXRlLmZpZWxkKGVkaXRvckxpdmVQcmV2aWV3RmllbGQpICYmICFwbHVnaW4uZW5hYmxlSW5Tb3VyY2VNb2RlKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIERlY29yYXRpb24ubm9uZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBjb25zdCBzb3VyY2VQYXRoID0gdmlldy5zdGF0ZS5maWVsZChlZGl0b3JJbmZvRmllbGQpLmZpbGU/LnBhdGggPz8gJyc7XG4gICAgICAgICAgICAgICAgY29uc3QgaXNTb3VyY2VNb2RlID0gIXZpZXcuc3RhdGUuZmllbGQoZWRpdG9yTGl2ZVByZXZpZXdGaWVsZCk7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5mbyA9IHZpZXcuc3RhdGUuZmllbGQobWF0aExpbmtJbmZvRmllbGQpO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgYnVpbGRlciA9IG5ldyBSYW5nZVNldEJ1aWxkZXI8RGVjb3JhdGlvbj4oKTtcbiAgICAgICAgICAgICAgICBjb25zdCBzZWxlY3Rpb24gPSB2aWV3LnN0YXRlLnNlbGVjdGlvbjtcblxuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgeyBmcm9tLCB0byB9IG9mIHZpZXcudmlzaWJsZVJhbmdlcykge1xuICAgICAgICAgICAgICAgICAgICBpbmZvLmJldHdlZW4oZnJvbSwgdG8sIChzdGFydCwgZW5kLCB7IGxpbmtUZXh0LCBtYXRoTGluayB9KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGUgaW5saW5lIGZpZWxkIGlzIG5vdCBvdmVybGFwcGluZyB3aXRoIHRoZSBjdXJzb3IsIHdlIHJlcGxhY2UgaXQgd2l0aCBhIHdpZGdldC5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghc2VsZWN0aW9uQW5kUmFuZ2VPdmVybGFwKHNlbGVjdGlvbiwgc3RhcnQsIGVuZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBidWlsZGVyLmFkZChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRGVjb3JhdGlvbi53aWRnZXQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkZ2V0OiBuZXcgTWF0aFdpZGdldChsaW5rVGV4dCwgbWF0aExpbmssIGlzU291cmNlTW9kZSwgc291cmNlUGF0aCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBidWlsZGVyLmZpbmlzaCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB1cGRhdGUodXBkYXRlOiBWaWV3VXBkYXRlKSB7XG4gICAgICAgICAgICAgICAgLy8gRGlzYWJsZSBpbiBzb3VyY2UgbW9kZSBpZiBhbGwgdGhlIHByb3ZpZGVyIGFyZSBkaXNhYmxlZCBpbiBzb3VyY2UgbW9kZS5cbiAgICAgICAgICAgICAgICBpZiAoIXVwZGF0ZS5zdGF0ZS5maWVsZChlZGl0b3JMaXZlUHJldmlld0ZpZWxkKSAmJiAhcGx1Z2luLmVuYWJsZUluU291cmNlTW9kZSgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGVjb3JhdGlvbnMgPSBEZWNvcmF0aW9uLm5vbmU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKHVwZGF0ZS50cmFuc2FjdGlvbnMuc29tZSh0ciA9PiBoYXNFZmZlY3QodHIsIHBsdWdpbi5mb3JjZVVwZGF0ZUVmZmVjdCkpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGVjb3JhdGlvbnMgPSB0aGlzLmJ1aWxkRGVjb3JhdGlvbnModXBkYXRlLnZpZXcpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodXBkYXRlLmRvY0NoYW5nZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZWNvcmF0aW9ucyA9IHRoaXMuZGVjb3JhdGlvbnMubWFwKHVwZGF0ZS5jaGFuZ2VzKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVEZWNvcmF0aW9ucyh1cGRhdGUudmlldyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh1cGRhdGUuc2VsZWN0aW9uU2V0KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlRGVjb3JhdGlvbnModXBkYXRlLnZpZXcpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodXBkYXRlLnZpZXdwb3J0Q2hhbmdlZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRlY29yYXRpb25zID0gdGhpcy5idWlsZERlY29yYXRpb25zKHVwZGF0ZS52aWV3KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHVwZGF0ZURlY29yYXRpb25zKHZpZXc6IEVkaXRvclZpZXcpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBmaWxlID0gdmlldy5zdGF0ZS5maWVsZChlZGl0b3JJbmZvRmllbGQpLmZpbGU7XG4gICAgICAgICAgICAgICAgY29uc3Qgc291cmNlUGF0aCA9IGZpbGU/LnBhdGggPz8gJyc7XG4gICAgICAgICAgICAgICAgY29uc3QgaXNTb3VyY2VNb2RlID0gIXZpZXcuc3RhdGUuZmllbGQoZWRpdG9yTGl2ZVByZXZpZXdGaWVsZCk7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5mbyA9IHZpZXcuc3RhdGUuZmllbGQobWF0aExpbmtJbmZvRmllbGQpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGlvbiA9IHZpZXcuc3RhdGUuc2VsZWN0aW9uO1xuXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCB7IGZyb20sIHRvIH0gb2Ygdmlldy52aXNpYmxlUmFuZ2VzKSB7XG4gICAgICAgICAgICAgICAgICAgIGluZm8uYmV0d2Vlbihmcm9tLCB0bywgKHN0YXJ0LCBlbmQsIHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBvdmVybGFwID0gc2VsZWN0aW9uQW5kUmFuZ2VPdmVybGFwKHNlbGVjdGlvbiwgc3RhcnQsIGVuZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob3ZlcmxhcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlRGVjbyhzdGFydCwgZW5kKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkRGVjbyhzdGFydCwgZW5kLCB2YWx1ZSwgaXNTb3VyY2VNb2RlLCBzb3VyY2VQYXRoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZW1vdmVEZWNvKHN0YXJ0OiBudW1iZXIsIGVuZDogbnVtYmVyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kZWNvcmF0aW9ucy5iZXR3ZWVuKHN0YXJ0LCBlbmQsIChmcm9tLCB0bykgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmRlY29yYXRpb25zID0gdGhpcy5kZWNvcmF0aW9ucy51cGRhdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyRnJvbTogZnJvbSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlclRvOiB0byxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcjogKCkgPT4gZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBhZGREZWNvKHN0YXJ0OiBudW1iZXIsIGVuZDogbnVtYmVyLCB2YWx1ZTogTWF0aExpbmtJbmZvLCBpc1NvdXJjZU1vZGU6IGJvb2xlYW4sIHNvdXJjZVBhdGg6IHN0cmluZykge1xuICAgICAgICAgICAgICAgIGxldCBleGlzdHMgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB0aGlzLmRlY29yYXRpb25zLmJldHdlZW4oc3RhcnQsIGVuZCwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBleGlzdHMgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmICghZXhpc3RzKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGVjb3JhdGlvbnMgPSB0aGlzLmRlY29yYXRpb25zLnVwZGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBhZGQ6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb206IHN0YXJ0LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0bzogZW5kLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogRGVjb3JhdGlvbi53aWRnZXQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkZ2V0OiBuZXcgTWF0aFdpZGdldCh2YWx1ZS5saW5rVGV4dCwgdmFsdWUubWF0aExpbmssIGlzU291cmNlTW9kZSwgc291cmNlUGF0aCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICAgIGRlY29yYXRpb25zOiBpbnN0YW5jZSA9PiBpbnN0YW5jZS5kZWNvcmF0aW9ucyxcbiAgICAgICAgfVxuICAgICk7XG5cbiAgICByZXR1cm4gW21hdGhMaW5rSW5mb0ZpZWxkLCBtYXRoTGlua3NWaWV3UGx1Z2luXTtcbn1cbiIsICJpbXBvcnQgeyBNYXRoTGlua3NBUElBY2NvdW50IH0gZnJvbSAnLi9kZXByZWNhdGVkJztcbmltcG9ydCB7IEJsb2NrU3VicGF0aFJlc3VsdCwgQ29tcG9uZW50LCBIZWFkaW5nU3VicGF0aFJlc3VsdCwgVEZpbGUgfSBmcm9tICdvYnNpZGlhbic7XG5pbXBvcnQgeyBnZXRNYXRoTGlua0Zyb21TdWJwYXRoLCBnZXRNYXRoTGlua0Zyb21UZW1wbGF0ZXMgfSBmcm9tICcuLi9saW5rcy9oZWxwZXInO1xuaW1wb3J0IE1hdGhMaW5rcyBmcm9tICcuLi9tYWluJztcblxuLyoqXG4gKiBBIGNsYXNzIHRoYXQgcHJvdmlkZXMgYSBkaXNwbGF5ZWQgdGV4dCBmb3IgYSBnaXZlbiBsaW5rLlxuICovXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgUHJvdmlkZXIgZXh0ZW5kcyBDb21wb25lbnQge1xuICAgIF9lbmFibGVJblNvdXJjZU1vZGU6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBtYXRoTGlua3M6IE1hdGhMaW5rcykge1xuICAgICAgICBzdXBlcigpO1xuICAgIH1cblxuICAgIGdldCBlbmFibGVJblNvdXJjZU1vZGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9lbmFibGVJblNvdXJjZU1vZGU7XG4gICAgfVxuXG4gICAgc2V0IGVuYWJsZUluU291cmNlTW9kZShlbmFibGU6IGJvb2xlYW4pIHtcbiAgICAgICAgdGhpcy5fZW5hYmxlSW5Tb3VyY2VNb2RlID0gZW5hYmxlO1xuICAgICAgICB0aGlzLm1hdGhMaW5rcy51cGRhdGUoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgYWJzdHJhY3QgcHJvdmlkZShcbiAgICAgICAgcGFyc2VkTGlua3RleHQ6IHsgcGF0aDogc3RyaW5nLCBzdWJwYXRoOiBzdHJpbmcgfSxcbiAgICAgICAgdGFyZ2V0RmlsZTogVEZpbGUgfCBudWxsLFxuICAgICAgICB0YXJnZXRTdWJwYXRoUmVzdWx0OiBIZWFkaW5nU3VicGF0aFJlc3VsdCB8IEJsb2NrU3VicGF0aFJlc3VsdCB8IG51bGwsXG4gICAgICAgIHNvdXJjZUZpbGU6IFRGaWxlIHwgbnVsbCxcbiAgICApOiBzdHJpbmcgfCBudWxsO1xuXG4gICAgb251bmxvYWQoKSB7XG4gICAgICAgIGNvbnN0IHByb3ZpZGVycyA9IHRoaXMubWF0aExpbmtzLnByb3ZpZGVycztcbiAgICAgICAgbGV0IGluZGV4ID0gcHJvdmlkZXJzLmZpbmRJbmRleCgoeyBwcm92aWRlciB9KSA9PiBwcm92aWRlciA9PT0gdGhpcyk7XG4gICAgICAgIHByb3ZpZGVycy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICB0aGlzLm1hdGhMaW5rcy51cGRhdGUoKTtcbiAgICB9XG59XG5cbmV4cG9ydCBjbGFzcyBOYXRpdmVQcm92aWRlciBleHRlbmRzIFByb3ZpZGVyIHtcbiAgICBnZXQgZW5hYmxlSW5Tb3VyY2VNb2RlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5tYXRoTGlua3Muc2V0dGluZ3MuZW5hYmxlSW5Tb3VyY2VNb2RlO1xuICAgIH1cblxuICAgIHNldCBlbmFibGVJblNvdXJjZU1vZGUoZW5hYmxlOiBib29sZWFuKSB7XG4gICAgICAgIHRoaXMubWF0aExpbmtzLnNldHRpbmdzLmVuYWJsZUluU291cmNlTW9kZSA9IGVuYWJsZTtcbiAgICAgICAgdGhpcy5tYXRoTGlua3MudXBkYXRlKCk7XG4gICAgICAgIHRoaXMubWF0aExpbmtzLnNhdmVTZXR0aW5ncygpO1xuICAgIH1cblxuICAgIHB1YmxpYyBwcm92aWRlKFxuICAgICAgICBwYXJzZWRMaW5rdGV4dDogeyBwYXRoOiBzdHJpbmcsIHN1YnBhdGg6IHN0cmluZyB9LFxuICAgICAgICB0YXJnZXRGaWxlOiBURmlsZSB8IG51bGwsXG4gICAgICAgIHRhcmdldFN1YnBhdGhSZXN1bHQ6IEhlYWRpbmdTdWJwYXRoUmVzdWx0IHwgQmxvY2tTdWJwYXRoUmVzdWx0IHwgbnVsbFxuICAgICk6IHN0cmluZyB8IG51bGwge1xuICAgICAgICBjb25zdCB7IG1hdGhMaW5rcyB9ID0gdGhpcztcbiAgICAgICAgY29uc3QgeyBhcHAgfSA9IG1hdGhMaW5rcztcblxuICAgICAgICBpZiAoIXRhcmdldEZpbGUpIHJldHVybiBudWxsO1xuXG4gICAgICAgIGxldCBjYWNoZSA9IGFwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZSh0YXJnZXRGaWxlKTtcbiAgICAgICAgaWYgKCFjYWNoZSkgcmV0dXJuIG51bGw7XG5cbiAgICAgICAgbGV0IG1hdGhMaW5rOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcbiAgICAgICAgaWYgKHRhcmdldFN1YnBhdGhSZXN1bHQpIHtcbiAgICAgICAgICAgIG1hdGhMaW5rID0gZ2V0TWF0aExpbmtGcm9tU3VicGF0aChwYXJzZWRMaW5rdGV4dC5wYXRoLCB0YXJnZXRTdWJwYXRoUmVzdWx0LCBjYWNoZS5mcm9udG1hdHRlciwgbWF0aExpbmtzLnNldHRpbmdzLmJsb2NrUHJlZml4LFxuICAgICAgICAgICAgICAgIC8vIElmIGVuYWJsZUZpbGVOYW1lQmxvY2tMaW5rcyA9PSB0cnVlLCBwYXNzIGBudWxsYCB0byB0aGUgbGFzdCBwYXJhbWV0ZXIgYHByZWZpeGAsIHdoaWNoIG1lYW5zIHVzaW5nIHRoZSBzdGFuZGFyZCBwcmVmaXggKGUuZy4gbm90ZSA+IGJsb2NrKS4gXG4gICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlLCBwYXNzIGFuIGVtcHR5IHN0cmluZyB0byBgcHJlZml4YCwgd2hpY2ggbWVhbnMgdXNpbmcgbm8gcHJlZml4IChubyBwcmVmaXggaXMgYSBzcGVjaWFsIGNhc2Ugb2YgY3VzdG9tIHByZWZpeGVzKS5cbiAgICAgICAgICAgICAgICBtYXRoTGlua3Muc2V0dGluZ3MuZW5hYmxlRmlsZU5hbWVCbG9ja0xpbmtzID8gbnVsbCA6IFwiXCJcbiAgICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSBpZiAocGFyc2VkTGlua3RleHQucGF0aCkge1xuICAgICAgICAgICAgbWF0aExpbmsgPSBjYWNoZS5mcm9udG1hdHRlcj8ubWF0aExpbms7XG4gICAgICAgICAgICBpZiAobWF0aExpbmsgPT0gXCJhdXRvXCIpIHtcbiAgICAgICAgICAgICAgICBtYXRoTGluayA9IGdldE1hdGhMaW5rRnJvbVRlbXBsYXRlcyhtYXRoTGlua3MsIHRhcmdldEZpbGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIG1hdGhMaW5rO1xuICAgIH1cbn1cblxuLyoqXG4gKiBQcm92aWRlciBmb3IgcHJlc2VydmluZyBiYWNrd2FyZCBjb21wYXRpYmlsaXR5IHdpdGggdGhlIGRlcHJlY2F0ZWQgQVBJLlxuICovXG5leHBvcnQgY2xhc3MgRGVwcmVjYXRlZEFQSVByb3ZpZGVyIGV4dGVuZHMgUHJvdmlkZXIge1xuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyBhY2NvdW50OiBNYXRoTGlua3NBUElBY2NvdW50KSB7XG4gICAgICAgIHN1cGVyKGFjY291bnQucGx1Z2luKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgcHJvdmlkZShcbiAgICAgICAgcGFyc2VkTGlua3RleHQ6IHsgcGF0aDogc3RyaW5nLCBzdWJwYXRoOiBzdHJpbmcgfSxcbiAgICAgICAgdGFyZ2V0RmlsZTogVEZpbGUgfCBudWxsLFxuICAgICAgICB0YXJnZXRTdWJwYXRoUmVzdWx0OiBIZWFkaW5nU3VicGF0aFJlc3VsdCB8IEJsb2NrU3VicGF0aFJlc3VsdCB8IG51bGwsXG4gICAgICAgIHNvdXJjZUZpbGU6IFRGaWxlIHwgbnVsbCxcbiAgICApOiBzdHJpbmcgfCBudWxsIHtcbiAgICAgICAgaWYgKHRhcmdldEZpbGUgPT09IG51bGwgfHwgc291cmNlRmlsZSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgbWF0aExpbms6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICAgICAgICBjb25zdCBtZXRhZGF0YSA9IHRoaXMuYWNjb3VudC5tZXRhZGF0YVNldC5nZXQodGFyZ2V0RmlsZSk7XG4gICAgICAgIGlmIChtZXRhZGF0YSkge1xuICAgICAgICAgICAgaWYgKHRhcmdldFN1YnBhdGhSZXN1bHQpIHtcbiAgICAgICAgICAgICAgICBtYXRoTGluayA9IGdldE1hdGhMaW5rRnJvbVN1YnBhdGgocGFyc2VkTGlua3RleHQucGF0aCwgdGFyZ2V0U3VicGF0aFJlc3VsdCwgbWV0YWRhdGEsIHRoaXMuYWNjb3VudC5ibG9ja1ByZWZpeCxcbiAgICAgICAgICAgICAgICAgICAgLy8gQW4gQVBJIHVzZXIgY2FuIHNwZWNpZnkgY3VzdG9tIHByZWZpeGVzIGRlcGVuZGluZyBvbiB0aGUgc291cmNlIGZpbGUgKHNvdXJjZUZpbGUpICYgdGhlIHRhcmdldCBmaWxlIChmaWxlKS5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hY2NvdW50LnByZWZpeGVyKHNvdXJjZUZpbGUsIHRhcmdldEZpbGUsIHRhcmdldFN1YnBhdGhSZXN1bHQpXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbWF0aExpbmsgPSBtZXRhZGF0YVtcIm1hdGhMaW5rXCJdID8/IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbWF0aExpbms7XG4gICAgfVxufVxuIiwgImltcG9ydCB7IE5hdGl2ZVByb3ZpZGVyIH0gZnJvbSAnLi8uLi9hcGkvcHJvdmlkZXInO1xuaW1wb3J0IHsgVEZpbGUsIHJlbmRlck1hdGgsIGZpbmlzaFJlbmRlck1hdGgsIHBhcnNlTGlua3RleHQsIHJlc29sdmVTdWJwYXRoLCBCbG9ja1N1YnBhdGhSZXN1bHQsIEhlYWRpbmdTdWJwYXRoUmVzdWx0IH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBNYXRoTGlua3NNZXRhZGF0YSB9IGZyb20gXCIuLi9hcGkvZGVwcmVjYXRlZFwiO1xuaW1wb3J0IE1hdGhMaW5rcyBmcm9tIFwiLi4vbWFpblwiO1xuXG5leHBvcnQgZnVuY3Rpb24gc2V0TWF0aExpbmsoc291cmNlOiBzdHJpbmcsIG1hdGhMaW5rRWw6IEhUTUxFbGVtZW50KSB7XG4gICAgbWF0aExpbmtFbC5yZXBsYWNlQ2hpbGRyZW4oKTtcbiAgICBjb25zdCBtYXRoUGF0dGVybiA9IC9cXCQoLio/W15cXHNdKVxcJC9nO1xuICAgIGxldCB0ZXh0RnJvbSA9IDAsIHRleHRUbyA9IDA7XG4gICAgbGV0IHJlc3VsdDtcbiAgICB3aGlsZSAoKHJlc3VsdCA9IG1hdGhQYXR0ZXJuLmV4ZWMoc291cmNlKSkgIT09IG51bGwpIHtcbiAgICAgICAgY29uc3QgbWF0aFN0cmluZyA9IHJlc3VsdFsxXTtcbiAgICAgICAgdGV4dFRvID0gcmVzdWx0LmluZGV4O1xuICAgICAgICBpZiAodGV4dFRvID4gdGV4dEZyb20pIG1hdGhMaW5rRWwuY3JlYXRlU3BhbigpLnJlcGxhY2VXaXRoKHNvdXJjZS5zbGljZSh0ZXh0RnJvbSwgdGV4dFRvKSk7XG5cbiAgICAgICAgY29uc3QgbWF0aEVsID0gcmVuZGVyTWF0aChtYXRoU3RyaW5nLCBmYWxzZSk7XG4gICAgICAgIG1hdGhMaW5rRWwuY3JlYXRlU3Bhbih7IGNsczogW1wibWF0aFwiLCBcIm1hdGgtaW5saW5lXCIsIFwiaXMtbG9hZGVkXCJdIH0pLnJlcGxhY2VXaXRoKG1hdGhFbCk7XG4gICAgICAgIGZpbmlzaFJlbmRlck1hdGgoKTtcblxuICAgICAgICB0ZXh0RnJvbSA9IG1hdGhQYXR0ZXJuLmxhc3RJbmRleDtcbiAgICB9XG5cbiAgICBpZiAodGV4dEZyb20gPCBzb3VyY2UubGVuZ3RoKSBtYXRoTGlua0VsLmNyZWF0ZVNwYW4oKS5yZXBsYWNlV2l0aChzb3VyY2Uuc2xpY2UodGV4dEZyb20pKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldE1hdGhMaW5rKHBsdWdpbjogTWF0aExpbmtzLCB0YXJnZXRMaW5rOiBzdHJpbmcsIHNvdXJjZVBhdGg6IHN0cmluZywgaXNTb3VyY2VNb2RlPzogYm9vbGVhbik6IHN0cmluZyB7XG4gICAgbGV0IHsgcGF0aCwgc3VicGF0aCB9ID0gcGFyc2VMaW5rdGV4dCh0YXJnZXRMaW5rKTtcblxuICAgIGxldCBmaWxlID0gcGx1Z2luLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpcnN0TGlua3BhdGhEZXN0KHBhdGgsIHNvdXJjZVBhdGgpO1xuICAgIGlmICghZmlsZSkgcmV0dXJuIFwiXCI7XG5cbiAgICBsZXQgY2FjaGUgPSBwbHVnaW4uYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0RmlsZUNhY2hlKGZpbGUpO1xuICAgIGlmICghY2FjaGUpIHJldHVybiBcIlwiO1xuXG4gICAgbGV0IHN1YnBhdGhSZXN1bHQgPSByZXNvbHZlU3VicGF0aChjYWNoZSwgc3VicGF0aCk7XG5cbiAgICBjb25zdCBzb3VyY2VGaWxlID0gcGx1Z2luLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoc291cmNlUGF0aCk7XG4gICAgaWYgKCEoc291cmNlRmlsZSBpbnN0YW5jZW9mIFRGaWxlKSkge1xuICAgICAgICByZXR1cm4gXCJcIjtcbiAgICB9XG5cbiAgICByZXR1cm4gX2dldE1hdGhMaW5rKHBsdWdpbiwgcGF0aCwgc3VicGF0aCwgZmlsZSwgc3VicGF0aFJlc3VsdCwgc291cmNlRmlsZSwgaXNTb3VyY2VNb2RlKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIF9nZXRNYXRoTGluayhwbHVnaW46IE1hdGhMaW5rcywgcGF0aDogc3RyaW5nLCBzdWJwYXRoOiBzdHJpbmcsIHRhcmdldEZpbGU6IFRGaWxlIHwgbnVsbCwgc3VicGF0aFJlc3VsdDogSGVhZGluZ1N1YnBhdGhSZXN1bHQgfCBCbG9ja1N1YnBhdGhSZXN1bHQgfCBudWxsLCBzb3VyY2VGaWxlOiBURmlsZSB8IG51bGwsIGlzU291cmNlTW9kZT86IGJvb2xlYW4pIHtcbiAgICBsZXQgbWF0aExpbmsgPSBcIlwiO1xuICAgIHBsdWdpbi5pdGVyYXRlUHJvdmlkZXJzKChwcm92aWRlcikgPT4ge1xuICAgICAgICBpZiAoaXNTb3VyY2VNb2RlICYmICFwcm92aWRlci5lbmFibGVJblNvdXJjZU1vZGUpIHJldHVybjtcblxuICAgICAgICBjb25zdCBwcm92aWRlZCA9IHByb3ZpZGVyLnByb3ZpZGUoeyBwYXRoLCBzdWJwYXRoIH0sIHRhcmdldEZpbGUsIHN1YnBhdGhSZXN1bHQsIHNvdXJjZUZpbGUpO1xuICAgICAgICBpZiAocHJvdmlkZWQpIHtcbiAgICAgICAgICAgIGlmIChwcm92aWRlciBpbnN0YW5jZW9mIE5hdGl2ZVByb3ZpZGVyICYmIHN1YnBhdGhSZXN1bHQ/LnR5cGUgPT0gJ2hlYWRpbmcnKSB7XG4gICAgICAgICAgICAgICAgaWYgKG1hdGhMaW5rICYmIHByb3ZpZGVkID09IChwYXRoID8gcGF0aCArICcgPiAnIDogJycpICsgc3VicGF0aFJlc3VsdC5jdXJyZW50LmhlYWRpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1hdGhMaW5rID0gcHJvdmlkZWQ7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiBtYXRoTGluaztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldE1hdGhMaW5rRnJvbVN1YnBhdGgobGlua3BhdGg6IHN0cmluZywgc3VicGF0aFJlc3VsdDogSGVhZGluZ1N1YnBhdGhSZXN1bHQgfCBCbG9ja1N1YnBhdGhSZXN1bHQsIG1ldGFkYXRhOiBNYXRoTGlua3NNZXRhZGF0YSB8IHVuZGVmaW5lZCwgYmxvY2tQcmVmaXg6IHN0cmluZywgcHJlZml4OiBzdHJpbmcgfCBudWxsKTogc3RyaW5nIHtcbiAgICBsZXQgc3ViTWF0aExpbmsgPSBcIlwiXG4gICAgaWYgKHN1YnBhdGhSZXN1bHQudHlwZSA9PSBcImhlYWRpbmdcIikge1xuICAgICAgICBzdWJNYXRoTGluayA9IHN1YnBhdGhSZXN1bHQuY3VycmVudC5oZWFkaW5nO1xuICAgIH0gZWxzZSBpZiAoc3VicGF0aFJlc3VsdC50eXBlID09IFwiYmxvY2tcIiAmJiBtZXRhZGF0YT8uW1wibWF0aExpbmstYmxvY2tzXCJdPy5bc3VicGF0aFJlc3VsdC5ibG9jay5pZF0pIHtcbiAgICAgICAgc3ViTWF0aExpbmsgPSBibG9ja1ByZWZpeCArIG1ldGFkYXRhW1wibWF0aExpbmstYmxvY2tzXCJdW3N1YnBhdGhSZXN1bHQuYmxvY2suaWRdO1xuICAgIH1cbiAgICBpZiAoc3ViTWF0aExpbmspIHtcbiAgICAgICAgaWYgKHByZWZpeCA9PT0gbnVsbCkgeyAvLyB1c2Ugc3RhbmRhcmQgcHJlZml4XG4gICAgICAgICAgICBpZiAobGlua3BhdGgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKG1ldGFkYXRhPy5bXCJtYXRoTGlua1wiXSA/PyBsaW5rcGF0aCkgKyBcIiA+IFwiICsgc3ViTWF0aExpbms7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBzdWJNYXRoTGluaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHsgLy8gdHlwZW9mIHByZWZpeCA9PSAnc3RyaW5nJyA9PiB1c2UgY3VzdG9tIHByZWZpeCBcbiAgICAgICAgICAgIHJldHVybiBwcmVmaXggKyBzdWJNYXRoTGluaztcbiAgICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBcIlwiO1xuICAgIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldE1hdGhMaW5rRnJvbVRlbXBsYXRlcyhwbHVnaW46IE1hdGhMaW5rcywgZmlsZTogVEZpbGUpOiBzdHJpbmcge1xuICAgIGxldCB0ZW1wbGF0ZXMgPSBwbHVnaW4uc2V0dGluZ3MudGVtcGxhdGVzO1xuICAgIGxldCBtYXRoTGluayA9IGZpbGUubmFtZS5yZXBsYWNlKC9cXC5tZCQvLCBcIlwiKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRlbXBsYXRlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBsZXQgcmVwbGFjZWQgPSBuZXcgUmVnRXhwKHRlbXBsYXRlc1tpXS5yZXBsYWNlZCk7XG4gICAgICAgIGxldCByZXBsYWNlbWVudCA9IHRlbXBsYXRlc1tpXS5yZXBsYWNlbWVudDtcblxuICAgICAgICBsZXQgZmxhZ3MgPSBcIlwiO1xuICAgICAgICBpZiAodGVtcGxhdGVzW2ldLmdsb2JhbE1hdGNoKSBmbGFncyArPSBcImdcIjtcbiAgICAgICAgaWYgKCF0ZW1wbGF0ZXNbaV0uc2Vuc2l0aXZlKSBmbGFncyArPSBcImlcIjtcblxuICAgICAgICBpZiAodGVtcGxhdGVzW2ldLndvcmQpXG4gICAgICAgICAgICByZXBsYWNlZCA9IFJlZ0V4cChyZXBsYWNlZC5zb3VyY2UucmVwbGFjZSgvXi8sIFwiXFxcXGJcIikucmVwbGFjZSgvJC8sIFwiXFxcXGJcIiksIGZsYWdzKTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgcmVwbGFjZWQgPSBSZWdFeHAocmVwbGFjZWQuc291cmNlLCBmbGFncyk7XG5cbiAgICAgICAgbWF0aExpbmsgPSBtYXRoTGluay5yZXBsYWNlKHJlcGxhY2VkLCByZXBsYWNlbWVudCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG1hdGhMaW5rO1xufVxuIiwgImltcG9ydCB7IFRGaWxlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgTWF0aExpbmtzIGZyb20gXCIuLi9tYWluXCI7XG5cbmV4cG9ydCBmdW5jdGlvbiBhZGRTdXBlckNoYXJnZWQocGx1Z2luOiBNYXRoTGlua3MsIHNwYW46IEhUTUxFbGVtZW50LCBvdXRMaW5rRmlsZTogVEZpbGUpOiB2b2lkIHtcbiAgICBpZiAob3V0TGlua0ZpbGUgJiYgcGx1Z2luLmFwcC5wbHVnaW5zLmVuYWJsZWRQbHVnaW5zLmhhcyhcInN1cGVyY2hhcmdlZC1saW5rcy1vYnNpZGlhblwiKSkge1xuICAgICAgICBsZXQgc3VwZXJDaGFyZ2VkID0gZ2V0U3VwZXJDaGFyZ2VkKHBsdWdpbiwgb3V0TGlua0ZpbGUpO1xuICAgICAgICBzcGFuLmNsYXNzTGlzdC5hZGQoXCJkYXRhLWxpbmstaWNvblwiKTtcbiAgICAgICAgc3Bhbi5jbGFzc0xpc3QuYWRkKFwiZGF0YS1saW5rLWljb24tYWZ0ZXJcIik7XG4gICAgICAgIHNwYW4uY2xhc3NMaXN0LmFkZChcImRhdGEtbGluay10ZXh0XCIpO1xuICAgICAgICBzcGFuLnNldEF0dHJpYnV0ZShcImRhdGEtbGluay1wYXRoXCIsIG91dExpbmtGaWxlLnBhdGgpO1xuICAgICAgICBzcGFuLnNldEF0dHJpYnV0ZShcImRhdGEtbGluay10YWdzXCIsIHN1cGVyQ2hhcmdlZFswXSk7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3VwZXJDaGFyZ2VkWzFdLmxlbmd0aDsgaSsrKVxuICAgICAgICAgICAgc3Bhbi5zZXRBdHRyaWJ1dGUoXCJkYXRhLWxpbmstXCIgKyBzdXBlckNoYXJnZWRbMV1baV1bMF0sIHN1cGVyQ2hhcmdlZFsxXVtpXVsxXSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBnZXRTdXBlckNoYXJnZWQocGx1Z2luOiBNYXRoTGlua3MsIGZpbGU6IFRGaWxlKTogW3N0cmluZywgW3N0cmluZywgc3RyaW5nXVtdXSB7XG4gICAgY29uc3QgZGF0YSA9IHBsdWdpbi5hcHAucGx1Z2lucy5wbHVnaW5zW1wic3VwZXJjaGFyZ2VkLWxpbmtzLW9ic2lkaWFuXCJdPy5zZXR0aW5ncztcblxuICAgIGxldCB0YWdBcnIgPSBwbHVnaW4uYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0RmlsZUNhY2hlKGZpbGUpPy50YWdzO1xuICAgIGxldCB0YWdzOiBzdHJpbmcgPSBcIlwiO1xuICAgIGlmICh0YWdBcnIpIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0YWdBcnIubGVuZ3RoOyBpKyspXG4gICAgICAgICAgICB0YWdzICs9IHRhZ0FycltpXS50YWcucmVwbGFjZSgvIy8sIFwiXCIpICsgXCIgXCI7XG4gICAgICAgIHRhZ3MgPSB0YWdzLnRyaW1FbmQoKTtcbiAgICB9XG5cbiAgICBsZXQgYXR0cmlidXRlczogW3N0cmluZywgc3RyaW5nXVtdID0gW107XG4gICAgbGV0IGZyb250bWF0dGVyID0gcGx1Z2luLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZShmaWxlKT8uZnJvbnRtYXR0ZXI7XG4gICAgaWYgKGRhdGEpIHtcbiAgICAgICAgZm9yIChsZXQgYXR0ciBpbiBmcm9udG1hdHRlcikge1xuICAgICAgICAgICAgaWYgKGF0dHIgIT0gXCJtYXRoTGlua1wiICYmIGF0dHIgIT0gXCJwb3NpdGlvblwiKSB7XG4gICAgICAgICAgICAgICAgbGV0IHNlbGVjdG9ycyA9IGRhdGEuc2VsZWN0b3JzO1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2VsZWN0b3JzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzZWxlY3RvcnNbaV0ubmFtZSA9PSBhdHRyICYmIHNlbGVjdG9yc1tpXS52YWx1ZSA9PSBmcm9udG1hdHRlclthdHRyXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlcy5wdXNoKFthdHRyLCBmcm9udG1hdHRlclthdHRyXV0pO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNlbGVjdG9yc1tpXS50eXBlID09IFwidGFnXCIgJiYgc2VsZWN0b3JzW2ldLnZhbHVlID09IGZyb250bWF0dGVyW2F0dHJdICYmIGRhdGEudGFyZ2V0VGFncykge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlcy5wdXNoKFthdHRyLCBmcm9udG1hdHRlclthdHRyXV0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIFt0YWdzLCBhdHRyaWJ1dGVzXTtcbn1cbiIsICJleHBvcnQgaW50ZXJmYWNlIE1hdGhMaW5rc1NldHRpbmdzIHtcbiAgICB0ZW1wbGF0ZXM6IFRlbXBsYXRlW107XG4gICAgZXhjbHVkZWRQYXRoczogc3RyaW5nW107XG4gICAgYmxvY2tQcmVmaXg6IHN0cmluZztcbiAgICBlbmFibGVGaWxlTmFtZUJsb2NrTGlua3M6IGJvb2xlYW47XG4gICAgZW5hYmxlSW5Tb3VyY2VNb2RlOiBib29sZWFuO1xuICAgIHJlbmRlck91dGxpbmU6IGJvb2xlYW47XG59XG5cbmV4cG9ydCB0eXBlIFRlbXBsYXRlID0ge1xuICAgIHJlcGxhY2VkOiBzdHJpbmc7XG4gICAgcmVwbGFjZW1lbnQ6IHN0cmluZztcbiAgICBnbG9iYWxNYXRjaDogYm9vbGVhbjtcbiAgICBzZW5zaXRpdmU6IGJvb2xlYW47XG4gICAgd29yZDogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGNvbnN0IERFRkFVTFRfU0VUVElOR1M6IE1hdGhMaW5rc1NldHRpbmdzID0ge1xuICAgIHRlbXBsYXRlczogW10sXG4gICAgZXhjbHVkZWRQYXRoczogW10sXG4gICAgYmxvY2tQcmVmaXg6IFwiXlwiLFxuICAgIGVuYWJsZUZpbGVOYW1lQmxvY2tMaW5rczogdHJ1ZSxcbiAgICBlbmFibGVJblNvdXJjZU1vZGU6IGZhbHNlLFxuICAgIHJlbmRlck91dGxpbmU6IHRydWUsXG59XG4iLCAiaW1wb3J0IHsgU2V0dGluZywgUGx1Z2luU2V0dGluZ1RhYiwgQXBwIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBUZXh0Q29tcG9uZW50LCBUb2dnbGVDb21wb25lbnQsIEJ1dHRvbkNvbXBvbmVudCB9IGZyb20gXCJvYnNpZGlhblwiXG5pbXBvcnQgeyBUZW1wbGF0ZXNNb2RhbCwgRXhjbHVkZU1vZGFsIH0gZnJvbSBcIi4vbW9kYWxzXCJcbmltcG9ydCBNYXRoTGlua3MgZnJvbSBcIi4uL21haW5cIlxuXG5leHBvcnQgY2xhc3MgTWF0aExpbmtzU2V0dGluZ1RhYiBleHRlbmRzIFBsdWdpblNldHRpbmdUYWIge1xuICAgIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwdWJsaWMgcGx1Z2luOiBNYXRoTGlua3MpIHtcbiAgICAgICAgc3VwZXIoYXBwLCBwbHVnaW4pO1xuICAgIH1cblxuICAgIGFzeW5jIGRpc3BsYXkoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGNvbnN0IHsgY29udGFpbmVyRWwgfSA9IHRoaXM7XG5cbiAgICAgICAgY29udGFpbmVyRWwuZW1wdHkoKTtcbiAgICAgICAgY29udGFpbmVyRWwuY3JlYXRlRWwoXCJoMlwiLCB7IHRleHQ6IFwiTWF0aExpbmtzIFNldHRpbmdzXCIgfSk7XG5cbiAgICAgICAgLy8gVGVtcGxhdGVzXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoXCJUZW1wbGF0ZXNcIilcbiAgICAgICAgICAgIC5zZXREZXNjKFxuICAgICAgICAgICAgICAgIGNyZWF0ZUZyYWdtZW50KChlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGUuY3JlYXRlU3Bhbih7IHRleHQ6IFwiR2VuZXJhdGUgbWF0aExpbmtzIHdpdGggYSB0ZW1wbGF0ZS4gVXNlIFwiIH0pO1xuICAgICAgICAgICAgICAgICAgICBlLmNyZWF0ZUVsKFwiY29kZVwiLCB7IHRleHQ6IFwibWF0aExpbms6IGF1dG9cIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgZS5jcmVhdGVTcGFuKHsgdGV4dDogXCIgdG8gdXNlIHRlbXBsYXRlcyBpbiBhIGZpbGUuXCIgfSk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIC5hZGRCdXR0b24oKGJ1dHRvbjogQnV0dG9uQ29tcG9uZW50KTogQnV0dG9uQ29tcG9uZW50ID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYnV0dG9uLnNldEJ1dHRvblRleHQoXCJNYW5hZ2VcIikub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBtb2RhbCA9IG5ldyBUZW1wbGF0ZXNNb2RhbCh0aGlzLmFwcCwgdGhpcy5wbHVnaW4pO1xuICAgICAgICAgICAgICAgICAgICBtb2RhbC5vcGVuKCk7XG4gICAgICAgICAgICAgICAgICAgIG1vZGFsLm9uQ2xvc2UgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc3BsYXkoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gRXhjbHVkZWQgZmlsZXNcbiAgICAgICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAgICAgICAuc2V0TmFtZShcIkV4Y2x1ZGVkIGZpbGVzXCIpXG4gICAgICAgICAgICAuc2V0RGVzYyhcIk1hbmFnZSBmaWxlcy9wYXRocyB0aGF0IE1hdGhMaW5rcyB3aWxsIGlnbm9yZS5cIilcbiAgICAgICAgICAgIC5hZGRCdXR0b24oKGJ1dHRvbjogQnV0dG9uQ29tcG9uZW50KTogQnV0dG9uQ29tcG9uZW50ID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gYnV0dG9uLnNldEJ1dHRvblRleHQoXCJNYW5hZ2VcIikub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBtb2RhbCA9IG5ldyBFeGNsdWRlTW9kYWwodGhpcy5hcHAsIHRoaXMucGx1Z2luKTtcbiAgICAgICAgICAgICAgICAgICAgbW9kYWwub3BlbigpO1xuICAgICAgICAgICAgICAgICAgICBtb2RhbC5vbkNsb3NlID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXNwbGF5KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEJsb2NrIGxpbmtzXG4gICAgICAgIGxldCBwcmVmaXg6IFRleHRDb21wb25lbnQ7XG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoXCJFZGl0IHByZWZpeCBmb3IgYmxvY2sgbGlua3NcIilcbiAgICAgICAgICAgIC5zZXREZXNjKFxuICAgICAgICAgICAgICAgIGNyZWF0ZUZyYWdtZW50KChlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGUuY3JlYXRlU3Bhbih7IHRleHQ6IFwiTGlua3MgbGlrZSBcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgZS5jcmVhdGVFbChcImNvZGVcIiwgeyB0ZXh0OiBcIm5vdGUjXmJsb2NrLWlkXCIgfSk7XG4gICAgICAgICAgICAgICAgICAgIGUuY3JlYXRlU3Bhbih7IHRleHQ6IFwiIHdpbGwgYmUgcmVuZGVyZWQgYXNcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZUZpbGVOYW1lQmxvY2tMaW5rcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5jcmVhdGVFbChcImNvZGVcIiwgeyB0ZXh0OiBcIm5vdGUgPiBcIiArIHRoaXMucGx1Z2luLnNldHRpbmdzLmJsb2NrUHJlZml4ICsgXCJibG9jay1pZFwiIH0pO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5jcmVhdGVFbChcImNvZGVcIiwgeyB0ZXh0OiB0aGlzLnBsdWdpbi5zZXR0aW5ncy5ibG9ja1ByZWZpeCArIFwiYmxvY2staWRcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlLmNyZWF0ZVNwYW4oeyB0ZXh0OiBcIi5cIiB9KTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLmFkZFRleHQoKHRleHQpID0+IHtcbiAgICAgICAgICAgICAgICBwcmVmaXggPSB0ZXh0O1xuICAgICAgICAgICAgICAgIHByZWZpeC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5ibG9ja1ByZWZpeCkub25DaGFuZ2UoYXN5bmMgKGN1cnJlbnQ6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5ibG9ja1ByZWZpeCA9IGN1cnJlbnQ7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHByZWZpeC5zZXRQbGFjZWhvbGRlcihcIk5vIHByZWZpeCAoZGVmYXVsdDogXilcIik7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlOiBUb2dnbGVDb21wb25lbnQpID0+IHtcbiAgICAgICAgICAgICAgICB0b2dnbGUuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuZW5hYmxlRmlsZU5hbWVCbG9ja0xpbmtzKVxuICAgICAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlOiBib29sZWFuKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5lbmFibGVGaWxlTmFtZUJsb2NrTGlua3MgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzcGxheSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRvZ2dsZS5zZXRUb29sdGlwKFwiRGlzYWJsZSB0byBpZ25vcmUgbm90ZSBuYW1lLlwiKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFNvdXJjZSBtb2RlXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoXCJFbmFibGUgaW4gU291cmNlIG1vZGVcIilcbiAgICAgICAgICAgIC5zZXREZXNjKFwiQ3VycmVudGx5LCBvbmx5IHdpa2lsaW5rcyBhcmUgc3VwcG9ydGVkIGluIFNvdXJjZSBtb2RlLlwiKVxuICAgICAgICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlOiBUb2dnbGVDb21wb25lbnQpID0+IHtcbiAgICAgICAgICAgICAgICB0b2dnbGUuc2V0VmFsdWUodGhpcy5wbHVnaW4ubmF0aXZlUHJvdmlkZXIuZW5hYmxlSW5Tb3VyY2VNb2RlKVxuICAgICAgICAgICAgICAgICAgICAub25DaGFuZ2UoKHZhbHVlOiBib29sZWFuKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5uYXRpdmVQcm92aWRlci5lbmFibGVJblNvdXJjZU1vZGUgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAvLyBPdXRsaW5lXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoXCJSZW5kZXIgTWF0aEpheCBpbiBPdXRsaW5lXCIpXG4gICAgICAgICAgICAuc2V0RGVzYyhcIlJlbmRlciBoZWFkaW5ncyB3aXRoIE1hdGhKYXggaW4gdGhlIGNvcmUgT3V0bGluZSB2aWV3LiBZb3UgbmVlZCB0byByZWxvYWQgdGhlIGFwcCBmb3IgdGhpcyBvcHRpb24gdG8gdGFrZSBlZmZlY3QuXCIpXG4gICAgICAgICAgICAuYWRkVG9nZ2xlKCh0b2dnbGU6IFRvZ2dsZUNvbXBvbmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHRvZ2dsZS5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5yZW5kZXJPdXRsaW5lKVxuICAgICAgICAgICAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlOiBib29sZWFuKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5yZW5kZXJPdXRsaW5lID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG59XG4iLCAiaW1wb3J0IHsgU2V0dGluZywgTW9kYWwsIE5vdGljZSwgVEZpbGUsIFRBYnN0cmFjdEZpbGUsIFRGb2xkZXIsIEZ1enp5U3VnZ2VzdE1vZGFsLCBBcHAgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IFRleHRDb21wb25lbnQsIEV4dHJhQnV0dG9uQ29tcG9uZW50IH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBUZW1wbGF0ZSB9IGZyb20gXCIuL3NldHRpbmdzXCI7XG5pbXBvcnQgeyBpc0VxdWFsVG9PckNoaWxkT2YgfSBmcm9tIFwiLi4vdXRpbHNcIjtcbmltcG9ydCBNYXRoTGlua3MgZnJvbSBcIi4uL21haW5cIlxuXG5leHBvcnQgY2xhc3MgVGVtcGxhdGVzTW9kYWwgZXh0ZW5kcyBNb2RhbCB7XG4gICAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHB1YmxpYyBwbHVnaW46IE1hdGhMaW5rcykge1xuICAgICAgICBzdXBlcihhcHApO1xuICAgIH1cblxuICAgIG9uT3BlbigpIHtcbiAgICAgICAgdGhpcy5kaXNwbGF5KCk7XG4gICAgfVxuXG4gICAgLy8gQ3JlZGl0cyB0byBSeW90YVVzaGlvL29ic2lkaWFuLW1hdGgtYm9vc3RlclxuICAgIGFzeW5jIGRpc3BsYXkoKSB7XG4gICAgICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgICAgICBjb250ZW50RWwuZW1wdHkoKTtcbiAgICAgICAgY29udGVudEVsLmNyZWF0ZUVsKFwiaDRcIiwgeyB0ZXh0OiBcIkFkZC9FZGl0IFRlbXBsYXRlc1wiIH0pO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRlbnRFbClcbiAgICAgICAgICAgIC5zZXROYW1lKFxuICAgICAgICAgICAgICAgIGNyZWF0ZUZyYWdtZW50KChlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGUuY3JlYXRlU3Bhbih7IHRleHQ6IFwiVGhlIHRlbXBsYXRlcyBpbiB0aGUgbGlzdCBiZWxvdyBhcmUgc29ydGVkIGJ5IHByZWNlZGVuY2UsIHdpdGggdGhlIHRvcCBiZWluZyByZXBsYWNlZCBmaXJzdC4gTm90ZSB0aGF0IFwiIH0pO1xuICAgICAgICAgICAgICAgICAgICBlLmNyZWF0ZUVsKFwiY29kZVwiLCB7IHRleHQ6IFwiYVwiIH0pO1xuICAgICAgICAgICAgICAgICAgICBlLmNyZWF0ZVNwYW4oeyB0ZXh0OiBcIiA+IFwiIH0pO1xuICAgICAgICAgICAgICAgICAgICBlLmNyZWF0ZUVsKFwiY29kZVwiLCB7IHRleHQ6IFwiYlwiIH0pO1xuICAgICAgICAgICAgICAgICAgICBlLmNyZWF0ZVNwYW4oeyB0ZXh0OiBcIiBmb2xsb3dlZCBieSBcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgZS5jcmVhdGVFbChcImNvZGVcIiwgeyB0ZXh0OiBcImJcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgZS5jcmVhdGVTcGFuKHsgdGV4dDogXCIgPiBcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgZS5jcmVhdGVFbChcImNvZGVcIiwgeyB0ZXh0OiBcImNcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgZS5jcmVhdGVTcGFuKHsgdGV4dDogXCIgdG9nZXRoZXIgaXMgZXF1aXZhbGVudCB0byBcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgZS5jcmVhdGVFbChcImNvZGVcIiwgeyB0ZXh0OiBcImFcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgZS5jcmVhdGVTcGFuKHsgdGV4dDogXCIgPiBcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgZS5jcmVhdGVFbChcImNvZGVcIiwgeyB0ZXh0OiBcImNcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgZS5jcmVhdGVTcGFuKHsgdGV4dDogXCIsIGJ1dCBub3QgdGhlIG90aGVyIHdheSBhcm91bmQuXCIgfSk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIC5hZGRCdXR0b24oKGJ0bikgPT4ge1xuICAgICAgICAgICAgICAgIGJ0bi5zZXRUb29sdGlwKFwiQWRkXCIpLnNldEljb24oXCJwbHVzXCIpXG4gICAgICAgICAgICAgICAgICAgIC5vbkNsaWNrKChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG5ld1RlbXBsYXRlOiBUZW1wbGF0ZSA9IHsgcmVwbGFjZWQ6IFwiXCIsIHJlcGxhY2VtZW50OiBcIlwiLCBnbG9iYWxNYXRjaDogdHJ1ZSwgc2Vuc2l0aXZlOiB0cnVlLCB3b3JkOiB0cnVlIH07XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgVGVtcGxhdGVTZXR0aW5nc01vZGFsKHRoaXMuYXBwLCB0aGlzLnBsdWdpbiwgdGhpcywgbmV3VGVtcGxhdGUsIHRydWUpLm9wZW4oKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICBpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3MudGVtcGxhdGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgbGV0IGxpc3QgPSBjb250ZW50RWwuY3JlYXRlRWwoXCJ1bFwiKTtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wbHVnaW4uc2V0dGluZ3MudGVtcGxhdGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgbGV0IHRlbXBsYXRlID0gdGhpcy5wbHVnaW4uc2V0dGluZ3MudGVtcGxhdGVzW2ldO1xuICAgICAgICAgICAgICAgIGxldCBpdGVtID0gbGlzdC5jcmVhdGVFbChcImxpXCIpLmNyZWF0ZURpdigpO1xuXG4gICAgICAgICAgICAgICAgbmV3IFNldHRpbmcoaXRlbSlcbiAgICAgICAgICAgICAgICAgICAgLnNldE5hbWUoXG4gICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVGcmFnbWVudCgoZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuY3JlYXRlRWwoXCJjb2RlXCIsIHsgdGV4dDogdGVtcGxhdGUucmVwbGFjZWQgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5jcmVhdGVTcGFuKHsgdGV4dDogXCIgPiBcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLmNyZWF0ZUVsKFwiY29kZVwiLCB7IHRleHQ6IHRlbXBsYXRlLnJlcGxhY2VtZW50IH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAuYWRkRXh0cmFCdXR0b24oKGJ1dHRvbjogRXh0cmFCdXR0b25Db21wb25lbnQpOiBFeHRyYUJ1dHRvbkNvbXBvbmVudCA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYnV0dG9uLnNldFRvb2x0aXAoXCJNb3ZlIHVwXCIpLnNldEljb24oXCJ1cC1hcnJvdy13aXRoLXRhaWxcIikub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkgIT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZG93biA9IHsuLi50ZW1wbGF0ZX07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCB1cCA9IHRoaXMucGx1Z2luLnNldHRpbmdzLnRlbXBsYXRlc1tpIC0gMV07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MudGVtcGxhdGVzW2ldID0gdXA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnRlbXBsYXRlc1tpIC0gMV0gPSBkb3duO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzcGxheSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmFkZEV4dHJhQnV0dG9uKChidXR0b246IEV4dHJhQnV0dG9uQ29tcG9uZW50KTogRXh0cmFCdXR0b25Db21wb25lbnQgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJ1dHRvbi5zZXRUb29sdGlwKFwiTW92ZSBkb3duXCIpLnNldEljb24oXCJkb3duLWFycm93LXdpdGgtdGFpbFwiKS5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSAhPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy50ZW1wbGF0ZXMubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgdXAgPSB7Li4udGVtcGxhdGV9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZG93biA9IHRoaXMucGx1Z2luLnNldHRpbmdzLnRlbXBsYXRlc1tpICsgMV07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MudGVtcGxhdGVzW2ldID0gZG93bjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MudGVtcGxhdGVzW2krMV0gPSB1cDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc3BsYXkoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5hZGRFeHRyYUJ1dHRvbigoYnV0dG9uOiBFeHRyYUJ1dHRvbkNvbXBvbmVudCk6IEV4dHJhQnV0dG9uQ29tcG9uZW50ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBidXR0b24uc2V0VG9vbHRpcChcIkVkaXRcIikuc2V0SWNvbihcImVkaXRcIikub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG1vZGFsID0gbmV3IFRlbXBsYXRlU2V0dGluZ3NNb2RhbCh0aGlzLmFwcCwgdGhpcy5wbHVnaW4sIHRoaXMsIHRlbXBsYXRlLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWwub3BlbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGFsLm9uQ2xvc2UgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXNwbGF5KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmFkZEV4dHJhQnV0dG9uKChidXR0b246IEV4dHJhQnV0dG9uQ29tcG9uZW50KTogRXh0cmFCdXR0b25Db21wb25lbnQgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJ1dHRvbi5zZXRUb29sdGlwKFwiUmVtb3ZlXCIpLnNldEljb24oXCJ4XCIpLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnRlbXBsYXRlcy5yZW1vdmUodGVtcGxhdGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc3BsYXkoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cblxuY2xhc3MgVGVtcGxhdGVTZXR0aW5nc01vZGFsIGV4dGVuZHMgTW9kYWwge1xuICAgIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwdWJsaWMgcGx1Z2luOiBNYXRoTGlua3MsIHB1YmxpYyBtb2RhbDogVGVtcGxhdGVzTW9kYWwsIHB1YmxpYyB0ZW1wbGF0ZTogVGVtcGxhdGUsIHB1YmxpYyBjcmVhdGU6IGJvb2xlYW4pIHtcbiAgICAgICAgc3VwZXIoYXBwKTtcbiAgICB9XG5cbiAgICBvbk9wZW4oKSB7XG4gICAgICAgIHRoaXMuZGlzcGxheSgpO1xuICAgIH1cblxuICAgIGFzeW5jIGRpc3BsYXkoKSB7XG4gICAgICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgICAgICBjb250ZW50RWwuZW1wdHkoKTtcblxuICAgICAgICBsZXQgcmVwbGFjZWRUZXh0OiBUZXh0Q29tcG9uZW50O1xuICAgICAgICBuZXcgU2V0dGluZyhjb250ZW50RWwpXG4gICAgICAgICAgICAuc2V0TmFtZShcIk1hdGNoIGZvci4uLlwiKVxuICAgICAgICAgICAgLnNldERlc2MoXCJTdHJpbmcgdG8gYmUgbWF0Y2hlZCBhbmQgcmVwbGFjZWQuIERvIG5vdCBpbmNsdWRlIHJlZ2V4LlwiKVxuICAgICAgICAgICAgLmFkZFRleHQoKHRleHQpID0+IHtcbiAgICAgICAgICAgICAgICByZXBsYWNlZFRleHQgPSB0ZXh0O1xuICAgICAgICAgICAgICAgIHJlcGxhY2VkVGV4dC5zZXRWYWx1ZSh0aGlzLnRlbXBsYXRlLnJlcGxhY2VkKS5vbkNoYW5nZSgoY3VycmVudCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRlbXBsYXRlLnJlcGxhY2VkID0gY3VycmVudDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIGxldCByZXBsYWNlbWVudFRleHQ6IFRleHRDb21wb25lbnQ7XG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRlbnRFbClcbiAgICAgICAgICAgIC5zZXROYW1lKFwiUmVwbGFjZSB3aXRoLi4uXCIpXG4gICAgICAgICAgICAuc2V0RGVzYyhcIlN0cmluZyB0byByZXBsYWNlIG1hdGNoZXMuIERvIG5vdCBlc2NhcGUgYmFja3NsYXNoZXMuXCIpXG4gICAgICAgICAgICAuYWRkVGV4dCgodGV4dCkgPT4ge1xuICAgICAgICAgICAgICAgIHJlcGxhY2VtZW50VGV4dCA9IHRleHQ7XG4gICAgICAgICAgICAgICAgcmVwbGFjZW1lbnRUZXh0LnNldFZhbHVlKHRoaXMudGVtcGxhdGUucmVwbGFjZW1lbnQpLm9uQ2hhbmdlKChjdXJyZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGVtcGxhdGUucmVwbGFjZW1lbnQgPSBjdXJyZW50O1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgbmV3IFNldHRpbmcoY29udGVudEVsKVxuICAgICAgICAgICAgLnNldE5hbWUoXCJHbG9iYWwgbWF0Y2hcIilcbiAgICAgICAgICAgIC5zZXREZXNjKFwiTWF0Y2ggYWxsIGluc3RhbmNlcyAoaW5zdGVhZCBvZiBqdXN0IHRoZSBmaXJzdCkuXCIpXG4gICAgICAgICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+IHtcbiAgICAgICAgICAgICAgICB0b2dnbGUuc2V0VmFsdWUodGhpcy50ZW1wbGF0ZS5nbG9iYWxNYXRjaCkub25DaGFuZ2UoKGN1cnJlbnQpID0+ICh0aGlzLnRlbXBsYXRlLmdsb2JhbE1hdGNoID0gY3VycmVudCkpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgbmV3IFNldHRpbmcoY29udGVudEVsKVxuICAgICAgICAgICAgLnNldE5hbWUoXCJDYXNlIHNlbnNpdGl2ZVwiKVxuICAgICAgICAgICAgLnNldERlc2MoXCJNYXRjaGVzIHdpbGwgYmUgY2FzZSBzZW5zaXRpdmUuXCIpXG4gICAgICAgICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+IHtcbiAgICAgICAgICAgICAgICB0b2dnbGUuc2V0VmFsdWUodGhpcy50ZW1wbGF0ZS5zZW5zaXRpdmUpLm9uQ2hhbmdlKChjdXJyZW50KSA9PiAodGhpcy50ZW1wbGF0ZS5zZW5zaXRpdmUgPSBjdXJyZW50KSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICBuZXcgU2V0dGluZyhjb250ZW50RWwpXG4gICAgICAgICAgICAuc2V0TmFtZShcIk1hdGNoIHdob2xlIHdvcmRzXCIpXG4gICAgICAgICAgICAuc2V0RGVzYyhcIk9ubHkgbWF0Y2ggd2hvbGUgd29yZHMuXCIpXG4gICAgICAgICAgICAuYWRkVG9nZ2xlKCh0b2dnbGUpID0+IHtcbiAgICAgICAgICAgICAgICB0b2dnbGUuc2V0VmFsdWUodGhpcy50ZW1wbGF0ZS53b3JkKS5vbkNoYW5nZSgoY3VycmVudCkgPT4gKHRoaXMudGVtcGxhdGUud29yZCA9IGN1cnJlbnQpKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRlbnRFbClcbiAgICAgICAgICAgIC5hZGRCdXR0b24oKGIpID0+IHtcbiAgICAgICAgICAgICAgICBiLnNldFRvb2x0aXAodGhpcy5jcmVhdGUgPyBcIkFkZFwiIDogXCJTYXZlXCIpLnNldEljb24oXCJjaGVja21hcmtcIikub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnRlbXBsYXRlLnJlcGxhY2VkID09IFwiXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBOb3RpY2UoXCJNYXRoTGlua3M6IFBsZWFzZSBlbnRlciBhIG5vbi1lbXB0eSBzdHJpbmcgdG8gYmUgcmVwbGFjZWRcIik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jcmVhdGUpIHRoaXMucGx1Z2luLnNldHRpbmdzLnRlbXBsYXRlcy5wdXNoKHRoaXMudGVtcGxhdGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kYWwuZGlzcGxheSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuYWRkRXh0cmFCdXR0b24oKGI6IEV4dHJhQnV0dG9uQ29tcG9uZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgYi5zZXRUb29sdGlwKFwiQ2FuY2VsXCIpLnNldEljb24oXCJjcm9zc1wiKS5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxufVxuXG5leHBvcnQgY2xhc3MgRXhjbHVkZU1vZGFsIGV4dGVuZHMgTW9kYWwge1xuICAgIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwdWJsaWMgcGx1Z2luOiBNYXRoTGlua3MpIHtcbiAgICAgICAgc3VwZXIoYXBwKTtcbiAgICB9XG5cbiAgICBvbk9wZW4oKSB7XG4gICAgICAgIHRoaXMuZGlzcGxheSgpO1xuICAgIH1cblxuICAgIC8vIENyZWRpdHMgdG8gUnlvdGFVc2hpby9vYnNpZGlhbi1tYXRoLWJvb3N0ZXJcbiAgICBhc3luYyBkaXNwbGF5KCkge1xuICAgICAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICAgICAgY29udGVudEVsLmVtcHR5KCk7XG4gICAgICAgIGNvbnRlbnRFbC5jcmVhdGVFbChcImg0XCIsIHsgdGV4dDogXCJFeGNsdWRlZCBmaWxlc1wiIH0pO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRlbnRFbClcbiAgICAgICAgICAgIC5zZXROYW1lKFwiVGhlIGZpbGVzL2ZvbGRlcnMgaW4gdGhpcyBsaXN0IHdpbGwgYmUgaWdub3JlZCBieSBNYXRoTGlua3MuXCIpXG4gICAgICAgICAgICAuYWRkQnV0dG9uKChidG4pID0+IHtcbiAgICAgICAgICAgICAgICBidG4uc2V0VG9vbHRpcChcIkFkZFwiKS5zZXRJY29uKFwicGx1c1wiKVxuICAgICAgICAgICAgICAgICAgICAub25DbGljaygoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBGaWxlRXhjbHVkZVN1Z2dlc3RNb2RhbCh0aGlzLmFwcCwgdGhpcy5wbHVnaW4sIHRoaXMpLm9wZW4oKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICBpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3MuZXhjbHVkZWRQYXRocy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGxldCBsaXN0ID0gY29udGVudEVsLmNyZWF0ZUVsKFwidWxcIik7XG4gICAgICAgICAgICBmb3IgKGxldCBwYXRoIG9mIHRoaXMucGx1Z2luLnNldHRpbmdzLmV4Y2x1ZGVkUGF0aHMpIHtcbiAgICAgICAgICAgICAgICBsZXQgaXRlbSA9IGxpc3QuY3JlYXRlRWwoXCJsaVwiKS5jcmVhdGVEaXYoKTtcbiAgICAgICAgICAgICAgICBuZXcgU2V0dGluZyhpdGVtKS5zZXROYW1lKHBhdGgpLmFkZEV4dHJhQnV0dG9uKChidXR0b246IEV4dHJhQnV0dG9uQ29tcG9uZW50KTogRXh0cmFCdXR0b25Db21wb25lbnQgPT4ge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYnV0dG9uLnNldFRvb2x0aXAoXCJSZW1vdmVcIikuc2V0SWNvbihcInhcIikub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5leGNsdWRlZFBhdGhzLnJlbW92ZShwYXRoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzcGxheSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuXG5hYnN0cmFjdCBjbGFzcyBGaWxlU3VnZ2VzdE1vZGFsIGV4dGVuZHMgRnV6enlTdWdnZXN0TW9kYWw8VEFic3RyYWN0RmlsZT4ge1xuICAgIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwdWJsaWMgcGx1Z2luOiBNYXRoTGlua3MpIHtcbiAgICAgICAgc3VwZXIoYXBwKTtcbiAgICB9XG5cbiAgICBnZXRJdGVtcygpOiBUQWJzdHJhY3RGaWxlW10ge1xuICAgICAgICByZXR1cm4gdGhpcy5hcHAudmF1bHQuZ2V0QWxsTG9hZGVkRmlsZXMoKS5maWx0ZXIodGhpcy5maWx0ZXJDYWxsYmFjay5iaW5kKHRoaXMpKTtcbiAgICB9XG5cbiAgICBnZXRJdGVtVGV4dChmaWxlOiBUQWJzdHJhY3RGaWxlKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIGZpbGUucGF0aDtcbiAgICB9XG5cbiAgICBmaWx0ZXJDYWxsYmFjayhhYnN0cmFjdEZpbGU6IFRBYnN0cmFjdEZpbGUpOiBib29sZWFuIHtcbiAgICAgICAgaWYgKGFic3RyYWN0RmlsZSBpbnN0YW5jZW9mIFRGaWxlICYmIGFic3RyYWN0RmlsZS5leHRlbnNpb24gIT0gXCJtZFwiKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIGlmIChhYnN0cmFjdEZpbGUgaW5zdGFuY2VvZiBURm9sZGVyICYmIGFic3RyYWN0RmlsZS5pc1Jvb3QoKSkgcmV0dXJuIGZhbHNlO1xuXG4gICAgICAgIGZvciAoY29uc3QgcGF0aCBvZiB0aGlzLnBsdWdpbi5zZXR0aW5ncy5leGNsdWRlZFBhdGhzKSB7XG4gICAgICAgICAgICBjb25zdCBmaWxlID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKHBhdGgpXG4gICAgICAgICAgICBpZiAoZmlsZSAmJiBpc0VxdWFsVG9PckNoaWxkT2YoYWJzdHJhY3RGaWxlLCBmaWxlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxufVxuXG5jbGFzcyBGaWxlRXhjbHVkZVN1Z2dlc3RNb2RhbCBleHRlbmRzIEZpbGVTdWdnZXN0TW9kYWwge1xuICAgIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwbHVnaW46IE1hdGhMaW5rcywgcHVibGljIG1vZGFsOiBFeGNsdWRlTW9kYWwpIHtcbiAgICAgICAgc3VwZXIoYXBwLCBwbHVnaW4pO1xuICAgIH1cblxuICAgIGFzeW5jIG9uQ2hvb3NlSXRlbShmaWxlOiBUQWJzdHJhY3RGaWxlLCBldnQ6IE1vdXNlRXZlbnQgfCBLZXlib2FyZEV2ZW50KSB7XG4gICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmV4Y2x1ZGVkUGF0aHMucHVzaChmaWxlLnBhdGgpO1xuICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMubW9kYWwuZGlzcGxheSgpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG4iLCAiaW1wb3J0IHsgVEFic3RyYWN0RmlsZSwgVEZvbGRlciB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IE1hdGhMaW5rcyBmcm9tIFwiLi9tYWluXCI7XG5cbi8vIENoZWNrIGlmIHBhdGggaXMgZXhjbHVkZWRcbmV4cG9ydCBmdW5jdGlvbiBpc0V4Y2x1ZGVkKHBsdWdpbjogTWF0aExpbmtzLCBmaWxlOiBUQWJzdHJhY3RGaWxlKTogYm9vbGVhbiB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwbHVnaW4uc2V0dGluZ3MuZXhjbHVkZWRQYXRocy5sZW5ndGg7IGkrKykge1xuICAgICAgICBsZXQgZXhjbHVkZWQgPSBwbHVnaW4uYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChwbHVnaW4uc2V0dGluZ3MuZXhjbHVkZWRQYXRoc1tpXSk7XG4gICAgICAgIGlmIChleGNsdWRlZCAmJiBpc0VxdWFsVG9PckNoaWxkT2YoZmlsZSwgZXhjbHVkZWQpKSByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG59XG5cbi8vIENvbnZlcnQgXCJmaWxlbmFtZSNoZWFkaW5nXCIgdG8gXCJmaWxlbmFtZSA+IGhlYWRpbmdcIiBhbmQgXCJmaWxlbmFtZSNeYmxvY2tJRFwiIHRvIFwiZmlsZW5hbWUgPiBeYmxvY2tJRFwiXG5leHBvcnQgZnVuY3Rpb24gdHJhbnNsYXRlTGluayh0YXJnZXRMaW5rOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGZ1bmN0aW9uIHRyYW5zbGF0ZUxpbmtJbXBsKHRhcmdldExpbms6IHN0cmluZywgcGF0dGVybjogUmVnRXhwKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgICAgICAgbGV0IHJlc3VsdCA9IHBhdHRlcm4uZXhlYyh0YXJnZXRMaW5rKTtcbiAgICAgICAgaWYgKHJlc3VsdClcbiAgICAgICAgICAgIHJldHVybiAocmVzdWx0WzFdID8gYCR7cmVzdWx0WzFdfSA+IGAgOiBcIlwiKSArIGAke3Jlc3VsdFsyXX1gXG4gICAgfVxuXG4gICAgbGV0IGhlYWRpbmdQYXR0ZXJuID0gLyheLiopIyhbXlxcXl0uKikvO1xuICAgIGxldCBibG9ja1BhdHRlcm4gPSAvKF4uKikjKFxcXlthLXpBLVowLTlcXC1dKykvO1xuICAgIGxldCB0cmFuc2xhdGVkQXNIZWFkaW5nID0gdHJhbnNsYXRlTGlua0ltcGwodGFyZ2V0TGluaywgaGVhZGluZ1BhdHRlcm4pO1xuICAgIGxldCB0cmFuc2xhdGVkQXNCbG9jayA9IHRyYW5zbGF0ZUxpbmtJbXBsKHRhcmdldExpbmssIGJsb2NrUGF0dGVybik7XG4gICAgcmV0dXJuIHRyYW5zbGF0ZWRBc0hlYWRpbmcgPz8gdHJhbnNsYXRlZEFzQmxvY2sgPz8gXCJcIjtcbn1cblxuLy8gRnJvbSBodHRwczovL2dpdGh1Yi5jb20vUnlvdGFVc2hpby9vYnNpZGlhbi1tYXRoLWJvb3N0ZXIvYmxvYi9tYXN0ZXIvc3JjL3V0aWxzLnRzXG5leHBvcnQgZnVuY3Rpb24gaXNFcXVhbFRvT3JDaGlsZE9mKGZpbGUxOiBUQWJzdHJhY3RGaWxlLCBmaWxlMjogVEFic3RyYWN0RmlsZSk6IGJvb2xlYW4ge1xuICAgIGlmIChmaWxlMSA9PSBmaWxlMikgcmV0dXJuIHRydWU7XG4gICAgaWYgKGZpbGUyIGluc3RhbmNlb2YgVEZvbGRlciAmJiBmaWxlMi5pc1Jvb3QoKSkgcmV0dXJuIHRydWU7XG5cbiAgICBsZXQgYW5jZXN0b3IgPSBmaWxlMS5wYXJlbnQ7XG4gICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgaWYgKGFuY2VzdG9yID09IGZpbGUyKSByZXR1cm4gdHJ1ZTtcbiAgICAgICAgaWYgKGFuY2VzdG9yKSB7XG4gICAgICAgICAgICBpZiAoYW5jZXN0b3IuaXNSb290KCkpIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIGFuY2VzdG9yID0gYW5jZXN0b3IucGFyZW50O1xuICAgICAgICB9XG4gICAgfVxufVxuIiwgIi8qKlxuICogVGhpcyBmaWxlcyBjb250YWlucyB0aGUgb2Jzb2xldGUgQVBJLiBVc2UgdGhlIG5ldyBBUEkgaW4gcHJvdmlkZXIudHMgaW5zdGVhZC5cbiAqL1xuXG5pbXBvcnQgeyBCbG9ja1N1YnBhdGhSZXN1bHQsIEhlYWRpbmdTdWJwYXRoUmVzdWx0LCBQbHVnaW5NYW5pZmVzdCwgVEZpbGUgfSBmcm9tICdvYnNpZGlhbic7XG5pbXBvcnQgTWF0aExpbmtzIGZyb20gJy4uL21haW4nO1xuXG5leHBvcnQgaW50ZXJmYWNlIE1hdGhMaW5rc01ldGFkYXRhIHtcbiAgICBcIm1hdGhMaW5rXCI/OiBzdHJpbmc7XG4gICAgXCJtYXRoTGluay1ibG9ja3NcIj86IFJlY29yZDxzdHJpbmcsIHN0cmluZz47XG59XG5cbmV4cG9ydCB0eXBlIE1hdGhMaW5rc01ldGFkYXRhU2V0ID0gTWFwPFRGaWxlLCBNYXRoTGlua3NNZXRhZGF0YT47XG5cbmV4cG9ydCBjbGFzcyBNYXRoTGlua3NBUElBY2NvdW50IHtcbiAgICBtZXRhZGF0YVNldDogTWF0aExpbmtzTWV0YWRhdGFTZXQ7XG5cbiAgICBjb25zdHJ1Y3RvcihwdWJsaWMgcGx1Z2luOiBNYXRoTGlua3MsIHB1YmxpYyBtYW5pZmVzdDogUmVhZG9ubHk8UGx1Z2luTWFuaWZlc3Q+LCBwdWJsaWMgYmxvY2tQcmVmaXg6IHN0cmluZywgcHVibGljIHByZWZpeGVyOiAoc291cmNlRmlsZTogVEZpbGUsIHRhcmdldEZpbGU6IFRGaWxlLCBzdWJwYXRoUmVzdWx0OiBIZWFkaW5nU3VicGF0aFJlc3VsdCB8IEJsb2NrU3VicGF0aFJlc3VsdCkgPT4gc3RyaW5nIHwgbnVsbCkge1xuICAgICAgICB0aGlzLm1ldGFkYXRhU2V0ID0gbmV3IE1hcCgpO1xuICAgIH1cblxuICAgIGdldChmaWxlOiBURmlsZSwgYmxvY2tJRD86IHN0cmluZyk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG4gICAgICAgIC8vIElmIGJsb2NrSUQgPT09IHVuZGVmaW5lZCwgcmV0dXJuIG1hdGhMaW5rXG4gICAgICAgIC8vIElmIGJsb2NrSUQgaXMgZ2l2ZW4sIHJldHVybiB0aGUgY29ycmVzcG9uZGluZyBpdGVtIG9mIG1hdGhMaW5rLWJsb2Nrc1xuICAgICAgICBsZXQgbWV0YWRhdGEgPSB0aGlzLm1ldGFkYXRhU2V0LmdldChmaWxlKTtcbiAgICAgICAgaWYgKG1ldGFkYXRhKSB7XG4gICAgICAgICAgICBpZiAoYmxvY2tJRCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG1ldGFkYXRhW1wibWF0aExpbmtcIl07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgYmxvY2tzID0gbWV0YWRhdGFbXCJtYXRoTGluay1ibG9ja3NcIl07XG4gICAgICAgICAgICBpZiAoYmxvY2tzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGJsb2Nrc1tibG9ja0lEXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHVwZGF0ZShmaWxlOiBURmlsZSwgbmV3TWV0YWRhdGE6IE1hdGhMaW5rc01ldGFkYXRhKTogdm9pZCB7XG4gICAgICAgIGlmIChmaWxlLmV4dGVuc2lvbiA9PSBcIm1kXCIpIHtcbiAgICAgICAgICAgIHRoaXMubWV0YWRhdGFTZXQuc2V0KGZpbGUsIE9iamVjdC5hc3NpZ24oe30sIHRoaXMubWV0YWRhdGFTZXQuZ2V0KGZpbGUpLCBuZXdNZXRhZGF0YSkpO1xuICAgICAgICAgICAgdGhpcy5wbHVnaW4udXBkYXRlKGZpbGUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoYE1hdGhMaW5rcyBBUEk6ICR7dGhpcy5tYW5pZmVzdC5uYW1lfSBwYXNzZWQgYSBub24tbWFya2Rvd24gZmlsZSAke2ZpbGUucGF0aH0gdG8gdXBkYXRlKCkuYCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBkZWxldGUoZmlsZTogVEZpbGUsIHdoaWNoPzogc3RyaW5nKTogdm9pZCB7XG4gICAgICAgIC8vIGB3aGljaCA9PT0gdW5kZWZpbmVkYDogcmVtb3ZlIGFsbCB0aGUgbWF0aExpbmtzIGFzc29jaWF0ZWQgd2l0aCBgcGF0aGBcbiAgICAgICAgLy8gYHdoaWNoID09IFwibWF0aExpbmtcIjogcmVtb3ZlIGBtYXRoTGlua2BcbiAgICAgICAgLy8gYHdoaWNoID09IFwibWF0aExpbmstYmxvY2tzXCI6IHJlbW92ZSBgbWF0aExpbmstYmxvY2tzYFxuICAgICAgICAvLyBgd2hpY2ggPT0gPGJsb2NrSUQ+YDogcmVtb3ZlIGBtYXRoTGluay1ibG9ja3NbPGJsb2NrSUQ+XWBcbiAgICAgICAgbGV0IG1ldGFkYXRhID0gdGhpcy5tZXRhZGF0YVNldC5nZXQoZmlsZSk7XG4gICAgICAgIGlmIChtZXRhZGF0YSkge1xuICAgICAgICAgICAgaWYgKHdoaWNoID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm1ldGFkYXRhU2V0LmRlbGV0ZShmaWxlKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAod2hpY2ggPT0gXCJtYXRoTGlua1wiIHx8IHdoaWNoID09IFwibWF0aExpbmstYmxvY2tzXCIpIHtcbiAgICAgICAgICAgICAgICBpZiAobWV0YWRhdGFbd2hpY2hdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIG1ldGFkYXRhW3doaWNoXTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcihgTWF0aExpbmtzIEFQSTogJHt0aGlzLm1hbmlmZXN0Lm5hbWV9IGF0dGVtcHRlZCB0byBkZWxldGUgJHt3aGljaH0gb2YgJHtmaWxlLnBhdGh9LCBidXQgaXQgZG9lcyBub3QgZXhpc3QuYCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBsZXQgYmxvY2tzID0gbWV0YWRhdGFbXCJtYXRoTGluay1ibG9ja3NcIl07XG4gICAgICAgICAgICAgICAgaWYgKGJsb2NrcyAmJiBibG9ja3Nbd2hpY2hdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGJsb2Nrc1t3aGljaF07XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoYE1hdGhMaW5rcyBBUEk6ICR7dGhpcy5tYW5pZmVzdC5uYW1lfSBhdHRlbXB0ZWQgdG8gZGVsZXRlIG1hdGhMaW5rLWJsb2NrcyBmb3IgJHtmaWxlLnBhdGh9I14ke3doaWNofVwiLCBidXQgaXQgZG9lcyBub3QgZXhpc3RgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcihgTWF0aExpbmtzIEFQSTogJHt0aGlzLm1hbmlmZXN0Lm5hbWV9IGF0dGVtcHRlZCB0byBkZWxldGUgdGhlIE1hdGhMaW5rcyBtZXRhZGF0YSBvZiAke2ZpbGUucGF0aH0sIGJ1dCBpdCBkb2VzIG5vdCBleGlzdC5gKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnBsdWdpbi51cGRhdGUoZmlsZSk7XG4gICAgfVxufVxuIiwgImltcG9ydCB7IFRGaWxlLCBnZXRMaW5rcGF0aCwgTWFya2Rvd25SZW5kZXJDaGlsZCwgTWFya2Rvd25Qb3N0UHJvY2Vzc29yQ29udGV4dCB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgc2V0TWF0aExpbmssIGdldE1hdGhMaW5rIH0gZnJvbSBcIi4vaGVscGVyXCJcbmltcG9ydCB7IHRyYW5zbGF0ZUxpbmsgfSBmcm9tIFwiLi4vdXRpbHNcIjtcbmltcG9ydCBNYXRoTGlua3MgZnJvbSBcIi4uL21haW5cIlxuXG5leHBvcnQgY2xhc3MgTWF0aExpbmtzUmVuZGVyQ2hpbGQgZXh0ZW5kcyBNYXJrZG93blJlbmRlckNoaWxkIHtcbiAgICByZWFkb25seSB0YXJnZXRGaWxlOiBURmlsZSB8IG51bGw7XG4gICAgcmVhZG9ubHkgZ2V0TWF0aExpbms6ICgpID0+IHN0cmluZztcbiAgICBtYXRoTGlua0VsOiBIVE1MRWxlbWVudDtcblxuICAgIGNvbnN0cnVjdG9yKGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudCwgcHVibGljIHBsdWdpbjogTWF0aExpbmtzLCBwdWJsaWMgc291cmNlUGF0aDogc3RyaW5nLCBwdWJsaWMgdGFyZ2V0TGluazogc3RyaW5nLCBwdWJsaWMgZGlzcGxheVRleHQ6IHN0cmluZykge1xuICAgICAgICBzdXBlcihjb250YWluZXJFbCk7XG4gICAgICAgIHRoaXMudGFyZ2V0RmlsZSA9IHRoaXMucGx1Z2luLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpcnN0TGlua3BhdGhEZXN0KGdldExpbmtwYXRoKHRoaXMudGFyZ2V0TGluayksIHRoaXMuc291cmNlUGF0aCk7XG4gICAgICAgIHRoaXMubWF0aExpbmtFbCA9IHRoaXMuY29udGFpbmVyRWwuY2xvbmVOb2RlKHRydWUpIGFzIEhUTUxFbGVtZW50O1xuICAgICAgICB0aGlzLm1hdGhMaW5rRWwudGV4dENvbnRlbnQgPSBcIlwiO1xuICAgICAgICB0aGlzLmNvbnRhaW5lckVsLnBhcmVudE5vZGU/Lmluc2VydEJlZm9yZSh0aGlzLm1hdGhMaW5rRWwsIHRoaXMuY29udGFpbmVyRWwubmV4dFNpYmxpbmcpO1xuICAgICAgICB0aGlzLm1hdGhMaW5rRWwuY2xhc3NMaXN0LmFkZChcIm1hdGhMaW5rLWludGVybmFsLWxpbmtcIik7XG4gICAgICAgIHRoaXMuY29udGFpbmVyRWwuY2xhc3NMaXN0LmFkZChcIm9yaWdpbmFsLWludGVybmFsLWxpbmtcIik7XG4gICAgICAgIHRoaXMuY29udGFpbmVyRWwuY2xhc3NMaXN0LnJlbW92ZShcImludGVybmFsLWxpbmtcIik7IC8vICM1MTogdGhpcyBpcyB0byBmaXggdGhlIGluY29tcGF0aWJpbGl0eSB3aXRoIFN0cmFuZ2UgTmV3IFdvcmxkc1xuICAgICAgICB0aGlzLmNvbnRhaW5lckVsLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgdGhpcy5nZXRNYXRoTGluayA9IHRoaXMuc2V0TWF0aExpbmtHZXR0ZXIoKTtcbiAgICB9XG5cbiAgICBvbmxvYWQoKTogdm9pZCB7XG4gICAgICAgIHRoaXMudXBkYXRlKCk7XG5cbiAgICAgICAgLy8gMS4gd2hlbiBhbiBBUEkgdXNlciB1cGRhdGVzIGl0cyBtZXRhZGF0YVxuICAgICAgICB0aGlzLnJlZ2lzdGVyRXZlbnQodGhpcy5wbHVnaW4uYXBwLm1ldGFkYXRhQ2FjaGUub24oXCJtYXRobGlua3M6dXBkYXRlXCIsIChjaGFuZ2VkRmlsZSkgPT4ge1xuICAgICAgICAgICAgaWYgKCF0aGlzLnRhcmdldEZpbGUgfHwgdGhpcy50YXJnZXRGaWxlID09IGNoYW5nZWRGaWxlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpO1xuXG4gICAgICAgIC8vIDIuIHdoZW4gYW4gQVBJIGFjY291bnQgaXMgZGVsZXRlZFxuICAgICAgICB0aGlzLnJlZ2lzdGVyRXZlbnQodGhpcy5wbHVnaW4uYXBwLm1ldGFkYXRhQ2FjaGUub24oXCJtYXRobGlua3M6dXBkYXRlLWFsbFwiLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZSgpO1xuICAgICAgICB9KSk7XG4gICAgfVxuXG4gICAgc2V0TWF0aExpbmtHZXR0ZXIoKTogKCkgPT4gc3RyaW5nIHtcbiAgICAgICAgbGV0IGdldHRlciA9ICgpID0+IFwiXCI7XG4gICAgICAgIGlmICh0aGlzLmRpc3BsYXlUZXh0ICE9IHRoaXMudGFyZ2V0TGluayAmJiB0aGlzLmRpc3BsYXlUZXh0ICE9IHRyYW5zbGF0ZUxpbmsodGhpcy50YXJnZXRMaW5rKSkge1xuICAgICAgICAgICAgLy8gW1tub3RlfGRpc3BsYXldXSAtPiB1c2UgZGlzcGxheSBhcyBtYXRoTGlua1xuICAgICAgICAgICAgZ2V0dGVyID0gKCkgPT4gdGhpcy5kaXNwbGF5VGV4dDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmRpc3BsYXlUZXh0ID09IHRoaXMudGFyZ2V0RmlsZT8ubmFtZSB8fCB0aGlzLmRpc3BsYXlUZXh0ID09IHRoaXMudGFyZ2V0RmlsZT8uYmFzZW5hbWUgfHwgdGhpcy5kaXNwbGF5VGV4dCA9PSB0cmFuc2xhdGVMaW5rKHRoaXMudGFyZ2V0TGluaykpIHtcbiAgICAgICAgICAgICAgICAvLyBbW25vdGVdXSwgW1tub3RlI2hlYWRpbmddXSBvciBbW25vdGUjXmJsb2NrSURdXVxuICAgICAgICAgICAgICAgIGdldHRlciA9ICgpID0+IGdldE1hdGhMaW5rKHRoaXMucGx1Z2luLCB0aGlzLnRhcmdldExpbmssIHRoaXMuc291cmNlUGF0aCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGdldHRlcjtcbiAgICB9XG5cbiAgICB1cGRhdGUoKTogdm9pZCB7XG4gICAgICAgIGNvbnN0IG1hdGhMaW5rID0gdGhpcy5nZXRNYXRoTGluaygpO1xuXG4gICAgICAgIGlmIChtYXRoTGluaykge1xuICAgICAgICAgICAgc2V0TWF0aExpbmsobWF0aExpbmssIHRoaXMubWF0aExpbmtFbCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzZXRNYXRoTGluayh0aGlzLmRpc3BsYXlUZXh0LCB0aGlzLm1hdGhMaW5rRWwpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVNYXRoTGlua3MocGx1Z2luOiBNYXRoTGlua3MsIGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBjb250ZXh0OiBNYXJrZG93blBvc3RQcm9jZXNzb3JDb250ZXh0KTogdm9pZCB7XG4gICAgZm9yIChsZXQgdGFyZ2V0RWwgb2YgZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsPEhUTUxFbGVtZW50PihcIi5pbnRlcm5hbC1saW5rXCIpKSB7XG4gICAgICAgIGlmICh0YXJnZXRFbC5jbGFzc0xpc3QuY29udGFpbnMoXCJtYXRoTGluay1pbnRlcm5hbC1saW5rXCIpKSB7XG4gICAgICAgICAgICB0YXJnZXRFbC5yZW1vdmUoKTtcbiAgICAgICAgICAgIGxldCBxdWVyeVJlc3VsdCA9IGVsZW1lbnQucXVlcnlTZWxlY3RvcjxIVE1MRWxlbWVudD4oXCIub3JpZ2luYWwtaW50ZXJuYWwtbGlua1wiKTtcbiAgICAgICAgICAgIGlmIChxdWVyeVJlc3VsdCkge1xuICAgICAgICAgICAgICAgIHRhcmdldEVsID0gcXVlcnlSZXN1bHQ7XG4gICAgICAgICAgICAgICAgdGFyZ2V0RWwuY2xhc3NMaXN0LnJlbW92ZShcIm9yaWdpbmFsLWludGVybmFsLWxpbmtcIik7XG4gICAgICAgICAgICAgICAgdGFyZ2V0RWwuc3R5bGUuZGlzcGxheSA9IFwiXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB0YXJnZXREaXNwbGF5ID0gdGFyZ2V0RWwudGV4dENvbnRlbnQ/LnRyaW0oKS5yZXBsYWNlKC9cXC5tZC8sIFwiXCIpO1xuICAgICAgICBpZiAodGFyZ2V0RGlzcGxheSAhPSBcIlwiICYmICEvbWF0aC1pbmxpbmUgaXMtbG9hZGVkLy50ZXN0KHRhcmdldEVsLmlubmVySFRNTCkpIHtcbiAgICAgICAgICAgIGNvbnN0IHRhcmdldExpbmsgPSB0YXJnZXRFbC5nZXRBdHRyaWJ1dGUoXCJkYXRhLWhyZWZcIik/LnJlcGxhY2UoL1xcLm1kLywgXCJcIik7XG4gICAgICAgICAgICBpZiAodGFyZ2V0TGluaykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldEZpbGUgPSBwbHVnaW4uYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0Rmlyc3RMaW5rcGF0aERlc3QoZ2V0TGlua3BhdGgodGFyZ2V0TGluayksIGNvbnRleHQuc291cmNlUGF0aCk7XG4gICAgICAgICAgICAgICAgaWYgKHRhcmdldERpc3BsYXkgJiYgdGFyZ2V0RmlsZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGlsZCA9IG5ldyBNYXRoTGlua3NSZW5kZXJDaGlsZCh0YXJnZXRFbCwgcGx1Z2luLCBjb250ZXh0LnNvdXJjZVBhdGgsIHRhcmdldExpbmssIHRhcmdldERpc3BsYXkpO1xuICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmFkZENoaWxkKGNoaWxkKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG4iLCAiaW1wb3J0IHsgQmxvY2tTdWJwYXRoUmVzdWx0LCBIZWFkaW5nU3VicGF0aFJlc3VsdCwgU2VhcmNoTWF0Y2hlcywgVEZpbGUsIHJlc29sdmVTdWJwYXRoIH0gZnJvbSAnb2JzaWRpYW4nO1xuaW1wb3J0IHsgYXJvdW5kIH0gZnJvbSAnbW9ua2V5LWFyb3VuZCc7XG5pbXBvcnQgTWF0aExpbmtzIGZyb20gJy4vbWFpbic7XG5pbXBvcnQgeyBfZ2V0TWF0aExpbmssIGdldE1hdGhMaW5rLCBzZXRNYXRoTGluayB9IGZyb20gJy4vbGlua3MvaGVscGVyJztcbmltcG9ydCB7IEVkaXRvclN1Z2dlc3QgfSBmcm9tICdvYnNpZGlhbic7XG5cbi8vIGh0dHBzOi8vZ2l0aHViLmNvbS96aGFvc2hlbnpoYWkvb2JzaWRpYW4tbWF0aGxpbmtzL2lzc3Vlcy81NVxuLy8gUGF0Y2ggdGhlIGNvcmUgT3V0bGluZSB2aWV3IHRvIHJlbmRlciBNYXRoSmF4IGluIGl0XG5leHBvcnQgY29uc3QgcGF0Y2hPdXRsaW5lID0gKHBsdWdpbjogTWF0aExpbmtzKTogYm9vbGVhbiA9PiB7XG4gICAgY29uc3Qgb3V0bGluZVZpZXcgPSBwbHVnaW4uYXBwLndvcmtzcGFjZS5nZXRMZWF2ZXNPZlR5cGUoJ291dGxpbmUnKVswXT8udmlldztcbiAgICBpZiAoIW91dGxpbmVWaWV3KSByZXR1cm4gZmFsc2U7XG5cbiAgICBwbHVnaW4ucmVnaXN0ZXIoXG4gICAgICAgIGFyb3VuZChvdXRsaW5lVmlldy5jb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHtcbiAgICAgICAgICAgIGdldEl0ZW1Eb20ob2xkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChhcmcpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmV0ID0gb2xkLmNhbGwodGhpcywgYXJnKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gV2FpdCBmb3IgdGhlIHJldC5pbm5lckVsIChkaXYudHJlZS1pdGVtLWlubmVyKSB0byBiZSBmdWxseSByZW5kZXJlZCBcbiAgICAgICAgICAgICAgICAgICAgLy8gYnkgdGhlIGNvcmUgT3V0bGluZSBwbHVnaW5cbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiBzZXRNYXRoTGluayhyZXQuaGVhZGluZy5oZWFkaW5nLCByZXQuaW5uZXJFbCkpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pXG4gICAgKVxuXG4gICAgcmV0dXJuIHRydWU7XG59XG5cblxuLy8gaHR0cHM6Ly9naXRodWIuY29tL1J5b3RhVXNoaW8vb2JzaWRpYW4tbWF0aC1ib29zdGVyL2lzc3Vlcy8xOTBcbi8vIFBhdGNoIHRoZSBidWlsdC1pbiBsaW5rIGF1dG9jb21wbGV0aW9uIHRvIHJlbmRlciBNYXRoSmF4IGluIGl0XG5cbmludGVyZmFjZSBMaW5rSW5mbyB7XG4gICAgZmlsZTogVEZpbGU7XG4gICAgbWF0Y2hlczogU2VhcmNoTWF0Y2hlcyB8IG51bGw7XG4gICAgcGF0aDogc3RyaW5nO1xuICAgIHNjb3JlOiBudW1iZXI7XG4gICAgc3VicGF0aD86IHN0cmluZztcbn07XG5cbmludGVyZmFjZSBGaWxlTGlua0luZm8gZXh0ZW5kcyBMaW5rSW5mbyB7XG4gICAgdHlwZTogXCJmaWxlXCI7XG59XG5cbmludGVyZmFjZSBIZWFkaW5nTGlua0luZm8gZXh0ZW5kcyBMaW5rSW5mbyB7XG4gICAgdHlwZTogXCJoZWFkaW5nXCI7XG4gICAgaGVhZGluZzogc3RyaW5nO1xuICAgIGxldmVsOiBudW1iZXI7XG4gICAgc3VicGF0aDogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgQmxvY2tMaW5rSW5mbyBleHRlbmRzIExpbmtJbmZvIHtcbiAgICB0eXBlOiBcImJsb2NrXCI7XG4gICAgaWRNYXRjaDogU2VhcmNoTWF0Y2hlcyB8IG51bGw7XG4gICAgc3VicGF0aDogc3RyaW5nO1xuICAgIG5vZGU6IGFueTtcbiAgICBkaXNwbGF5OiBzdHJpbmc7XG4gICAgY29udGVudDogc3RyaW5nO1xufVxuXG50eXBlIEJ1aWx0SW5BdXRvY29tcGxldGlvbiA9IEVkaXRvclN1Z2dlc3Q8RmlsZUxpbmtJbmZvIHwgSGVhZGluZ0xpbmtJbmZvIHwgQmxvY2tMaW5rSW5mbz47XG5cblxuZXhwb3J0IGNvbnN0IHBhdGNoTGlua0F1dG9jb21wbGV0aW9uID0gKHBsdWdpbjogTWF0aExpbmtzKTogYm9vbGVhbiA9PiB7XG4gICAgY29uc3Qgc3VnZ2VzdCA9IChwbHVnaW4uYXBwLndvcmtzcGFjZSBhcyBhbnkpLmVkaXRvclN1Z2dlc3Quc3VnZ2VzdHNbMF0gYXMgQnVpbHRJbkF1dG9jb21wbGV0aW9uO1xuICAgIGlmICghc3VnZ2VzdCkgcmV0dXJuIGZhbHNlO1xuXG4gICAgcGx1Z2luLnJlZ2lzdGVyKFxuICAgICAgICBhcm91bmQoc3VnZ2VzdC5jb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHtcbiAgICAgICAgICAgIHJlbmRlclN1Z2dlc3Rpb24ob2xkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICh2YWx1ZTogRmlsZUxpbmtJbmZvIHwgSGVhZGluZ0xpbmtJbmZvIHwgQmxvY2tMaW5rSW5mbywgZWw6IEhUTUxFbGVtZW50KTogdm9pZCB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNvdXJjZUZpbGUgPSAodGhpcyBhcyBCdWlsdEluQXV0b2NvbXBsZXRpb24pLmNvbnRleHQ/LmZpbGUgPz8gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHN1YnBhdGhSZXN1bHQ6IEhlYWRpbmdTdWJwYXRoUmVzdWx0IHwgQmxvY2tTdWJwYXRoUmVzdWx0IHwgbnVsbCA9IG51bGw7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLnR5cGUgPT09IFwiaGVhZGluZ1wiIHx8IHZhbHVlLnR5cGUgPT09IFwiYmxvY2tcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2FjaGUgPSBwbHVnaW4uYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0RmlsZUNhY2hlKHZhbHVlLmZpbGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNhY2hlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VicGF0aFJlc3VsdCA9IHJlc29sdmVTdWJwYXRoKGNhY2hlLCB2YWx1ZS5zdWJwYXRoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXRoTGluayA9IF9nZXRNYXRoTGluayhwbHVnaW4sIHZhbHVlLnBhdGgsIHZhbHVlLnN1YnBhdGggPz8gXCJcIiwgdmFsdWUuZmlsZSwgc3VicGF0aFJlc3VsdCwgc291cmNlRmlsZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgb2xkLmNhbGwodGhpcywgdmFsdWUsIGVsKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAobWF0aExpbmspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRpdGxlRWwgPSBlbC5xdWVyeVNlbGVjdG9yPEhUTUxFbGVtZW50PignLnN1Z2dlc3Rpb24tdGl0bGUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aXRsZUVsKSBzZXRNYXRoTGluayhtYXRoTGluaywgdGl0bGVFbCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KVxuICAgIClcblxuICAgIHJldHVybiB0cnVlO1xufVxuIiwgImV4cG9ydCBmdW5jdGlvbiBhcm91bmQob2JqLCBmYWN0b3JpZXMpIHtcbiAgICBjb25zdCByZW1vdmVycyA9IE9iamVjdC5rZXlzKGZhY3RvcmllcykubWFwKGtleSA9PiBhcm91bmQxKG9iaiwga2V5LCBmYWN0b3JpZXNba2V5XSkpO1xuICAgIHJldHVybiByZW1vdmVycy5sZW5ndGggPT09IDEgPyByZW1vdmVyc1swXSA6IGZ1bmN0aW9uICgpIHsgcmVtb3ZlcnMuZm9yRWFjaChyID0+IHIoKSk7IH07XG59XG5mdW5jdGlvbiBhcm91bmQxKG9iaiwgbWV0aG9kLCBjcmVhdGVXcmFwcGVyKSB7XG4gICAgY29uc3Qgb3JpZ2luYWwgPSBvYmpbbWV0aG9kXSwgaGFkT3duID0gb2JqLmhhc093blByb3BlcnR5KG1ldGhvZCk7XG4gICAgbGV0IGN1cnJlbnQgPSBjcmVhdGVXcmFwcGVyKG9yaWdpbmFsKTtcbiAgICAvLyBMZXQgb3VyIHdyYXBwZXIgaW5oZXJpdCBzdGF0aWMgcHJvcHMgZnJvbSB0aGUgd3JhcHBpbmcgbWV0aG9kLFxuICAgIC8vIGFuZCB0aGUgd3JhcHBpbmcgbWV0aG9kLCBwcm9wcyBmcm9tIHRoZSBvcmlnaW5hbCBtZXRob2RcbiAgICBpZiAob3JpZ2luYWwpXG4gICAgICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZihjdXJyZW50LCBvcmlnaW5hbCk7XG4gICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKHdyYXBwZXIsIGN1cnJlbnQpO1xuICAgIG9ialttZXRob2RdID0gd3JhcHBlcjtcbiAgICAvLyBSZXR1cm4gYSBjYWxsYmFjayB0byBhbGxvdyBzYWZlIHJlbW92YWxcbiAgICByZXR1cm4gcmVtb3ZlO1xuICAgIGZ1bmN0aW9uIHdyYXBwZXIoLi4uYXJncykge1xuICAgICAgICAvLyBJZiB3ZSBoYXZlIGJlZW4gZGVhY3RpdmF0ZWQgYW5kIGFyZSBubyBsb25nZXIgd3JhcHBlZCwgcmVtb3ZlIG91cnNlbHZlc1xuICAgICAgICBpZiAoY3VycmVudCA9PT0gb3JpZ2luYWwgJiYgb2JqW21ldGhvZF0gPT09IHdyYXBwZXIpXG4gICAgICAgICAgICByZW1vdmUoKTtcbiAgICAgICAgcmV0dXJuIGN1cnJlbnQuYXBwbHkodGhpcywgYXJncyk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIHJlbW92ZSgpIHtcbiAgICAgICAgLy8gSWYgbm8gb3RoZXIgcGF0Y2hlcywganVzdCBkbyBhIGRpcmVjdCByZW1vdmFsXG4gICAgICAgIGlmIChvYmpbbWV0aG9kXSA9PT0gd3JhcHBlcikge1xuICAgICAgICAgICAgaWYgKGhhZE93bilcbiAgICAgICAgICAgICAgICBvYmpbbWV0aG9kXSA9IG9yaWdpbmFsO1xuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIGRlbGV0ZSBvYmpbbWV0aG9kXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY3VycmVudCA9PT0gb3JpZ2luYWwpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIC8vIEVsc2UgcGFzcyBmdXR1cmUgY2FsbHMgdGhyb3VnaCwgYW5kIHJlbW92ZSB3cmFwcGVyIGZyb20gdGhlIHByb3RvdHlwZSBjaGFpblxuICAgICAgICBjdXJyZW50ID0gb3JpZ2luYWw7XG4gICAgICAgIE9iamVjdC5zZXRQcm90b3R5cGVPZih3cmFwcGVyLCBvcmlnaW5hbCB8fCBGdW5jdGlvbik7XG4gICAgfVxufVxuZXhwb3J0IGZ1bmN0aW9uIGRlZHVwZShrZXksIG9sZEZuLCBuZXdGbikge1xuICAgIGNoZWNrW2tleV0gPSBrZXk7XG4gICAgcmV0dXJuIGNoZWNrO1xuICAgIGZ1bmN0aW9uIGNoZWNrKC4uLmFyZ3MpIHtcbiAgICAgICAgcmV0dXJuIChvbGRGbltrZXldID09PSBrZXkgPyBvbGRGbiA6IG5ld0ZuKS5hcHBseSh0aGlzLCBhcmdzKTtcbiAgICB9XG59XG5leHBvcnQgZnVuY3Rpb24gYWZ0ZXIocHJvbWlzZSwgY2IpIHtcbiAgICByZXR1cm4gcHJvbWlzZS50aGVuKGNiLCBjYik7XG59XG5leHBvcnQgZnVuY3Rpb24gc2VyaWFsaXplKGFzeW5jRnVuY3Rpb24pIHtcbiAgICBsZXQgbGFzdFJ1biA9IFByb21pc2UucmVzb2x2ZSgpO1xuICAgIGZ1bmN0aW9uIHdyYXBwZXIoLi4uYXJncykge1xuICAgICAgICByZXR1cm4gbGFzdFJ1biA9IG5ldyBQcm9taXNlKChyZXMsIHJlaikgPT4ge1xuICAgICAgICAgICAgYWZ0ZXIobGFzdFJ1biwgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGFzeW5jRnVuY3Rpb24uYXBwbHkodGhpcywgYXJncykudGhlbihyZXMsIHJlaik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHdyYXBwZXIuYWZ0ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBsYXN0UnVuID0gbmV3IFByb21pc2UoKHJlcywgcmVqKSA9PiB7IGFmdGVyKGxhc3RSdW4sIHJlcyk7IH0pO1xuICAgIH07XG4gICAgcmV0dXJuIHdyYXBwZXI7XG59XG4iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSx1QkFBeUQ7QUFDekQsb0JBQTRCOzs7QUM0QjVCLHVCQUE2RTtBQUM3RSxtQkFBeUk7QUFDekksa0JBUU87QUFFUCxzQkFBMkI7OztBQ3hDM0Isc0JBQTJFO0FBT3BFLElBQWUs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
